<!DOCTYPE html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]--><!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8"><![endif]--><!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9"><![endif]--><!--[if gt IE 8]><!--><html class="no-js">
<!--<![endif]--> <head> <meta charset="UTF-8"> <meta content="text/html; charset=UTF-8" http-equiv="Content-Type"> <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"> <title>إنشاء منتدى PHP من الصفر – موقع ملهم</title> <meta name="description" content="شرح شامل ومُيسَّر لطريقة إنشاء منتدى متكامل باستخدام php و MySQL من البداية"> <meta name="keywords" content=""> <!-- Twitter Cards --> <meta name="twitter:card" content="summary"> <meta name="twitter:image" content="http://localhost:4000/assets/img/logo.png"> <meta name="twitter:title" content="إنشاء منتدى PHP من الصفر"> <meta name="twitter:description" content="هذا الدرس من تأليف Evert padje وترجمتي (ملهم)، يركّز الدرس على إنشاء منتدى باستخدام php و Mysql من أجل قاعدة بيانات المنتدى .. وهو لغرض تعليمي، يمكن معاينة المنتدى الناتج على هذا الرابطسنقوم في هذا الشرح ببناء منتدى PHP/MySQL من الصفر. هذا الشرح أيضاً ممتاز للاعتياد على أساسيات لغة البرمجة php وقواعد بيانات MySQL . لنبدأ سويةً ! أولاً : إنشاء جداول قاعدة البيانات : جدول المستخدمين user_id user_name user_pass user_email user_date user_level جدول التصنيفات جدول المواضيع جدول التعليقات ثانياً: مقدمة لنظام الترويسة/التذييل ملف الترويسة header.php ثالثاً: البدء بالتنفيذ الفعلي رابعاً: عرض المنتدى خامساً: اشتراك مستخدم التأكد من البيانات سادساً: إضافة التفعيل ومستوى المستخدم سابعاً: إنشاء تصنيف ثامناً: إضافة تصنيفات للصفحة الرئيسية index.php تاسعاً: إنشاء موضوع عرض النموذج معالجة النموذج عاشراً : عرض التصنيفات الخطوة 11 : عرض المواضيع الخطوة 12 : إضافة تعليق النهايةأولاً : إنشاء جداول قاعدة البيانات :دائماً ، وقبل البدء بإنشاء أي تطبيق وب، من الجيد القيام بإنشاء قاعدة بيانات جيدة لإدخال البيانات بشكل جيد . لنصف تطبيقنا الذي نريد إنشاؤه بجملة واحدة : سنقوم بإنشاء منتدى يحوي على مستخدمين يقوموا بإنشاء مواضيع بـ تصنيفات مختلفة ، المستخدمين الآخرين يمكنهم إضافة تعليق .وكما ترى ، لقد قمت بالتركيز على كلمات معينة لتمثل أسماء الجداول في قاعدة البيانات التي نريدها . المستخدمون users التصنيفات categories المواضيع topics التعليقات replies العناصر الثلاثة الأخيرة مرتبطة ببعضها البعض ، لذا سنقوم بعمل ذلك في تصميم الجدول . يمكن إنشاء قاعدة بيانات MySQL باستخدام أوامر Sql ، ولكننا هنا سنستخدم برنامج بواجهة رسومية ليسهل العملية ويجعلها مفهومة أكثر ، وممتعة أكثر . البرنامج هو Workbench ، يمكنك التعرف عليه أكثر من خلال هذه المشاركة ، ولكن ذلك غير مطلوب لفهم تكملة هذا الشرح .ألقِ نظرة على المخطط أدناهيبدو مرتباً أليس كذلك ؟ كل مربع هو عبارة عن جدول في قاعدة البيانات . جميع الأعمدة مدونة داخل كل جدول .. والخطوط بين الجداول تمثل العلاقة بينهم . سوف نشرح ذلك لاحقاً ، لا بأس إن لم تفهم الكثير الآن ..سوف نناقش كل جدول بشرح أوامر Sql . والتي تم إنشاءها تلقائياً مع إنشاء المخطط في الأعلى . لصنع كودك الخاص يمكنك إنشاء مخطط مشابه وستحصل على أوامر الـ Sql التي قامت بإنشاء المخطط أيضاً . بعض محررات قواعد البيانات مثل MySQL Workbench الذي قمنا بإستخدامه لإنتاج ذلك المخطط ينتج ملفات بلاحقة Sql أيضاً . ولكننا ننصح تعلم أوامر Sql حيث ستجد الأمر ممتعاً . لمقدمة حول Sql يمكنك قراءة المشاركة هنا .جدول المستخدمينCREATE TABLE users (user_idINT(8) NOT NULL AUTO_INCREMENT,user_nameVARCHAR (30) NOT NULL,user_passVARCHAR (255) NOT NULL,user_email VARCHAR (255) NOT NULL,user_dateDATETIME NOT NULL,user_level INT(8) NOT NULL,UNIQUE INDEX user_name_unique (user_name),PRIMARY KEY (user_id)) TYPE=INNODB;تستخدم عبار CREATE TABLE لإنشاء جدول جديد. يتبع هذه العبارة اسم الجدول المراد إنشاؤه، ويتم وضع جميع أعمدة الجدول بين قوسين. بالنسبة لأسماء الحقول فهي تشرح نفسها بنفسها، لذا سنناقش الآن أنواع البيانات فقط.user_idمفتاح أولي يستخدم لتعريف كل عمود في الجدول بشكل فريد (غير قابل للتكرار).نوع هذا الحقل هو INT، وهذا يعني أن الحقل يجب أن يحوي على عدد صحيح (غير عشري). ولا يمكن لهذا الحقل أن يكون فارغاً بما أننا استخدمنا عبارة (NOT NULL). يمكن أن ترى في أسفل الجدول أن حقل user_id تم تحديده على أنه مفتاح أولي (primary key). يستخدم المفتاح الأولي كما ذكرنا لتعريف كل عمود في الجدول بشكل فريد،أي لا يمكن لأي عمودين في الجدول أن يكون لهم نفس القيمة لهذا الحقل. الكلام غير واضح؟ بالمثال يزول الإشكال :لدينا مستخدم على سبيل المثال يدعى أحمد، إذا قام مستخدم آخر بالتسجيل وبنفس الاسم، فسيكون هناك مشكلة. ﻷنه لا يمكن التفريق بين أحمد هذا وأحمد ذاك. لا يمكنك التفريق ولا يمكن حتى لقاعدة البيانات حينها التفريق بينهم. يتم حل هذه المشكلة باستخدام المتاح الأولي (primary key) ، حيث سيعطى للاسمين رقم مختلف.جميع الجداول الأخرى تحوي على مفاتيح أولية وتعمل بنفس الطريقة.user_nameهذا حقل نصي (وليس رقمي كالحقل السابق). يدعي الحقل بلغة SQL حقل VARCHAR وهو أحد أنواع الحقول النصية. الرقم بين الأقواس هو أقصى طول لعدد الأحرف التي يمكن أن يتم إدخالها في الحقل. في حالتنا هذه يمكن للمستخدم اختيار اسم يبلغ طوله كحد أقصى 30 حرف. ولا يمكن لهذا الحقل أن يكون فارغاً (NOT NULL)، سترى أسفل الجدول أن هذا الحقل تم تحديده على أنه فريد (UNIQUE)، وهذا يعني أنه لا يمكن لشخصين التسجيل بنفس الاسم.الجزء الذي يحوي على عبارة UNIQUE INDEX يُخبر قاعدة البيانات أننا نريد إضافة مفتاح فريد (UNIQUE KEY)، بعدها قمنا بتحديد اسم المفتاح الفريد وهو هنا user_name_unique ، وبين الأقواس اسم الحقل الذي سينطبق المفتاح الفريد عليه (ليصبح غير قابل لتكرار قيمته مرتين في الجدول).user_passهذا الحقل نفس الحقل السابق، باستثناء الطول الأقصى له ، فبما أن كلمة سر المستخدم ومهما كان طولها سيتم تشفيرها لنوع تشفير sha1 ، فكلمة السر ستكون دائماً مع نوع التشفير هذا بطول 40 حرف.توضيح: حين تدخل أي كملة سر ولنفترض 123 أو لتكن mulham أو أي شيئ آخر ومهما يكن طول كلمة السر التي ستدخلها، يتم تطبيق تشفير لكلمة السر هذه قبل حفظها في قاعدة البيانات وذلك للأمان، بحيث اذا استطاع أحد ما بالوصول لقاعدة البيانات بالخطأ، فلن يتمكن من معرفة كلمات سر المستخدمين، وهناك أنواع كثير للتشفير منها هذا النوع sha1 والذي يحول أي كلمة سر ل 40 حرف (أحرف وأرقام)، وعند نموذج دخول المستخدم (بعد اشتراكه)، نطبق نفس نوع التشفير على كلمة السر المدخلة لنقارن قيمة تشفير الكلمة المدخلة مع قيمة التشفير المحفوظة في قاعدة البيانات، فإذا طابقها، ولج المستخدم للموقع بشكل صحيح.user_emailهذا الحقل هو تماماً نفس الحقل السابق (بالنسبة لقاعدة البيانات، أما لاحقاً عند عمل نموذج دخول بلغة HTML فيختلف الموضوع قليلاً )user_dateفي هذا الحقل يتم تخزين التاريخ الذي قام به المستخدم بالتسجيل. نوع هذا الحقل هو DATETIME ولا يمكن أن يكون فارغ. (يتم تعبئة الحقل تلقائياً بحسب توقيت السيرفر).user_levelيحوي هذا الحقل مستوى المستخدم، على سبيل المثال: 0 للمستخدم العادي و 1 للمدير. ستتعرف على المزيد لاحقاً.جدول التصنيفاتCREATE TABLE categories (cat_idINT(8) NOT NULL AUTO_INCREMENT,cat_nameVARCHAR (255) NOT NULL,cat_descriptionVARCHAR(255) NOT NULL,UNIQUE INDEX cat_name_unique (cat_name),PRIMARY KEY (cat_id)) TYPE=INNODBأنواع البيانات هنا تعمل بشكل أساسي بنفس الطريقة التي تعمل بها أنواع البيانات في جدول المستخدمين. يحوي هذا الجدول أيضاً مفتاح أولي ، واسم التصنيف يجب أن يكون فريد .جدول المواضيع CREATE TABLE topics (topic_idINT(8) NOT NULL AUTO_INCREMENT,topic_subjectVARCHAR(255) NOT NULL,topic_dateDATETIME NOT NULL,topic_catINT(8) NOT NULL,topic_byINT(8) NOT NULL,PRIMARY KEY (topic_id)) TYPE=INNODB;هذا الجدول تقريباً نفس الجداول السابقة، باستثناء حقل topic_by والذي يشير للمستخدم المنشئ للموضوع. وحقل topic_cat الذي يشير للتصنيف الذي يتبع الموضوع له. لا يمكن تحديد العلاقات بين هذه الحقول بذكر أسماء الحقول فقط. فيجب أن نُعلم قاعدة البيانات أن هذا الحقل (topic_by) يجب أن يحتوي على الرقم التسلسلي user_id لمستخدم موجود في جدول المستخدمين، والحقل الآخر (topic_cat) يجب أن يحتوي على الرقم التسلسلي cat_id لتصنيف موجود في جدول التصنيفات. سنضيف هذه العلاقات بين الحقول والجداول بعد مناقشة جدول التعليقات.جدول التعليقات CREATE TABLE posts (post_idINT(8) NOT NULL AUTO_INCREMENT,post_contentTEXT NOT NULL,post_dateDATETIME NOT NULL,post_topicINT(8) NOT NULL,post_byINT(8) NOT NULL,PRIMARY KEY (post_id)) TYPE=INNODB;هذا الجدول هو نفس بقية الجداول، ويوجد هنا أيضاً حقل يشير لرقم مستخدم user_id في جدول المستخدمين : حقل post_by ، حقل post_topic يشير للموضوع الذي يتبع التعليق له .المفتاح الخارجي foreign key هو قيد مرجعي بين جدولين. يُعرِّف المفتاح الخارجي عمود أو مجموعة أعمدة في جدول (مرجعي) والذي يشير لعمود أو مجموعة أعمدة في جدول (مرجعي) آخر .الآن وبعد تنفيذ هذه التعليمات وإنشاء الجداول. أصبح لدينا ترتيب بيانات جيد، ولكن العلاقات بين هذه البيانات مازالت مفقودة. لنبدأ بتعريف أحد هذه العلاقات. سوف نستخدم شيئ يدعي المفتاح الخارجي. بعض الشروط لهذا الاستخدام: العمود في الجدول المرجعي والذي يشير له المفتاح الخارجي يجب أن يكون مفتاح أولي. القيم المشار لها يجب أن تكون موجودة في الجدول المرجعي. أعرف أن كل هذه المصطلحات جديدة عليك، ولكنك ستكتشف أنها بسيطة جداً، هي فقط علاقة بين جدول وآخر ، ستتضح لك الأمور في السطور القادمة.بإضافة مفاتيح خارجية تصبح المعلومات مرتبطة ببعضها، وهذا مهم جداً في ترتيب قاعدة البيانات.الآن أصبحت تعرف نوعاً ما ما هو المفتاح الخارجي ولماذا نستخدمه. حان الوقت لإضافة مفاتيح خارجية للجداول التي أنشأناها باستخدام عبارة ALTER، والتي تستخدم لتعديل جدول موجود مسبقاً.سنقوم في البداية بربط المواضيع بالتصنيفات:ALTER TABLE topics ADD FOREIGN KEY(topic_cat) REFERENCES categories(cat_id) ON DELETE CASCADE ON UPDATE CASCADE;الجزء الأخير من التعليمة يوضح ما يجري. فعندما يتم حذف التصنيف من قاعدة البيانات، جميع المواضيع المرتبطة بهذا التصنيف سيتم حذفها أيضاً. إذا تم تغيير قيمة cat_id لتصنيف ما، جميع المواضيع المرتبطة بهذا التصنيف سيتم تحديثها أيضاً. وهذا ما تقوم به عبارة ON UPDATE CASCADE . بالطبع يمكنك التراجع عن ذلك لحماية بياناتك، وذلك بجعل حذف تنصيف ما غير ممكن ما زال هناك مواضيع مرتبطة بهذا التصنيف، إذا أردت القيام بذلك، فعليك استبدال ON DELETE CASCADE إلى ON DELETE RESTRICT . يوجد أيضاً عبارات SET NULL أي اجعله فارغاً و NO ACTION أي لا تقم بأي إجراء.الآن، كل موضوع أصبح مرتبط بتصنيف ما. لنقم بربط المواضيع بالمستخدمين المنشئين لهم. ALTER TABLE topics ADD FOREIGN KEY(topic_by) REFERENCES users(user_id) ON DELETE RESTRICT ON UPDATE CASCADE;المفتاح الخارجي هنا هو نفسه كسابقه، ولكن هناك فرق واحد: لا يمكن حذف المستخدم ما زال هناك مواضيع مرتبطة به، أو بالأحرى مرتبطة بـ user_id للمستخدم (رقمه التسلسلي في قاعدة البيانات). لم نضع هنا ON DELETE CASCADE ﻷننا لا نريد للمعلومات المرتبطة بحساب ما والتي قد تكون قيمة أن تُحذف عندما يقرر المستخدم حذف حسابه. لإبقاء خيار حذف الحساب متاحاً للمستخدمين، يجب أن تقوم بإنشاء ميزة تنقل المواضيع لحساب “مجهول” عند حذف مستخدم لحسابه. وفي الواقع هذا ليش موضوع نقاشنا في هذا الشرح.ربط التعليقات بالمواضيع: ALTER TABLE posts ADD FOREIGN KEY(post_topic) REFERENCES topics(topic_id) ON DELETE CASCADE ON UPDATE CASCADE;وأخيراً، ربط كل تعليق بالمستخدم المنشئ له:ALTER TABLE posts ADD FOREIGN KEY(post_by) REFERENCES users(user_id) ON DELETE RESTRICT ON UPDATE CASCADE;انتهى الجزء الخاص بقاعدة البيانات! لقد كان عملاً متعباً نوعاً ما، ولكن النتيجة تستحق هذا العمل، حيث حصلنا على قاعدة بيانات نموذجبة.ثانياً: مقدمة لنظام الترويسة/التذييلكل صفحة في منتدانا تتطلب بعض الأشياء الأساسية، مثل بعض الترميزات والتنسيقات. ولذا سنقوم بتضمين ملف الترويسة header.php بأعلى كل صفحة في المنتدى، والتذييل footer.php أسفل كل صفحة. يتضمن ملف الترويسة الترميزات الأساسية وروابط للملفات التي يجب تحميلها لعرض المنتدى بشكل جيد، وكذلك بعض المعلومات المهمة حول المنتدى، مثل العنوان والأيقونة والشعار..ملف الترويسة header.php&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Strict//EN&quot;&quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd&quot;&gt;&lt;html xmlns=&quot;http://www.w3.org/1999/xhtml&quot; xml:lang=&quot;nl&quot; lang=&quot;nl&quot;&gt;&lt;head&gt; &lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=UTF-8&quot; /&gt; &lt;meta name=&quot;description&quot; content=&quot;A short description.&quot; /&gt; &lt;meta name=&quot;keywords&quot; content=&quot;put, keywords, here&quot; /&gt; &lt;title&gt;PHP-MySQL forum&lt;/title&gt; &lt;link rel=&quot;stylesheet&quot; href=&quot;style.css&quot; type=&quot;text/css&quot;&gt;&lt;/head&gt;&lt;body&gt;&lt;h1&gt;My forum&lt;/h1&gt; &lt;div id=&quot;wrapper&quot;&gt; &lt;div id=&quot;menu&quot;&gt; &lt;a class=&quot;item&quot; href=&quot;/forum/index.php&quot;&gt;Home&lt;/a&gt; - &lt;a class=&quot;item&quot; href=&quot;/forum/create_topic.php&quot;&gt;Create a topic&lt;/a&gt; - &lt;a class=&quot;item&quot; href=&quot;/forum/create_cat.php&quot;&gt;Create a category&lt;/a&gt; &lt;div id=&quot;userbar&quot;&gt; &lt;div id=&quot;userbar&quot;&gt;Hello Example. Not you? Log out.&lt;/div&gt; &lt;/div&gt; &lt;div id=&quot;content&quot;&gt;سنستخدم وسم &lt;div id=&quot;wrapper&quot;&gt; لجعل تنسيق كامل الصفحة أسهل. الوسم &lt;div id=&quot;menu&quot;&gt; كما هو واضح يضم قائمة بروابط لصفحات الموقع التي سننشؤها لاحقاً. وسم &lt;div id=&quot;userbar&quot;&gt; سيستخدم كشريط علوي يضم معلومات مثل اسم المستخدم ورابط لتسجيل الخروج. والوسم الأخير سيحوي بشكل واضح المعلومات الفعلية للصفحة التي يكون بها المستخدم.إذا كنت تقرأ بانتباه، فربما لاحظت أننا فقدنا شيئاً ما. فلم ننهي وسمي &lt;html&gt; و &lt;body&gt; كما هو واجب في لغة html. أي لم نكتب في نهاية ملف الترويسة &lt;/body&gt; &gt;/html&gt;والسبب هو أننا سنضعهم في ملف التذييل footer.php :&lt;/div&gt;<!-- content -->&lt;/div&gt;<!-- wrapper -->&lt;div id=&quot;footer&quot;&gt;Created for Nettuts+&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;عندما نضمّن ملفي الترويسة والتذييل في كل صفحة، فإن محتوى الصفحة الفعلي سيظهر بين الترويسة (بداية الصفحة) والتذييل (نهاية الصفحة). لهذه الطريقة عدة فوائد. أولها وأهمها أن كل شيئ سيكون منسق بشكل صحيح. مثال سريع : &lt;?php$error = false;if($error = false){ //the beautifully styled content, everything looks good echo '&lt;div id=&quot;content&quot;&gt;some text&lt;/div&gt;';}else{ //bad looking, unstyled error :-( } ?&gt;كما ترى، إذا لم يحدث أخطاء في الصفحة فستظهر بشكل أنيق. أما اذا كان هناك خطأ، فكل شيئ سيكون مبعثر. ولهذا السبب يجب دائماً التأكد ليس من تنسيق المحتوى فقط، وإنما أيضاً من الأخطاء التي يمكن أن تحدث.ميزة أخرى لهذه الطريقة (تضمين ملفي الترويسة والتذييل) هو إمكانية عمل تغييرات سريعة. فسترى أنك وبعد إنهاء هذا الشرح إذا أردت التعديل على ملف التذييل مثلاً footer.php، فسترى أن التذييل سينطبق مباشرة على كل صفحة في المنتدى.أخيراً سوف نقوم بإضافة بعض التنسيقات والتي تزودنا بإظهارات وترميزات أساسية. لا شيئ معقد هنا، ولا داعي لفهم الكود.body { background-color: #4E4E4E; text-align: center; /* make sure IE centers the page too */} #wrapper { width: 900px; margin: 0 auto; /* center the page */} #content { background-color: #fff; border: 1px solid #000; float: left; font-family: Arial; padding: 20px 30px; text-align: left; width: 100%; /* fill up the entire div */} #menu { float: left; border: 1px solid #000; border-bottom: none; /* avoid a double border */ clear: both; /* clear:both makes sure the content div doesn't float next to this one but stays under it */ width:100%; height:20px; padding: 0 30px; background-color: #FFF; text-align: left; font-size: 85%;} #menu a:hover { background-color: #009FC1;} #userbar { background-color: #fff; float: right; width: 250px;} #footer { clear: both;} /* begin table styles */table { border-collapse: collapse; width: 100%;} table a { color: #000;} table a:hover { color:#373737; text-decoration: none;} th { background-color: #B40E1F; color: #F0F0F0;} td { padding: 5px;} /* Begin font styles */h1, #footer { font-family: Arial; color: #F1F3F1;} h3 {margin: 0; padding: 0;} /* Menu styles */.item { background-color: #00728B; border: 1px solid #032472; color: #FFF; font-family: Arial; padding: 3px; text-decoration: none;} .leftpart { width: 70%;} .rightpart { width: 30%;} .small { font-size: 75%; color: #373737;}#footer { font-size: 65%; padding: 3px 0 0 0;} .topic-post { height: 100px; overflow: auto;} .post-content { padding: 30px;} textarea { width: 500px; height: 200px;}ثالثاً: البدء بالتنفيذ الفعليقبل أن نستطيع قراءة أي شيئ من قاعدة البيانات، يجب أن نقيم اتصال بها. وهذا ما سيقوم به ملف connect.php الذي سنضمنه بكل ملف ننشؤه.&lt;?php//connect.php$server = 'localhost';$username = 'usernamehere';$password = 'passwordhere';$database = 'databasenamehere'; if(!mysql_connect($server, $username, $password)){ exit('Error: could not establish database connection');}if(!mysql_select_db($database){ exit('Error: could not select the database');}?&gt;ببساطة استبدل فقط القيم الافتراضية للمتغيرات في أعلى الكود ببياناتك الخاصة. احفظ الملف ودعنا ننطلق للكملة.رابعاً: عرض المنتدىبما أننا بدأنا بتقنيات أساسية، سنقوم بعمل طريقة عرض مبسطة للمنتدى الآن.&lt;?php//create_cat.phpinclude 'connect.php';include 'header.php'; echo '&lt;tr&gt;'; echo '&lt;td class=&quot;leftpart&quot;&gt;'; echo '&lt;h3&gt;&lt;a href=&quot;category.php?id=&quot;&gt;Category name&lt;/a&gt;&lt;/h3&gt; Category description goes here'; echo '&lt;/td&gt;'; echo '&lt;td class=&quot;rightpart&quot;&gt;'; echo '&lt;a href=&quot;topic.php?id=&quot;&gt;Topic subject&lt;/a&gt; at 10-10'; echo '&lt;/td&gt;';echo '&lt;/tr&gt;';include 'footer.php';?&gt;الآن اكتمل منتداك تقريباً. بفتحك لهذا الملف من السيرفر ستشاهد المنتدى بشكل أنيق وبسيط. سنقوم خلال بقية الشرح بتحديث هذا الملف لنحصل على النتيجة النهائية، خطوة بخطوة!خامساً: اشتراك مستخدمدعنا الآن ننشئ نموذج اشتراك بسيط بلغة html حيث يمكن للمستخدمين الاشتراك بالمنتدىسنحتاج أيضاً لصفحة بلغة php لإرسال بيانات النموذج لقاعدة البيانات وإتمام اشتراك المستخدم. سنقوم باستخدام المتغير $_SERVER .المتغير $_SERVER يحوي مجموعة من القيم التي يتم تعيينها تلقائياً مع كل طلب. أحد هذه القيم هو REQUEST_METHOD . عندما يتم طلب صفحة بواسطة GET . فسيحمل هذا المتغير القيمة GET . وعندما يتم طلب الصفحة بواسطة POST ، فسيحمل المتغير القيمة POST . ولذا سنستخدم هذا المتغير لمعرفة إذا تم إرسال النموذج (بواسطة POST). انظر صفحة الاشتراك signup.php أدناه&lt;?php//signup.phpinclude 'connect.php';include 'header.php'; echo '&lt;h3&gt;Sign up&lt;/h3&gt;'; if($_SERVER['REQUEST_METHOD'] != 'POST'){ /*the form hasn't been posted yet, display it note that the action=&quot;&quot; will cause the form to post to the same page it is on */ echo '&lt;form method=&quot;post&quot; action=&quot;&quot;&gt; Username: &lt;input type=&quot;text&quot; name=&quot;user_name&quot; /&gt; Password: &lt;input type=&quot;password&quot; name=&quot;user_pass&quot;&gt; Password again: &lt;input type=&quot;password&quot; name=&quot;user_pass_check&quot;&gt; E-mail: &lt;input type=&quot;email&quot; name=&quot;user_email&quot;&gt; &lt;input type=&quot;submit&quot; value=&quot;Add category&quot; /&gt; &lt;/form&gt;';}else{ /* so, the form has been posted, we'll process the data in three steps: 1. Check the data 2. Let the user refill the wrong fields (if necessary) 3. Save the data */ $errors = array(); /* declare the array for later use */ if(isset($_POST['user_name'])) { //the user name exists if(!ctype_alnum($_POST['user_name'])) { $errors[] = 'The username can only contain letters and digits.'; } if(strlen($_POST['user_name']) &gt; 30) { $errors[] = 'The username cannot be longer than 30 characters.'; } } else { $errors[] = 'The username field must not be empty.'; } if(isset($_POST['user_pass'])) { if($_POST['user_pass'] != $_POST['user_pass_check']) { $errors[] = 'The two passwords did not match.'; } } else { $errors[] = 'The password field cannot be empty.'; } if(!empty($errors)) /*check for an empty array, if there are errors, they're in this array (note the ! operator)*/ { echo 'Uh-oh.. a couple of fields are not filled in correctly..'; echo '&lt;ul&gt;'; foreach($errors as $key =&gt; $value) /* walk through the array so all the errors get displayed */ { echo '&lt;li&gt;' . $value . '&lt;/li&gt;'; /* this generates a nice error list */ } echo '&lt;/ul&gt;'; } else { //the form has been posted without, so save it //notice the use of mysql_real_escape_string, keep everything safe! //also notice the sha1 function which hashes the password $sql = &quot;INSERT INTO users(user_name, user_pass, user_email ,user_date, user_level) VALUES('&quot; . mysql_real_escape_string($_POST['user_name']) . &quot;', '&quot; . sha1($_POST['user_pass']) . &quot;', '&quot; . mysql_real_escape_string($_POST['user_email']) . &quot;', NOW(), 0)&quot;; $result = mysql_query($sql); if(!$result) { //something went wrong, display the error echo 'Something went wrong while registering. Please try again later.'; //echo mysql_error(); //debugging purposes, uncomment when needed } else { echo 'Successfully registered. You can now &lt;a href=&quot;signin.php&quot;&gt;sign in&lt;/a&gt; and start posting! :-)'; } }} include 'footer.php';?&gt;العديد من التوضيحات ستجدها في التعليقات الموضوعة ضمن الكود، لذا تأكد من قراءتها. معالجة البيانات تتم على ثلاثة مراحل:التأكد من البياناتاذا لم تكن البيانات صحيحة ومعبئة بشكل كامل، اعرض النموذج مرة أخرى.اذا كانت جميع البيانات صحيحة ومعبئة، احفظ البيانات في قاعدة البيانات.(ماذا تقصد بالتأكد من صحة البيانات اذا كانت البيانات تُدخل ﻷول مرة؟ أقصد بذلك أن هناك حقل مثلاً ليضع المستخدم بريده الإلكتروني، يتم تعريف هذا الحقل بلغة html على أنه بريد إلكتروني، يجب أن يحوي على @ و نقطة ثم كوم أو نت أو أياً كان، إذا لم تكن البيانات المدخلة في هذا الحقل بالشكل المذكور، فالمستخدم في الواقع لم يدخل بريد إلكتروني فعلاً، وهناك بالتالي بيانات غير صحيحة في النموذج)الجزء المتعلق بـ php على كل حال يشرح نفسه بنفسه، يبقى تعليمات SQL التي تحتاج بعض الشرح.INSERT INTO users(user_name, user_pass, user_email ,user_date, user_level)VALUES('&quot; . mysql_real_escape_string($_POST['user_name']) . &quot;', '&quot; . sha1($_POST['user_pass']) . &quot;', '&quot; . mysql_real_escape_string($_POST['user_email']) . &quot;', NOW(), 0);في السطر الأول لدينا عبارة INSERT INTO التي تستخدم لإضافة بيانات لقاعدة البيانات، وتم تحديد اسم الجدول في السطر الثاني. الكلمات التي بين قوسين تحدد أسماء الأعمدة التي نريد إدراج البيانات لها. عبارة VALUES تُخبر قاعدة البيانات أننا انتهينا من تحديد أسماء الأعمدة وجاء وقت تحديد القيم التي ستُضاف لهذه الأعمدة. ولدينا شيئ جديد هنا: mysql_real_escape_string. تستخدم هذه التعليمة لحماية بيانات المستخدم أثناء إرساله للنموذج، ويجب أن تُستخدم دائماً باستثاء بعض الحالات النادرة. السكريبتات التي لا تستخدم هذه التعليمة يكون اختراقها والوصول لبيانات النموذج المرسلة سهل جداً، فلا تخاطر بذلك واستخدم عبارة mysql_real_escape_string(). إيّاك أن تُدرج كلمة السر في قاعدة البيانات كما هي. يجب عليك دائماً تشفيرها.كما رأيت ، لقد قمنا باستخدام عبارة sha1() لتشفير كلمة سر المستخدم قبل حفظها في قاعدة البيانات، تذكر دائماً عمل هذه الخطوة في كل نموذج تقوم بعمله ويحوي على كلمة سر. فلو فرضنا أن أحد المخترقين قام بالوصول لقاعدة البيانات، وكانت كلمات السر غير مشفرة، فسيصبح بإمكانه الولوج لحساب أي مستخدم أو أي مدير في المنتدى وعمل ما يحلو له، أما لو كانت كلمات السر مشفرة فلن يتمكن من فعل ذلك قبل أن يفك تشفيرهم، وهذا مستحيل تقريباً . من الممكن استخدام أي نوع تشفير آخر بدلاً من sha1() ، مثل md5() . أنا استخدم النوع sha1() ﻷن المقاييس أثبتت أن هذا النوع أسرع بقليل.اذا نجحت عملية الاشتراك فستحصل على التاليقم بتحديث صفحة قاعدة البيانات في phpMyAdmin ، يجب أن ترى تسجيلاً جديداً في جدول المستخدمين usersسادساً: إضافة التفعيل ومستوى المستخدمإن من المزايا الهامة في المنتدى هو الفرق بين المستخدم العادي والمدير/المشرف. وبما أننا نناقش هنا منتجى صغير وبسيط وأن إضافة مزايا سيأخذ وقتاً طويلاً، فسنركز هنا على عملية تسجيل الدخول وإضافة بعض المزايا للمدراء مثل إضافة تصنيفات جديدة وإغلاق نقاش.والآن بعد إكمال الخطوة السابقة، سنقوم بجعل الحساب الذي أنشأته للتو حساب مدير. اذهب لـ phpMyAdmin واضغط على جدول المستخدمين users ثم اضغط على خيار Browse . سيظهر لك الحساب الذي أنشأته، اضغط على أيقونة التعديل edit وقم بتغيير قيمة الحقل user_level من 0 إلى 1 .حالياً لن تلاحظ أي فرق في المنتدى، ولكن عندما نضيف مزايا المدير سيصبح هناك فروقات في الصلاحيات بين الحساب العادي وهذا الحساب.عملية تسجيل الدخول تعمل كالتالي: يقوم الزائر بإدخال بيانات المستخدم ويرسل النموذج. إذا كان اسم المستخدم وكلمة السر المدخلين صحيحين، فيمكن الآن بدء الجلسة (session)اذا كان اسم المستخدم أو كلمة المرور غير صحيحين، نقوم بإظهار النموذج مرة أخرى مع رسالة خطأ. بالأسفل ملف تسجيل الدخول signin.php . اطلع على التعليقات ضمن الكود لفهم ما يجري &lt;?php//signin.phpinclude 'connect.php';include 'header.php'; echo '&lt;h3&gt;Sign in&lt;/h3&gt;'; //first, check if the user is already signed in. If that is the case, there is no need to display this pageif(isset($_SESSION['signed_in']) &amp;&amp; $_SESSION['signed_in'] == true){ echo 'You are already signed in, you can &lt;a href=&quot;signout.php&quot;&gt;sign out&lt;/a&gt; if you want.';}else{ if($_SERVER['REQUEST_METHOD'] != 'POST') { /*the form hasn't been posted yet, display it note that the action=&quot;&quot; will cause the form to post to the same page it is on */ echo '&lt;form method=&quot;post&quot; action=&quot;&quot;&gt; Username: &lt;input type=&quot;text&quot; name=&quot;user_name&quot; /&gt; Password: &lt;input type=&quot;password&quot; name=&quot;user_pass&quot;&gt; &lt;input type=&quot;submit&quot; value=&quot;Sign in&quot; /&gt; &lt;/form&gt;'; } else { /* so, the form has been posted, we'll process the data in three steps: 1. Check the data 2. Let the user refill the wrong fields (if necessary) 3. Varify if the data is correct and return the correct response */ $errors = array(); /* declare the array for later use */ if(!isset($_POST['user_name'])) { $errors[] = 'The username field must not be empty.'; } if(!isset($_POST['user_pass'])) { $errors[] = 'The password field must not be empty.'; } if(!empty($errors)) /*check for an empty array, if there are errors, they're in this array (note the ! operator)*/ { echo 'Uh-oh.. a couple of fields are not filled in correctly..'; echo '&lt;ul&gt;'; foreach($errors as $key =&gt; $value) /* walk through the array so all the errors get displayed */ { echo '&lt;li&gt;' . $value . '&lt;/li&gt;'; /* this generates a nice error list */ } echo '&lt;/ul&gt;'; } else { //the form has been posted without errors, so save it //notice the use of mysql_real_escape_string, keep everything safe! //also notice the sha1 function which hashes the password $sql = &quot;SELECT user_id, user_name, user_level FROM users WHERE user_name = '&quot; . mysql_real_escape_string($_POST['user_name']) . &quot;' AND user_pass = '&quot; . sha1($_POST['user_pass']) . &quot;'&quot;; $result = mysql_query($sql); if(!$result) { //something went wrong, display the error echo 'Something went wrong while signing in. Please try again later.'; //echo mysql_error(); //debugging purposes, uncomment when needed } else { //the query was successfully executed, there are 2 possibilities //1. the query returned data, the user can be signed in //2. the query returned an empty result set, the credentials were wrong if(mysql_num_rows($result) == 0) { echo 'You have supplied a wrong user/password combination. Please try again.'; } else { //set the $_SESSION['signed_in'] variable to TRUE $_SESSION['signed_in'] = true; //we also put the user_id and user_name values in the $_SESSION, so we can use it at various pages while($row = mysql_fetch_assoc($result)) { $_SESSION['user_id'] = $row['user_id']; $_SESSION['user_name'] = $row['user_name']; $_SESSION['user_level'] = $row['user_level']; } echo 'Welcome, ' . $_SESSION['user_name'] . '. &lt;a href=&quot;index.php&quot;&gt;Proceed to the forum overview&lt;/a&gt;.'; } } } }} include 'footer.php';?&gt;كما لاحظت، هذه هي تعليمات SQL في الكود السابق SELECT user_id, user_name, user_levelFROM usersWHERE user_name = '&quot; . mysql_real_escape_string($_POST['user_name']) . &quot;'AND user_pass = '&quot; . sha1($_POST['user_pass'])من الواضح أننا نقوم بالتأكد من البيانات المدخلة إذا كانت لمستخدم موجود بالفعل. هناك العديد من السكريبتات التي تستخرج كلمة السر من قاعدة البيانات وتقارنها مع تلك المدخلة في النموذج باستخدام php. ولكن القيام بذلك بواسطة تعليمات SQL مباشرة سيجعل العملية أكثر أمناً حيث أن العملية هذه تحصل في وسط قاعدة البيانات وليس ضمن تطبيقنا الوب (منتدانا).إذا قام المستخدم بتسجيل الدخول بشكل صحيح، فسنقوم بعمل بضعة أشياء: &lt;?php//set the $_SESSION['signed_in'] variable to TRUE$_SESSION['signed_in'] = true;//we also put the user_id and user_name values in the $_SESSION, so we can use it at various pageswhile($row = mysql_fetch_assoc($result)){ $_SESSION['user_id'] = $row['user_id']; $_SESSION['user_name'] = $row['user_name']; }?&gt;في البداية، قمنا بإعطاء المتغير $_SESSION['signed_in'] القيمة true أي أننا بدأنا الجلسة والمستخدم الآن مسجل الدخول. وسنقوم باستخدام هذا المتغير في صفحات أخرى للتأكد من أن المستخدم مسجل الدخول. أيضاً قمنا بوضع اسم المستخدم username ومعرفه user_id في المتغير $_SESSION للاستخدام في صفحات أخرى. أخيراً، سنقوم بعرض رابط لرئيسية المنتدى حيث يمكن للمستخدم البدء في الإبحار.تسجيل الدخول بالطبع يتطلب وظيفة أخرى وهي تسجيل الخروج! في الواقع عملية تسجيل الخروج أسهل بكثير من عملية تسجيل الدخول، فبما أن جميع المعلومات مخزنة في متغيرات $_SESSION ، فكل ما علينا فعله هو إلغاء تعيينهم في هذا المتغير وعرض رسالة للمستخدم.الآن قمنا بضبط متغيرات $_SESSION ، يمكننا تحديد اذا كان شخص ما مسجل الدخول. دعنا نقوم الآن بعمل تغيير أخير على ملف الترويسة header.phpقم باستبدال التالي في الملف:&lt;div id=&quot;userbar&quot;&gt;Hello Example. Not you? Log out.&lt;/div&gt;إلى : &lt;?php&lt;div id=&quot;userbar&quot;&gt; if($_SESSION['signed_in']) { echo 'Hello' . $_SESSION['user_name'] . '. Not you? &lt;a href=&quot;signout.php&quot;&gt;Sign out&lt;/a&gt;'; } else { echo '&lt;a href=&quot;signin.php&quot;&gt;Sign in&lt;/a&gt; or &lt;a href=&quot;sign up&quot;&gt;create an account&lt;/a&gt;.'; }&lt;/div&gt;وبالتالي، إذا قام المستخدم بتسجيل الدخول، فسيرى اسمه معروض في بداية الصفحة مع رابط لصفحة تسجيل الخروج.نجحت طريقة التفعيل! والآن يبدو منتدانا كالتالي :سابعاً: إنشاء تصنيفنحن نريد إنشاء تصانيف في المنتدى، لذا دعنا ننشئ نموذج لهذه العملية&lt;form method=&quot;post&quot; action=&quot;&quot;&gt; Category name: &lt;input type=&quot;text&quot; name=&quot;cat_name&quot; /&gt; Category description: &lt;textarea name=&quot;cat_description&quot; /&gt;&lt;/textarea&gt; &lt;input type=&quot;submit&quot; value=&quot;Add category&quot; /&gt; &lt;/form&gt;تبدو هذه الخطوة مثل الخطوة الرابعة (اشتراك مستخدم). لذا لن أقوم بالشرح هنا ، فبما أنك متابع للخطوات فستكون قادراً على فهم الأمور بشكل سريع.سنقوم تضمين النموذج في الأعلى ضمن صفحة إنشاء تصنيف :&lt;?php//create_cat.phpinclude 'connect.php'; if($_SERVER['REQUEST_METHOD'] != 'POST'){ //the form hasn't been posted yet, display it echo '&lt;form method='post' action=''&gt; Category name: &lt;input type='text' name='cat_name' /&gt; Category description: &lt;textarea name='cat_description' /&gt;&lt;/textarea&gt; &lt;input type='submit' value='Add category' /&gt; &lt;/form&gt;';}else{ //the form has been posted, so save it $sql = ìINSERT INTO categories(cat_name, cat_description) VALUES('' . mysql_real_escape_string($_POST['cat_name']) . ì', '' . mysql_real_escape_string($_POST['cat_description']) . ì')'; $result = mysql_query($sql); if(!$result) { //something went wrong, display the error echo 'Error' . mysql_error(); } else { echo 'New category successfully added.'; }}?&gt;وكما ترى، لقد بدأنا السكريبت بفحص السيرفر $_SERVER ، بعد التأكد من أن المستخدم لديه صلاحيات المدير، والمطلوبة لإنشاء تصنيف، يتم عرض النموذج إذا لم يتم تعبئته وإرساله سابقاً، وإذا تم إرساله، يتم حفظ القيم. مرة أخرى ، يتم تحضير تعليمة SQL وتنفيذها.ثامناً: إضافة تصنيفات للصفحة الرئيسية index.phpلقد قمنا بإنشاء بعض التصنيفات، ويمكننا الآن عرضهم في الصفحة الرئيسية. دعنا نضيف تعليمة SQL التالية لمنظقة المحتوى في الصفحة الرئيسية index.phpSELECT categories.cat_id, categories.cat_name, categories.cat_description,FROM categoriesتقوم هذه التعليمة بتحديد جميع التصنيفات وأسمائهم ووصفهم من جدول التصنيفات. سنحتاج الآن لبضعة أسطر php لعرض النتائج. إذا قمنا بإضافة التعليمة كما فعلنا في الخطوات السابقة، فسيبدو الكود على الشكل:&lt;?php//create_cat.phpinclude 'connect.php';include 'header.php'; $sql = &quot;SELECT cat_id, cat_name, cat_description, FROM categories&quot;; $result = mysql_query($sql); if(!$result){ echo 'The categories could not be displayed, please try again later.';}else{ if(mysql_num_rows($result) == 0) { echo 'No categories defined yet.'; } else { //prepare the table echo '&lt;table border=&quot;1&quot;&gt; &lt;tr&gt; &lt;th&gt;Category&lt;/th&gt; &lt;th&gt;Last topic&lt;/th&gt; &lt;/tr&gt;'; while($row = mysql_fetch_assoc($result)) { echo '&lt;tr&gt;'; echo '&lt;td class=&quot;leftpart&quot;&gt;'; echo '&lt;h3&gt;&lt;a href=&quot;category.php?id&quot;&gt;' . $row['cat_name'] . '&lt;/a&gt;&lt;/h3&gt;' . $row['cat_description']; echo '&lt;/td&gt;'; echo '&lt;td class=&quot;rightpart&quot;&gt;'; echo '&lt;a href=&quot;topic.php?id=&quot;&gt;Topic subject&lt;/a&gt; at 10-10'; echo '&lt;/td&gt;'; echo '&lt;/tr&gt;'; } }} include 'footer.php';?&gt;لاحظ كيف استخدمنا حقل cat_id لإنشاء روابط لصفحة category.php . جميع الروابط لهذه السفحة ستبدو على الشكل: category.php?cat_id=xحيث x يمكن أن يكون أي قيمة عددية بحسب التصنيف .تاسعاً: إنشاء موضوعسنقوم في هذه الخطوة بجمع التقنيات التي تعلمناها في الخطوات السابقة. حيث سنقوم بالتأكد من أن المستخدم مسجل الدخول، سنقوم باستخدام تعليمة SQL لإنشاء موضوع ، وسننشئ نموذج html بسيط كواجهة مستخدم لإنشاء الموضوع.إن هيكلية ملف إنشاء الموضوع create_topic.php من الصعب شرحها ضمن قائمة أو ما شابه، لذا قمت بكتابة شرح للهيكل العام للملف كتوضيح:&lt;?phpif(user is signed in){ //the user is not signed in}else{ //the user is signed in if(form has not been posted) { //show form } else { //process form }}?&gt;وهذا هو الكود الحقيقي لهذا القسم من المنتدى ، راجع الشرح أسفل الكود لفهم ما يجري .&lt;?php//create_cat.phpinclude 'connect.php';include 'header.php'; echo '&lt;h2&gt;Create a topic&lt;/h2&gt;';if($_SESSION['signed_in'] == false){ //the user is not signed in echo 'Sorry, you have to be &lt;a href=&quot;/forum/signin.php&quot;&gt;signed in&lt;/a&gt; to create a topic.';}else{ //the user is signed in if($_SERVER['REQUEST_METHOD'] != 'POST') { //the form hasn't been posted yet, display it //retrieve the categories from the database for use in the dropdown $sql = &quot;SELECT cat_id, cat_name, cat_description FROM categories&quot;; $result = mysql_query($sql); if(!$result) { //the query failed, uh-oh :-( echo 'Error while selecting from database. Please try again later.'; } else { if(mysql_num_rows($result) == 0) { //there are no categories, so a topic can't be posted if($_SESSION['user_level'] == 1) { echo 'You have not created categories yet.'; } else { echo 'Before you can post a topic, you must wait for an admin to create some categories.'; } } else { echo '&lt;form method=&quot;post&quot; action=&quot;&quot;&gt; Subject: &lt;input type=&quot;text&quot; name=&quot;topic_subject&quot; /&gt; Category:'; echo '&lt;select name=&quot;topic_cat&quot;&gt;'; while($row = mysql_fetch_assoc($result)) { echo '&lt;option value=&quot;' . $row['cat_id'] . '&quot;&gt;' . $row['cat_name'] . '&lt;/option&gt;'; } echo '&lt;/select&gt;'; echo 'Message: &lt;textarea name=&quot;post_content&quot; /&gt;&lt;/textarea&gt; &lt;input type=&quot;submit&quot; value=&quot;Create topic&quot; /&gt; &lt;/form&gt;'; } } } else { //start the transaction $query = &quot;BEGIN WORK;&quot;; $result = mysql_query($query); if(!$result) { //Damn! the query failed, quit echo 'An error occured while creating your topic. Please try again later.'; } else { //the form has been posted, so save it //insert the topic into the topics table first, then we'll save the post into the posts table $sql = &quot;INSERT INTO topics(topic_subject, topic_date, topic_cat, topic_by) VALUES('&quot; . mysql_real_escape_string($_POST['topic_subject']) . &quot;', NOW(), &quot; . mysql_real_escape_string($_POST['topic_cat']) . &quot;, &quot; . $_SESSION['user_id'] . &quot; )&quot;; $result = mysql_query($sql); if(!$result) { //something went wrong, display the error echo 'An error occured while inserting your data. Please try again later.' . mysql_error(); $sql = &quot;ROLLBACK;&quot;; $result = mysql_query($sql); } else { //the first query worked, now start the second, posts query //retrieve the id of the freshly created topic for usage in the posts query $topicid = mysql_insert_id(); $sql = &quot;INSERT INTO posts(post_content, post_date, post_topic, post_by) VALUES ('&quot; . mysql_real_escape_string($_POST['post_content']) . &quot;', NOW(), &quot; . $topicid . &quot;, &quot; . $_SESSION['user_id'] . &quot; )&quot;; $result = mysql_query($sql); if(!$result) { //something went wrong, display the error echo 'An error occured while inserting your post. Please try again later.' . mysql_error(); $sql = &quot;ROLLBACK;&quot;; $result = mysql_query($sql); } else { $sql = &quot;COMMIT;&quot;; $result = mysql_query($sql); //after a lot of work, the query succeeded! echo 'You have successfully created &lt;a href=&quot;topic.php?id='. $topicid . '&quot;&gt;your new topic&lt;/a&gt;.'; } } } }} include 'footer.php';?&gt;سأناقش هذه الصفحة على قسمين: عرض النموذج ومعالجة النموذج.عرض النموذجلعرض النموذج فإننا نبدأ بتعليمات html بسيطة، ولكن في الواقع هناك شيئ خاص، ﻷننا نستخدم قائمة منسدلة، هذه القائمة المنسدلة يتم تعبئتها من خلال بيانات موجودة في قاعدة البيانات، يتم استخراج تلك البيانات باستخدام تعليمات SQL :SELECT cat_id, cat_name, cat_descriptionFROM categoriesأعتقد أن هذا هو الجزء الغير واضح هنا، والآن كما ترى هو مجرد كود بسيط .معالجة النموذجعملية حفظ الموضوع تتضمن مرحلتين: حفظ الموضوع في جدول المواضيع ضمن قاعدة البيانات، وحفظ أول تعليق في جدول التعليقات. وهذا يتطلب شيئ متقدم نوعاً ما وخارج موضوعنا هنا تقريباً، وهو يدعى إجراء transaction ، ويُقصد به أننا نبدأ بتنفيذ أمر البدء ثم التراجع إذا كان هناك أخطاء في قاعدة البيانات أو إنهاء التنفيذ عندما يجري كل شيئ بشكل صحيح.&lt;?php//start the transaction$query = &quot;BEGIN WORK;&quot;;$result = mysql_query($query);//stop the transaction$sql = &quot;ROLLBACK;&quot;;$result = mysql_query($sql);//commit the transaction$sql = &quot;COMMIT;&quot;;$result = mysql_query($sql);?&gt;أول تعليمة تستخدم لحفظ ابيانات هو تعليمة إنشاء موضوع، والتي تبدو على الشكل التالي :INSERT INTO topics(topic_subject, topic_date, topic_cat, topic_by)VALUES('&quot; . mysql_real_escape_string($_POST['topic_subject']) . &quot;', NOW(), &quot; . mysql_real_escape_string($_POST['topic_cat']) . &quot;, &quot; . $_SESSION['user_id'] . &quot;)في البداية تم تعريف الحقول، ثم القيم ليتم إدراجها في الحقول. لقد رأيت مثل هذه التعليمات سابقاً، حيث أنها مجرد تعليمات يتم تأمينها استخدام العبارة musql_real_escape_string() . القيمة الثانية : NOW() هي وظيفة في SQL لإدارج الوقت الحالي. القيمة الثالثة هي التي لم ترها من قبل، وهي تشير إلى معرف id صالح لتصنيف ما. والقيمة الأخيرة تشير لمعرف id مستخدم موجود بالفعل، وهو في حالتنا هي قيمة المتغير $_SESSION['user_id']. خيث تم مناقشة هذا المتغير خلال خطوة تسجيل الدخول .إذا تم تنفيذ الكود بدون أخطاء، فيتم الانتقال للخطوة التالية. تذكر أننا ما زالنا نجري إجراءاً هنا transaction . إذا حصلنا على أخطاء فسنستخدم تعليمة ROLLBACK.INSERT INTO posts(post_content, post_date, post_topic, post_by)VALUES ('&quot; . mysql_real_escape_string($_POST['post_content']) . &quot;', NOW(), &quot; . $topicid . &quot;, &quot; . $_SESSION['user_id'] . &quot;)إن أول شيئ نفعله هنا هو استخدام تعليمة mysql_insert_id() للحصول على آخر id تم توليده من حقل topic_id في جدول المواضيع. وكما وجدت في الخطوات الأولى، يتم توليد الـ id في قاعدة البيانات باستخدام تعليمة auto_increment.ثم يتم إدراج المنشور في جدول المنشورات post table. تبدو هذه العملية مشابهة لعملية المواضيع، الفرق الوحيد بينهما هو أن المنشور يشير إلى الموضوع والموضوع يشير للتصنيف. لقد قررنا من البداية إنشاء تصميم بيانات جيد، وهذه هي النتيجة.عاشراً : عرض التصنيفاتسوف نقوم بعمل صفحة عرض لتصنيف محدد. لقد أنشأنا تصنيفاً للتو ، ومن المفضل توفير إمكانية مشاهدة جميع المواضيع التي تتبع لهذا التصنيف. أولاً قم بإنشاء صفحة باسم category.phpنحتاج هنا لعدة أمور:1.أمور نحتاجها لعرض التصنيف: cat_name (اسم التصنيف) cat_description (وصف التصنيف) 2.أمور نحتاجها لعرض المواضيع ضمن ذلك التصنيف: topic_id (معرف الموضوع) topic_subject (عنوان الموضوع) topic_date (تاريخ الموضوع) topic_cat (تصنيف الموضوع) لنقم الآن بإنشاء تعليمتي SQL والتي تقوم باستخراج البيانات الني نريدها تحديداً من قاعدة البياناتSELECT cat_id, cat_name, cat_descriptionFROM categoriesWHERE cat_id = &quot; . mysql_real_escape_string($_GET['id'])تقوم التعليمة أعلاه باستخراج جميع التصنيفات من قاعدة البياناتSELECT topic_id, topic_subject, topic_date, topic_catFROM topicsWHERE topic_cat = &quot; . mysql_real_escape_string($_GET['id'])والآن ، الكود الكامل لملف category.php سيكون على الشكل التالي&lt;?php//create_cat.phpinclude 'connect.php';include 'header.php'; //first select the category based on $_GET['cat_id']$sql = &quot;SELECT cat_id, cat_name, cat_description FROM categories WHERE cat_id = &quot; . mysql_real_escape_string($_GET['id']); $result = mysql_query($sql); if(!$result){ echo 'The category could not be displayed, please try again later.' . mysql_error();}else{ if(mysql_num_rows($result) == 0) { echo 'This category does not exist.'; } else { //display category data while($row = mysql_fetch_assoc($result)) { echo '&lt;h2&gt;Topics in ′' . $row['cat_name'] . '′ category&lt;/h2&gt;'; } //do a query for the topics $sql = &quot;SELECT topic_id, topic_subject, topic_date, topic_cat FROM topics WHERE topic_cat = &quot; . mysql_real_escape_string($_GET['id']); $result = mysql_query($sql); if(!$result) { echo 'The topics could not be displayed, please try again later.'; } else { if(mysql_num_rows($result) == 0) { echo 'There are no topics in this category yet.'; } else { //prepare the table echo '&lt;table border=&quot;1&quot;&gt; &lt;tr&gt; &lt;th&gt;Topic&lt;/th&gt; &lt;th&gt;Created at&lt;/th&gt; &lt;/tr&gt;'; while($row = mysql_fetch_assoc($result)) { echo '&lt;tr&gt;'; echo '&lt;td class=&quot;leftpart&quot;&gt;'; echo '&lt;h3&gt;&lt;a href=&quot;topic.php?id=' . $row['topic_id'] . '&quot;&gt;' . $row['topic_subject'] . '&lt;/a&gt;&lt;h3&gt;'; echo '&lt;/td&gt;'; echo '&lt;td class=&quot;rightpart&quot;&gt;'; echo date('d-m-Y', strtotime($row['topic_date'])); echo '&lt;/td&gt;'; echo '&lt;/tr&gt;'; } } } }} include 'footer.php';?&gt;وهذه هي النتيجة النهائية لصفحة التصنيفاتالخطوة 11 : عرض المواضيعإن تعليمات SQL في هذه الخطوة هي تعليمات معقدة. بالنسبة لكود php فسيكون كله مألوفاً لديك وشبيه بما سبق. لذا دعنا نلقي نظرة الآن على تعليمات SQL . حيث التعليمة الأولى تستخرج معلومات أساسية حول الموضوع:SELECTtopic_id,topic_subjectFROMtopicsWHEREtopics.topic_id = &quot; . mysql_real_escape_string($_GET['id'])يتم عرض هذه المعلومات في رأس الجدول الذي سنستخدمه لعرض جميع البيانات. ثم سنستخرج جميع التعليقات على هذا الموضوع من قاعدة البيانات. التعليمة التالية تعطينا تماماً ما نريد:SELECTposts.post_topic,posts.post_content,posts.post_date,posts.post_by,users.user_id,users.user_nameFROMpostsLEFT JOINusersONposts.post_by = users.user_idWHEREposts.post_topic = &quot; . mysql_real_escape_string($_GET['id'])والآن نريد معلومات من جدول المستخدمين users وجدول التعليقات replies لذا سنستخدم عبارة LEFT JOIN مرة أخرى. حيث يكون الشرط كالتالي: معرف المستخدم user id يجب أن يكون نفسه في حقل reply_by (مؤلف التعليق) . وبهذه الطريقة نستطيع عرض اسم المستخدم للمستخدم الذي قام بإضافة تعليق ما.العرض الأخير للمواضيع سيبدو على الشكل :الخطوة 12 : إضافة تعليقوالآن دعنا ننهي آخر جزء متبقي لدينا من المنتدى، ألا وهو إمكانية إضافة تعليق. سنبدأ بعمل نموذج للتعليق (بلغة html) :&lt;form method=&quot;post&quot; action=&quot;reply.php?id=5&quot;&gt;&lt;textarea name=&quot;reply-content&quot;&gt;&lt;/textarea &gt;&lt;input type=&quot;submit&quot; value=&quot;Submit reply&quot; /&gt;&lt;/form&gt;وفي النهاية سيكون الكود الكامل لملف reply.php كالتالي: &lt;?php //create_cat.php include 'connect.php'; include 'header.php'; if($_SERVER['REQUEST_METHOD'] != 'POST') { //someone is calling the file directly, which we don't want echo 'This file cannot be called directly.'; } else { //check for sign in status if(!$_SESSION['signed_in']) { echo 'You must be signed in to post a reply.'; } else { //a real user posted a real reply $sql = &quot;INSERT INTO posts(post_content, post_date, post_topic, post_by) VALUES ('&quot; . $_POST['reply-content'] . &quot;', NOW(), &quot; . mysql_real_escape_string($_GET['id']) . &quot;, &quot; . $_SESSION['user_id'] . &quot;)&quot;; $result = mysql_query($sql); if(!$result) { echo 'Your reply has not been saved, please try again later.'; } else { echo 'Your reply has been saved, check out &lt;a href=&quot;topic.php?id=' . htmlentities($_GET['id']) . '&quot;&gt;the topic&lt;/a&gt;.'; } } } include 'footer.php'; ?&gt;انظر التعليقات ضمن الكود لفهم ما يجري.نتأكد أولاً من وجود المستخدم ثم نضيف (ندرج) التعليق لقاعدة البيانات.النهايةالآن وبعد قراءتك لهذا الشرح ستكون لديك المعرفة الكافية لبناء منتدى، أتمنى أن يكون الشرح واضحاً وأنك لم تعترك مع أية مشاكل في طريقك .."> <!-- Open Graph --> <meta property="og:locale" content="ar_SY"> <meta property="og:type" content="article"> <meta property="og:title" content="إنشاء منتدى PHP من الصفر"> <meta property="og:description" content="هذا الدرس من تأليف Evert padje وترجمتي (ملهم)، يركّز الدرس على إنشاء منتدى باستخدام php و Mysql من أجل قاعدة بيانات المنتدى .. وهو لغرض تعليمي، يمكن معاينة المنتدى الناتج على هذا الرابطسنقوم في هذا الشرح ببناء منتدى PHP/MySQL من الصفر. هذا الشرح أيضاً ممتاز للاعتياد على أساسيات لغة البرمجة php وقواعد بيانات MySQL . لنبدأ سويةً ! أولاً : إنشاء جداول قاعدة البيانات : جدول المستخدمين user_id user_name user_pass user_email user_date user_level جدول التصنيفات جدول المواضيع جدول التعليقات ثانياً: مقدمة لنظام الترويسة/التذييل ملف الترويسة header.php ثالثاً: البدء بالتنفيذ الفعلي رابعاً: عرض المنتدى خامساً: اشتراك مستخدم التأكد من البيانات سادساً: إضافة التفعيل ومستوى المستخدم سابعاً: إنشاء تصنيف ثامناً: إضافة تصنيفات للصفحة الرئيسية index.php تاسعاً: إنشاء موضوع عرض النموذج معالجة النموذج عاشراً : عرض التصنيفات الخطوة 11 : عرض المواضيع الخطوة 12 : إضافة تعليق النهايةأولاً : إنشاء جداول قاعدة البيانات :دائماً ، وقبل البدء بإنشاء أي تطبيق وب، من الجيد القيام بإنشاء قاعدة بيانات جيدة لإدخال البيانات بشكل جيد . لنصف تطبيقنا الذي نريد إنشاؤه بجملة واحدة : سنقوم بإنشاء منتدى يحوي على مستخدمين يقوموا بإنشاء مواضيع بـ تصنيفات مختلفة ، المستخدمين الآخرين يمكنهم إضافة تعليق .وكما ترى ، لقد قمت بالتركيز على كلمات معينة لتمثل أسماء الجداول في قاعدة البيانات التي نريدها . المستخدمون users التصنيفات categories المواضيع topics التعليقات replies العناصر الثلاثة الأخيرة مرتبطة ببعضها البعض ، لذا سنقوم بعمل ذلك في تصميم الجدول . يمكن إنشاء قاعدة بيانات MySQL باستخدام أوامر Sql ، ولكننا هنا سنستخدم برنامج بواجهة رسومية ليسهل العملية ويجعلها مفهومة أكثر ، وممتعة أكثر . البرنامج هو Workbench ، يمكنك التعرف عليه أكثر من خلال هذه المشاركة ، ولكن ذلك غير مطلوب لفهم تكملة هذا الشرح .ألقِ نظرة على المخطط أدناهيبدو مرتباً أليس كذلك ؟ كل مربع هو عبارة عن جدول في قاعدة البيانات . جميع الأعمدة مدونة داخل كل جدول .. والخطوط بين الجداول تمثل العلاقة بينهم . سوف نشرح ذلك لاحقاً ، لا بأس إن لم تفهم الكثير الآن ..سوف نناقش كل جدول بشرح أوامر Sql . والتي تم إنشاءها تلقائياً مع إنشاء المخطط في الأعلى . لصنع كودك الخاص يمكنك إنشاء مخطط مشابه وستحصل على أوامر الـ Sql التي قامت بإنشاء المخطط أيضاً . بعض محررات قواعد البيانات مثل MySQL Workbench الذي قمنا بإستخدامه لإنتاج ذلك المخطط ينتج ملفات بلاحقة Sql أيضاً . ولكننا ننصح تعلم أوامر Sql حيث ستجد الأمر ممتعاً . لمقدمة حول Sql يمكنك قراءة المشاركة هنا .جدول المستخدمينCREATE TABLE users (user_idINT(8) NOT NULL AUTO_INCREMENT,user_nameVARCHAR (30) NOT NULL,user_passVARCHAR (255) NOT NULL,user_email VARCHAR (255) NOT NULL,user_dateDATETIME NOT NULL,user_level INT(8) NOT NULL,UNIQUE INDEX user_name_unique (user_name),PRIMARY KEY (user_id)) TYPE=INNODB;تستخدم عبار CREATE TABLE لإنشاء جدول جديد. يتبع هذه العبارة اسم الجدول المراد إنشاؤه، ويتم وضع جميع أعمدة الجدول بين قوسين. بالنسبة لأسماء الحقول فهي تشرح نفسها بنفسها، لذا سنناقش الآن أنواع البيانات فقط.user_idمفتاح أولي يستخدم لتعريف كل عمود في الجدول بشكل فريد (غير قابل للتكرار).نوع هذا الحقل هو INT، وهذا يعني أن الحقل يجب أن يحوي على عدد صحيح (غير عشري). ولا يمكن لهذا الحقل أن يكون فارغاً بما أننا استخدمنا عبارة (NOT NULL). يمكن أن ترى في أسفل الجدول أن حقل user_id تم تحديده على أنه مفتاح أولي (primary key). يستخدم المفتاح الأولي كما ذكرنا لتعريف كل عمود في الجدول بشكل فريد،أي لا يمكن لأي عمودين في الجدول أن يكون لهم نفس القيمة لهذا الحقل. الكلام غير واضح؟ بالمثال يزول الإشكال :لدينا مستخدم على سبيل المثال يدعى أحمد، إذا قام مستخدم آخر بالتسجيل وبنفس الاسم، فسيكون هناك مشكلة. ﻷنه لا يمكن التفريق بين أحمد هذا وأحمد ذاك. لا يمكنك التفريق ولا يمكن حتى لقاعدة البيانات حينها التفريق بينهم. يتم حل هذه المشكلة باستخدام المتاح الأولي (primary key) ، حيث سيعطى للاسمين رقم مختلف.جميع الجداول الأخرى تحوي على مفاتيح أولية وتعمل بنفس الطريقة.user_nameهذا حقل نصي (وليس رقمي كالحقل السابق). يدعي الحقل بلغة SQL حقل VARCHAR وهو أحد أنواع الحقول النصية. الرقم بين الأقواس هو أقصى طول لعدد الأحرف التي يمكن أن يتم إدخالها في الحقل. في حالتنا هذه يمكن للمستخدم اختيار اسم يبلغ طوله كحد أقصى 30 حرف. ولا يمكن لهذا الحقل أن يكون فارغاً (NOT NULL)، سترى أسفل الجدول أن هذا الحقل تم تحديده على أنه فريد (UNIQUE)، وهذا يعني أنه لا يمكن لشخصين التسجيل بنفس الاسم.الجزء الذي يحوي على عبارة UNIQUE INDEX يُخبر قاعدة البيانات أننا نريد إضافة مفتاح فريد (UNIQUE KEY)، بعدها قمنا بتحديد اسم المفتاح الفريد وهو هنا user_name_unique ، وبين الأقواس اسم الحقل الذي سينطبق المفتاح الفريد عليه (ليصبح غير قابل لتكرار قيمته مرتين في الجدول).user_passهذا الحقل نفس الحقل السابق، باستثناء الطول الأقصى له ، فبما أن كلمة سر المستخدم ومهما كان طولها سيتم تشفيرها لنوع تشفير sha1 ، فكلمة السر ستكون دائماً مع نوع التشفير هذا بطول 40 حرف.توضيح: حين تدخل أي كملة سر ولنفترض 123 أو لتكن mulham أو أي شيئ آخر ومهما يكن طول كلمة السر التي ستدخلها، يتم تطبيق تشفير لكلمة السر هذه قبل حفظها في قاعدة البيانات وذلك للأمان، بحيث اذا استطاع أحد ما بالوصول لقاعدة البيانات بالخطأ، فلن يتمكن من معرفة كلمات سر المستخدمين، وهناك أنواع كثير للتشفير منها هذا النوع sha1 والذي يحول أي كلمة سر ل 40 حرف (أحرف وأرقام)، وعند نموذج دخول المستخدم (بعد اشتراكه)، نطبق نفس نوع التشفير على كلمة السر المدخلة لنقارن قيمة تشفير الكلمة المدخلة مع قيمة التشفير المحفوظة في قاعدة البيانات، فإذا طابقها، ولج المستخدم للموقع بشكل صحيح.user_emailهذا الحقل هو تماماً نفس الحقل السابق (بالنسبة لقاعدة البيانات، أما لاحقاً عند عمل نموذج دخول بلغة HTML فيختلف الموضوع قليلاً )user_dateفي هذا الحقل يتم تخزين التاريخ الذي قام به المستخدم بالتسجيل. نوع هذا الحقل هو DATETIME ولا يمكن أن يكون فارغ. (يتم تعبئة الحقل تلقائياً بحسب توقيت السيرفر).user_levelيحوي هذا الحقل مستوى المستخدم، على سبيل المثال: 0 للمستخدم العادي و 1 للمدير. ستتعرف على المزيد لاحقاً.جدول التصنيفاتCREATE TABLE categories (cat_idINT(8) NOT NULL AUTO_INCREMENT,cat_nameVARCHAR (255) NOT NULL,cat_descriptionVARCHAR(255) NOT NULL,UNIQUE INDEX cat_name_unique (cat_name),PRIMARY KEY (cat_id)) TYPE=INNODBأنواع البيانات هنا تعمل بشكل أساسي بنفس الطريقة التي تعمل بها أنواع البيانات في جدول المستخدمين. يحوي هذا الجدول أيضاً مفتاح أولي ، واسم التصنيف يجب أن يكون فريد .جدول المواضيع CREATE TABLE topics (topic_idINT(8) NOT NULL AUTO_INCREMENT,topic_subjectVARCHAR(255) NOT NULL,topic_dateDATETIME NOT NULL,topic_catINT(8) NOT NULL,topic_byINT(8) NOT NULL,PRIMARY KEY (topic_id)) TYPE=INNODB;هذا الجدول تقريباً نفس الجداول السابقة، باستثناء حقل topic_by والذي يشير للمستخدم المنشئ للموضوع. وحقل topic_cat الذي يشير للتصنيف الذي يتبع الموضوع له. لا يمكن تحديد العلاقات بين هذه الحقول بذكر أسماء الحقول فقط. فيجب أن نُعلم قاعدة البيانات أن هذا الحقل (topic_by) يجب أن يحتوي على الرقم التسلسلي user_id لمستخدم موجود في جدول المستخدمين، والحقل الآخر (topic_cat) يجب أن يحتوي على الرقم التسلسلي cat_id لتصنيف موجود في جدول التصنيفات. سنضيف هذه العلاقات بين الحقول والجداول بعد مناقشة جدول التعليقات.جدول التعليقات CREATE TABLE posts (post_idINT(8) NOT NULL AUTO_INCREMENT,post_contentTEXT NOT NULL,post_dateDATETIME NOT NULL,post_topicINT(8) NOT NULL,post_byINT(8) NOT NULL,PRIMARY KEY (post_id)) TYPE=INNODB;هذا الجدول هو نفس بقية الجداول، ويوجد هنا أيضاً حقل يشير لرقم مستخدم user_id في جدول المستخدمين : حقل post_by ، حقل post_topic يشير للموضوع الذي يتبع التعليق له .المفتاح الخارجي foreign key هو قيد مرجعي بين جدولين. يُعرِّف المفتاح الخارجي عمود أو مجموعة أعمدة في جدول (مرجعي) والذي يشير لعمود أو مجموعة أعمدة في جدول (مرجعي) آخر .الآن وبعد تنفيذ هذه التعليمات وإنشاء الجداول. أصبح لدينا ترتيب بيانات جيد، ولكن العلاقات بين هذه البيانات مازالت مفقودة. لنبدأ بتعريف أحد هذه العلاقات. سوف نستخدم شيئ يدعي المفتاح الخارجي. بعض الشروط لهذا الاستخدام: العمود في الجدول المرجعي والذي يشير له المفتاح الخارجي يجب أن يكون مفتاح أولي. القيم المشار لها يجب أن تكون موجودة في الجدول المرجعي. أعرف أن كل هذه المصطلحات جديدة عليك، ولكنك ستكتشف أنها بسيطة جداً، هي فقط علاقة بين جدول وآخر ، ستتضح لك الأمور في السطور القادمة.بإضافة مفاتيح خارجية تصبح المعلومات مرتبطة ببعضها، وهذا مهم جداً في ترتيب قاعدة البيانات.الآن أصبحت تعرف نوعاً ما ما هو المفتاح الخارجي ولماذا نستخدمه. حان الوقت لإضافة مفاتيح خارجية للجداول التي أنشأناها باستخدام عبارة ALTER، والتي تستخدم لتعديل جدول موجود مسبقاً.سنقوم في البداية بربط المواضيع بالتصنيفات:ALTER TABLE topics ADD FOREIGN KEY(topic_cat) REFERENCES categories(cat_id) ON DELETE CASCADE ON UPDATE CASCADE;الجزء الأخير من التعليمة يوضح ما يجري. فعندما يتم حذف التصنيف من قاعدة البيانات، جميع المواضيع المرتبطة بهذا التصنيف سيتم حذفها أيضاً. إذا تم تغيير قيمة cat_id لتصنيف ما، جميع المواضيع المرتبطة بهذا التصنيف سيتم تحديثها أيضاً. وهذا ما تقوم به عبارة ON UPDATE CASCADE . بالطبع يمكنك التراجع عن ذلك لحماية بياناتك، وذلك بجعل حذف تنصيف ما غير ممكن ما زال هناك مواضيع مرتبطة بهذا التصنيف، إذا أردت القيام بذلك، فعليك استبدال ON DELETE CASCADE إلى ON DELETE RESTRICT . يوجد أيضاً عبارات SET NULL أي اجعله فارغاً و NO ACTION أي لا تقم بأي إجراء.الآن، كل موضوع أصبح مرتبط بتصنيف ما. لنقم بربط المواضيع بالمستخدمين المنشئين لهم. ALTER TABLE topics ADD FOREIGN KEY(topic_by) REFERENCES users(user_id) ON DELETE RESTRICT ON UPDATE CASCADE;المفتاح الخارجي هنا هو نفسه كسابقه، ولكن هناك فرق واحد: لا يمكن حذف المستخدم ما زال هناك مواضيع مرتبطة به، أو بالأحرى مرتبطة بـ user_id للمستخدم (رقمه التسلسلي في قاعدة البيانات). لم نضع هنا ON DELETE CASCADE ﻷننا لا نريد للمعلومات المرتبطة بحساب ما والتي قد تكون قيمة أن تُحذف عندما يقرر المستخدم حذف حسابه. لإبقاء خيار حذف الحساب متاحاً للمستخدمين، يجب أن تقوم بإنشاء ميزة تنقل المواضيع لحساب “مجهول” عند حذف مستخدم لحسابه. وفي الواقع هذا ليش موضوع نقاشنا في هذا الشرح.ربط التعليقات بالمواضيع: ALTER TABLE posts ADD FOREIGN KEY(post_topic) REFERENCES topics(topic_id) ON DELETE CASCADE ON UPDATE CASCADE;وأخيراً، ربط كل تعليق بالمستخدم المنشئ له:ALTER TABLE posts ADD FOREIGN KEY(post_by) REFERENCES users(user_id) ON DELETE RESTRICT ON UPDATE CASCADE;انتهى الجزء الخاص بقاعدة البيانات! لقد كان عملاً متعباً نوعاً ما، ولكن النتيجة تستحق هذا العمل، حيث حصلنا على قاعدة بيانات نموذجبة.ثانياً: مقدمة لنظام الترويسة/التذييلكل صفحة في منتدانا تتطلب بعض الأشياء الأساسية، مثل بعض الترميزات والتنسيقات. ولذا سنقوم بتضمين ملف الترويسة header.php بأعلى كل صفحة في المنتدى، والتذييل footer.php أسفل كل صفحة. يتضمن ملف الترويسة الترميزات الأساسية وروابط للملفات التي يجب تحميلها لعرض المنتدى بشكل جيد، وكذلك بعض المعلومات المهمة حول المنتدى، مثل العنوان والأيقونة والشعار..ملف الترويسة header.php&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Strict//EN&quot;&quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd&quot;&gt;&lt;html xmlns=&quot;http://www.w3.org/1999/xhtml&quot; xml:lang=&quot;nl&quot; lang=&quot;nl&quot;&gt;&lt;head&gt; &lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=UTF-8&quot; /&gt; &lt;meta name=&quot;description&quot; content=&quot;A short description.&quot; /&gt; &lt;meta name=&quot;keywords&quot; content=&quot;put, keywords, here&quot; /&gt; &lt;title&gt;PHP-MySQL forum&lt;/title&gt; &lt;link rel=&quot;stylesheet&quot; href=&quot;style.css&quot; type=&quot;text/css&quot;&gt;&lt;/head&gt;&lt;body&gt;&lt;h1&gt;My forum&lt;/h1&gt; &lt;div id=&quot;wrapper&quot;&gt; &lt;div id=&quot;menu&quot;&gt; &lt;a class=&quot;item&quot; href=&quot;/forum/index.php&quot;&gt;Home&lt;/a&gt; - &lt;a class=&quot;item&quot; href=&quot;/forum/create_topic.php&quot;&gt;Create a topic&lt;/a&gt; - &lt;a class=&quot;item&quot; href=&quot;/forum/create_cat.php&quot;&gt;Create a category&lt;/a&gt; &lt;div id=&quot;userbar&quot;&gt; &lt;div id=&quot;userbar&quot;&gt;Hello Example. Not you? Log out.&lt;/div&gt; &lt;/div&gt; &lt;div id=&quot;content&quot;&gt;سنستخدم وسم &lt;div id=&quot;wrapper&quot;&gt; لجعل تنسيق كامل الصفحة أسهل. الوسم &lt;div id=&quot;menu&quot;&gt; كما هو واضح يضم قائمة بروابط لصفحات الموقع التي سننشؤها لاحقاً. وسم &lt;div id=&quot;userbar&quot;&gt; سيستخدم كشريط علوي يضم معلومات مثل اسم المستخدم ورابط لتسجيل الخروج. والوسم الأخير سيحوي بشكل واضح المعلومات الفعلية للصفحة التي يكون بها المستخدم.إذا كنت تقرأ بانتباه، فربما لاحظت أننا فقدنا شيئاً ما. فلم ننهي وسمي &lt;html&gt; و &lt;body&gt; كما هو واجب في لغة html. أي لم نكتب في نهاية ملف الترويسة &lt;/body&gt; &gt;/html&gt;والسبب هو أننا سنضعهم في ملف التذييل footer.php :&lt;/div&gt;<!-- content -->&lt;/div&gt;<!-- wrapper -->&lt;div id=&quot;footer&quot;&gt;Created for Nettuts+&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;عندما نضمّن ملفي الترويسة والتذييل في كل صفحة، فإن محتوى الصفحة الفعلي سيظهر بين الترويسة (بداية الصفحة) والتذييل (نهاية الصفحة). لهذه الطريقة عدة فوائد. أولها وأهمها أن كل شيئ سيكون منسق بشكل صحيح. مثال سريع : &lt;?php$error = false;if($error = false){ //the beautifully styled content, everything looks good echo '&lt;div id=&quot;content&quot;&gt;some text&lt;/div&gt;';}else{ //bad looking, unstyled error :-( } ?&gt;كما ترى، إذا لم يحدث أخطاء في الصفحة فستظهر بشكل أنيق. أما اذا كان هناك خطأ، فكل شيئ سيكون مبعثر. ولهذا السبب يجب دائماً التأكد ليس من تنسيق المحتوى فقط، وإنما أيضاً من الأخطاء التي يمكن أن تحدث.ميزة أخرى لهذه الطريقة (تضمين ملفي الترويسة والتذييل) هو إمكانية عمل تغييرات سريعة. فسترى أنك وبعد إنهاء هذا الشرح إذا أردت التعديل على ملف التذييل مثلاً footer.php، فسترى أن التذييل سينطبق مباشرة على كل صفحة في المنتدى.أخيراً سوف نقوم بإضافة بعض التنسيقات والتي تزودنا بإظهارات وترميزات أساسية. لا شيئ معقد هنا، ولا داعي لفهم الكود.body { background-color: #4E4E4E; text-align: center; /* make sure IE centers the page too */} #wrapper { width: 900px; margin: 0 auto; /* center the page */} #content { background-color: #fff; border: 1px solid #000; float: left; font-family: Arial; padding: 20px 30px; text-align: left; width: 100%; /* fill up the entire div */} #menu { float: left; border: 1px solid #000; border-bottom: none; /* avoid a double border */ clear: both; /* clear:both makes sure the content div doesn't float next to this one but stays under it */ width:100%; height:20px; padding: 0 30px; background-color: #FFF; text-align: left; font-size: 85%;} #menu a:hover { background-color: #009FC1;} #userbar { background-color: #fff; float: right; width: 250px;} #footer { clear: both;} /* begin table styles */table { border-collapse: collapse; width: 100%;} table a { color: #000;} table a:hover { color:#373737; text-decoration: none;} th { background-color: #B40E1F; color: #F0F0F0;} td { padding: 5px;} /* Begin font styles */h1, #footer { font-family: Arial; color: #F1F3F1;} h3 {margin: 0; padding: 0;} /* Menu styles */.item { background-color: #00728B; border: 1px solid #032472; color: #FFF; font-family: Arial; padding: 3px; text-decoration: none;} .leftpart { width: 70%;} .rightpart { width: 30%;} .small { font-size: 75%; color: #373737;}#footer { font-size: 65%; padding: 3px 0 0 0;} .topic-post { height: 100px; overflow: auto;} .post-content { padding: 30px;} textarea { width: 500px; height: 200px;}ثالثاً: البدء بالتنفيذ الفعليقبل أن نستطيع قراءة أي شيئ من قاعدة البيانات، يجب أن نقيم اتصال بها. وهذا ما سيقوم به ملف connect.php الذي سنضمنه بكل ملف ننشؤه.&lt;?php//connect.php$server = 'localhost';$username = 'usernamehere';$password = 'passwordhere';$database = 'databasenamehere'; if(!mysql_connect($server, $username, $password)){ exit('Error: could not establish database connection');}if(!mysql_select_db($database){ exit('Error: could not select the database');}?&gt;ببساطة استبدل فقط القيم الافتراضية للمتغيرات في أعلى الكود ببياناتك الخاصة. احفظ الملف ودعنا ننطلق للكملة.رابعاً: عرض المنتدىبما أننا بدأنا بتقنيات أساسية، سنقوم بعمل طريقة عرض مبسطة للمنتدى الآن.&lt;?php//create_cat.phpinclude 'connect.php';include 'header.php'; echo '&lt;tr&gt;'; echo '&lt;td class=&quot;leftpart&quot;&gt;'; echo '&lt;h3&gt;&lt;a href=&quot;category.php?id=&quot;&gt;Category name&lt;/a&gt;&lt;/h3&gt; Category description goes here'; echo '&lt;/td&gt;'; echo '&lt;td class=&quot;rightpart&quot;&gt;'; echo '&lt;a href=&quot;topic.php?id=&quot;&gt;Topic subject&lt;/a&gt; at 10-10'; echo '&lt;/td&gt;';echo '&lt;/tr&gt;';include 'footer.php';?&gt;الآن اكتمل منتداك تقريباً. بفتحك لهذا الملف من السيرفر ستشاهد المنتدى بشكل أنيق وبسيط. سنقوم خلال بقية الشرح بتحديث هذا الملف لنحصل على النتيجة النهائية، خطوة بخطوة!خامساً: اشتراك مستخدمدعنا الآن ننشئ نموذج اشتراك بسيط بلغة html حيث يمكن للمستخدمين الاشتراك بالمنتدىسنحتاج أيضاً لصفحة بلغة php لإرسال بيانات النموذج لقاعدة البيانات وإتمام اشتراك المستخدم. سنقوم باستخدام المتغير $_SERVER .المتغير $_SERVER يحوي مجموعة من القيم التي يتم تعيينها تلقائياً مع كل طلب. أحد هذه القيم هو REQUEST_METHOD . عندما يتم طلب صفحة بواسطة GET . فسيحمل هذا المتغير القيمة GET . وعندما يتم طلب الصفحة بواسطة POST ، فسيحمل المتغير القيمة POST . ولذا سنستخدم هذا المتغير لمعرفة إذا تم إرسال النموذج (بواسطة POST). انظر صفحة الاشتراك signup.php أدناه&lt;?php//signup.phpinclude 'connect.php';include 'header.php'; echo '&lt;h3&gt;Sign up&lt;/h3&gt;'; if($_SERVER['REQUEST_METHOD'] != 'POST'){ /*the form hasn't been posted yet, display it note that the action=&quot;&quot; will cause the form to post to the same page it is on */ echo '&lt;form method=&quot;post&quot; action=&quot;&quot;&gt; Username: &lt;input type=&quot;text&quot; name=&quot;user_name&quot; /&gt; Password: &lt;input type=&quot;password&quot; name=&quot;user_pass&quot;&gt; Password again: &lt;input type=&quot;password&quot; name=&quot;user_pass_check&quot;&gt; E-mail: &lt;input type=&quot;email&quot; name=&quot;user_email&quot;&gt; &lt;input type=&quot;submit&quot; value=&quot;Add category&quot; /&gt; &lt;/form&gt;';}else{ /* so, the form has been posted, we'll process the data in three steps: 1. Check the data 2. Let the user refill the wrong fields (if necessary) 3. Save the data */ $errors = array(); /* declare the array for later use */ if(isset($_POST['user_name'])) { //the user name exists if(!ctype_alnum($_POST['user_name'])) { $errors[] = 'The username can only contain letters and digits.'; } if(strlen($_POST['user_name']) &gt; 30) { $errors[] = 'The username cannot be longer than 30 characters.'; } } else { $errors[] = 'The username field must not be empty.'; } if(isset($_POST['user_pass'])) { if($_POST['user_pass'] != $_POST['user_pass_check']) { $errors[] = 'The two passwords did not match.'; } } else { $errors[] = 'The password field cannot be empty.'; } if(!empty($errors)) /*check for an empty array, if there are errors, they're in this array (note the ! operator)*/ { echo 'Uh-oh.. a couple of fields are not filled in correctly..'; echo '&lt;ul&gt;'; foreach($errors as $key =&gt; $value) /* walk through the array so all the errors get displayed */ { echo '&lt;li&gt;' . $value . '&lt;/li&gt;'; /* this generates a nice error list */ } echo '&lt;/ul&gt;'; } else { //the form has been posted without, so save it //notice the use of mysql_real_escape_string, keep everything safe! //also notice the sha1 function which hashes the password $sql = &quot;INSERT INTO users(user_name, user_pass, user_email ,user_date, user_level) VALUES('&quot; . mysql_real_escape_string($_POST['user_name']) . &quot;', '&quot; . sha1($_POST['user_pass']) . &quot;', '&quot; . mysql_real_escape_string($_POST['user_email']) . &quot;', NOW(), 0)&quot;; $result = mysql_query($sql); if(!$result) { //something went wrong, display the error echo 'Something went wrong while registering. Please try again later.'; //echo mysql_error(); //debugging purposes, uncomment when needed } else { echo 'Successfully registered. You can now &lt;a href=&quot;signin.php&quot;&gt;sign in&lt;/a&gt; and start posting! :-)'; } }} include 'footer.php';?&gt;العديد من التوضيحات ستجدها في التعليقات الموضوعة ضمن الكود، لذا تأكد من قراءتها. معالجة البيانات تتم على ثلاثة مراحل:التأكد من البياناتاذا لم تكن البيانات صحيحة ومعبئة بشكل كامل، اعرض النموذج مرة أخرى.اذا كانت جميع البيانات صحيحة ومعبئة، احفظ البيانات في قاعدة البيانات.(ماذا تقصد بالتأكد من صحة البيانات اذا كانت البيانات تُدخل ﻷول مرة؟ أقصد بذلك أن هناك حقل مثلاً ليضع المستخدم بريده الإلكتروني، يتم تعريف هذا الحقل بلغة html على أنه بريد إلكتروني، يجب أن يحوي على @ و نقطة ثم كوم أو نت أو أياً كان، إذا لم تكن البيانات المدخلة في هذا الحقل بالشكل المذكور، فالمستخدم في الواقع لم يدخل بريد إلكتروني فعلاً، وهناك بالتالي بيانات غير صحيحة في النموذج)الجزء المتعلق بـ php على كل حال يشرح نفسه بنفسه، يبقى تعليمات SQL التي تحتاج بعض الشرح.INSERT INTO users(user_name, user_pass, user_email ,user_date, user_level)VALUES('&quot; . mysql_real_escape_string($_POST['user_name']) . &quot;', '&quot; . sha1($_POST['user_pass']) . &quot;', '&quot; . mysql_real_escape_string($_POST['user_email']) . &quot;', NOW(), 0);في السطر الأول لدينا عبارة INSERT INTO التي تستخدم لإضافة بيانات لقاعدة البيانات، وتم تحديد اسم الجدول في السطر الثاني. الكلمات التي بين قوسين تحدد أسماء الأعمدة التي نريد إدراج البيانات لها. عبارة VALUES تُخبر قاعدة البيانات أننا انتهينا من تحديد أسماء الأعمدة وجاء وقت تحديد القيم التي ستُضاف لهذه الأعمدة. ولدينا شيئ جديد هنا: mysql_real_escape_string. تستخدم هذه التعليمة لحماية بيانات المستخدم أثناء إرساله للنموذج، ويجب أن تُستخدم دائماً باستثاء بعض الحالات النادرة. السكريبتات التي لا تستخدم هذه التعليمة يكون اختراقها والوصول لبيانات النموذج المرسلة سهل جداً، فلا تخاطر بذلك واستخدم عبارة mysql_real_escape_string(). إيّاك أن تُدرج كلمة السر في قاعدة البيانات كما هي. يجب عليك دائماً تشفيرها.كما رأيت ، لقد قمنا باستخدام عبارة sha1() لتشفير كلمة سر المستخدم قبل حفظها في قاعدة البيانات، تذكر دائماً عمل هذه الخطوة في كل نموذج تقوم بعمله ويحوي على كلمة سر. فلو فرضنا أن أحد المخترقين قام بالوصول لقاعدة البيانات، وكانت كلمات السر غير مشفرة، فسيصبح بإمكانه الولوج لحساب أي مستخدم أو أي مدير في المنتدى وعمل ما يحلو له، أما لو كانت كلمات السر مشفرة فلن يتمكن من فعل ذلك قبل أن يفك تشفيرهم، وهذا مستحيل تقريباً . من الممكن استخدام أي نوع تشفير آخر بدلاً من sha1() ، مثل md5() . أنا استخدم النوع sha1() ﻷن المقاييس أثبتت أن هذا النوع أسرع بقليل.اذا نجحت عملية الاشتراك فستحصل على التاليقم بتحديث صفحة قاعدة البيانات في phpMyAdmin ، يجب أن ترى تسجيلاً جديداً في جدول المستخدمين usersسادساً: إضافة التفعيل ومستوى المستخدمإن من المزايا الهامة في المنتدى هو الفرق بين المستخدم العادي والمدير/المشرف. وبما أننا نناقش هنا منتجى صغير وبسيط وأن إضافة مزايا سيأخذ وقتاً طويلاً، فسنركز هنا على عملية تسجيل الدخول وإضافة بعض المزايا للمدراء مثل إضافة تصنيفات جديدة وإغلاق نقاش.والآن بعد إكمال الخطوة السابقة، سنقوم بجعل الحساب الذي أنشأته للتو حساب مدير. اذهب لـ phpMyAdmin واضغط على جدول المستخدمين users ثم اضغط على خيار Browse . سيظهر لك الحساب الذي أنشأته، اضغط على أيقونة التعديل edit وقم بتغيير قيمة الحقل user_level من 0 إلى 1 .حالياً لن تلاحظ أي فرق في المنتدى، ولكن عندما نضيف مزايا المدير سيصبح هناك فروقات في الصلاحيات بين الحساب العادي وهذا الحساب.عملية تسجيل الدخول تعمل كالتالي: يقوم الزائر بإدخال بيانات المستخدم ويرسل النموذج. إذا كان اسم المستخدم وكلمة السر المدخلين صحيحين، فيمكن الآن بدء الجلسة (session)اذا كان اسم المستخدم أو كلمة المرور غير صحيحين، نقوم بإظهار النموذج مرة أخرى مع رسالة خطأ. بالأسفل ملف تسجيل الدخول signin.php . اطلع على التعليقات ضمن الكود لفهم ما يجري &lt;?php//signin.phpinclude 'connect.php';include 'header.php'; echo '&lt;h3&gt;Sign in&lt;/h3&gt;'; //first, check if the user is already signed in. If that is the case, there is no need to display this pageif(isset($_SESSION['signed_in']) &amp;&amp; $_SESSION['signed_in'] == true){ echo 'You are already signed in, you can &lt;a href=&quot;signout.php&quot;&gt;sign out&lt;/a&gt; if you want.';}else{ if($_SERVER['REQUEST_METHOD'] != 'POST') { /*the form hasn't been posted yet, display it note that the action=&quot;&quot; will cause the form to post to the same page it is on */ echo '&lt;form method=&quot;post&quot; action=&quot;&quot;&gt; Username: &lt;input type=&quot;text&quot; name=&quot;user_name&quot; /&gt; Password: &lt;input type=&quot;password&quot; name=&quot;user_pass&quot;&gt; &lt;input type=&quot;submit&quot; value=&quot;Sign in&quot; /&gt; &lt;/form&gt;'; } else { /* so, the form has been posted, we'll process the data in three steps: 1. Check the data 2. Let the user refill the wrong fields (if necessary) 3. Varify if the data is correct and return the correct response */ $errors = array(); /* declare the array for later use */ if(!isset($_POST['user_name'])) { $errors[] = 'The username field must not be empty.'; } if(!isset($_POST['user_pass'])) { $errors[] = 'The password field must not be empty.'; } if(!empty($errors)) /*check for an empty array, if there are errors, they're in this array (note the ! operator)*/ { echo 'Uh-oh.. a couple of fields are not filled in correctly..'; echo '&lt;ul&gt;'; foreach($errors as $key =&gt; $value) /* walk through the array so all the errors get displayed */ { echo '&lt;li&gt;' . $value . '&lt;/li&gt;'; /* this generates a nice error list */ } echo '&lt;/ul&gt;'; } else { //the form has been posted without errors, so save it //notice the use of mysql_real_escape_string, keep everything safe! //also notice the sha1 function which hashes the password $sql = &quot;SELECT user_id, user_name, user_level FROM users WHERE user_name = '&quot; . mysql_real_escape_string($_POST['user_name']) . &quot;' AND user_pass = '&quot; . sha1($_POST['user_pass']) . &quot;'&quot;; $result = mysql_query($sql); if(!$result) { //something went wrong, display the error echo 'Something went wrong while signing in. Please try again later.'; //echo mysql_error(); //debugging purposes, uncomment when needed } else { //the query was successfully executed, there are 2 possibilities //1. the query returned data, the user can be signed in //2. the query returned an empty result set, the credentials were wrong if(mysql_num_rows($result) == 0) { echo 'You have supplied a wrong user/password combination. Please try again.'; } else { //set the $_SESSION['signed_in'] variable to TRUE $_SESSION['signed_in'] = true; //we also put the user_id and user_name values in the $_SESSION, so we can use it at various pages while($row = mysql_fetch_assoc($result)) { $_SESSION['user_id'] = $row['user_id']; $_SESSION['user_name'] = $row['user_name']; $_SESSION['user_level'] = $row['user_level']; } echo 'Welcome, ' . $_SESSION['user_name'] . '. &lt;a href=&quot;index.php&quot;&gt;Proceed to the forum overview&lt;/a&gt;.'; } } } }} include 'footer.php';?&gt;كما لاحظت، هذه هي تعليمات SQL في الكود السابق SELECT user_id, user_name, user_levelFROM usersWHERE user_name = '&quot; . mysql_real_escape_string($_POST['user_name']) . &quot;'AND user_pass = '&quot; . sha1($_POST['user_pass'])من الواضح أننا نقوم بالتأكد من البيانات المدخلة إذا كانت لمستخدم موجود بالفعل. هناك العديد من السكريبتات التي تستخرج كلمة السر من قاعدة البيانات وتقارنها مع تلك المدخلة في النموذج باستخدام php. ولكن القيام بذلك بواسطة تعليمات SQL مباشرة سيجعل العملية أكثر أمناً حيث أن العملية هذه تحصل في وسط قاعدة البيانات وليس ضمن تطبيقنا الوب (منتدانا).إذا قام المستخدم بتسجيل الدخول بشكل صحيح، فسنقوم بعمل بضعة أشياء: &lt;?php//set the $_SESSION['signed_in'] variable to TRUE$_SESSION['signed_in'] = true;//we also put the user_id and user_name values in the $_SESSION, so we can use it at various pageswhile($row = mysql_fetch_assoc($result)){ $_SESSION['user_id'] = $row['user_id']; $_SESSION['user_name'] = $row['user_name']; }?&gt;في البداية، قمنا بإعطاء المتغير $_SESSION['signed_in'] القيمة true أي أننا بدأنا الجلسة والمستخدم الآن مسجل الدخول. وسنقوم باستخدام هذا المتغير في صفحات أخرى للتأكد من أن المستخدم مسجل الدخول. أيضاً قمنا بوضع اسم المستخدم username ومعرفه user_id في المتغير $_SESSION للاستخدام في صفحات أخرى. أخيراً، سنقوم بعرض رابط لرئيسية المنتدى حيث يمكن للمستخدم البدء في الإبحار.تسجيل الدخول بالطبع يتطلب وظيفة أخرى وهي تسجيل الخروج! في الواقع عملية تسجيل الخروج أسهل بكثير من عملية تسجيل الدخول، فبما أن جميع المعلومات مخزنة في متغيرات $_SESSION ، فكل ما علينا فعله هو إلغاء تعيينهم في هذا المتغير وعرض رسالة للمستخدم.الآن قمنا بضبط متغيرات $_SESSION ، يمكننا تحديد اذا كان شخص ما مسجل الدخول. دعنا نقوم الآن بعمل تغيير أخير على ملف الترويسة header.phpقم باستبدال التالي في الملف:&lt;div id=&quot;userbar&quot;&gt;Hello Example. Not you? Log out.&lt;/div&gt;إلى : &lt;?php&lt;div id=&quot;userbar&quot;&gt; if($_SESSION['signed_in']) { echo 'Hello' . $_SESSION['user_name'] . '. Not you? &lt;a href=&quot;signout.php&quot;&gt;Sign out&lt;/a&gt;'; } else { echo '&lt;a href=&quot;signin.php&quot;&gt;Sign in&lt;/a&gt; or &lt;a href=&quot;sign up&quot;&gt;create an account&lt;/a&gt;.'; }&lt;/div&gt;وبالتالي، إذا قام المستخدم بتسجيل الدخول، فسيرى اسمه معروض في بداية الصفحة مع رابط لصفحة تسجيل الخروج.نجحت طريقة التفعيل! والآن يبدو منتدانا كالتالي :سابعاً: إنشاء تصنيفنحن نريد إنشاء تصانيف في المنتدى، لذا دعنا ننشئ نموذج لهذه العملية&lt;form method=&quot;post&quot; action=&quot;&quot;&gt; Category name: &lt;input type=&quot;text&quot; name=&quot;cat_name&quot; /&gt; Category description: &lt;textarea name=&quot;cat_description&quot; /&gt;&lt;/textarea&gt; &lt;input type=&quot;submit&quot; value=&quot;Add category&quot; /&gt; &lt;/form&gt;تبدو هذه الخطوة مثل الخطوة الرابعة (اشتراك مستخدم). لذا لن أقوم بالشرح هنا ، فبما أنك متابع للخطوات فستكون قادراً على فهم الأمور بشكل سريع.سنقوم تضمين النموذج في الأعلى ضمن صفحة إنشاء تصنيف :&lt;?php//create_cat.phpinclude 'connect.php'; if($_SERVER['REQUEST_METHOD'] != 'POST'){ //the form hasn't been posted yet, display it echo '&lt;form method='post' action=''&gt; Category name: &lt;input type='text' name='cat_name' /&gt; Category description: &lt;textarea name='cat_description' /&gt;&lt;/textarea&gt; &lt;input type='submit' value='Add category' /&gt; &lt;/form&gt;';}else{ //the form has been posted, so save it $sql = ìINSERT INTO categories(cat_name, cat_description) VALUES('' . mysql_real_escape_string($_POST['cat_name']) . ì', '' . mysql_real_escape_string($_POST['cat_description']) . ì')'; $result = mysql_query($sql); if(!$result) { //something went wrong, display the error echo 'Error' . mysql_error(); } else { echo 'New category successfully added.'; }}?&gt;وكما ترى، لقد بدأنا السكريبت بفحص السيرفر $_SERVER ، بعد التأكد من أن المستخدم لديه صلاحيات المدير، والمطلوبة لإنشاء تصنيف، يتم عرض النموذج إذا لم يتم تعبئته وإرساله سابقاً، وإذا تم إرساله، يتم حفظ القيم. مرة أخرى ، يتم تحضير تعليمة SQL وتنفيذها.ثامناً: إضافة تصنيفات للصفحة الرئيسية index.phpلقد قمنا بإنشاء بعض التصنيفات، ويمكننا الآن عرضهم في الصفحة الرئيسية. دعنا نضيف تعليمة SQL التالية لمنظقة المحتوى في الصفحة الرئيسية index.phpSELECT categories.cat_id, categories.cat_name, categories.cat_description,FROM categoriesتقوم هذه التعليمة بتحديد جميع التصنيفات وأسمائهم ووصفهم من جدول التصنيفات. سنحتاج الآن لبضعة أسطر php لعرض النتائج. إذا قمنا بإضافة التعليمة كما فعلنا في الخطوات السابقة، فسيبدو الكود على الشكل:&lt;?php//create_cat.phpinclude 'connect.php';include 'header.php'; $sql = &quot;SELECT cat_id, cat_name, cat_description, FROM categories&quot;; $result = mysql_query($sql); if(!$result){ echo 'The categories could not be displayed, please try again later.';}else{ if(mysql_num_rows($result) == 0) { echo 'No categories defined yet.'; } else { //prepare the table echo '&lt;table border=&quot;1&quot;&gt; &lt;tr&gt; &lt;th&gt;Category&lt;/th&gt; &lt;th&gt;Last topic&lt;/th&gt; &lt;/tr&gt;'; while($row = mysql_fetch_assoc($result)) { echo '&lt;tr&gt;'; echo '&lt;td class=&quot;leftpart&quot;&gt;'; echo '&lt;h3&gt;&lt;a href=&quot;category.php?id&quot;&gt;' . $row['cat_name'] . '&lt;/a&gt;&lt;/h3&gt;' . $row['cat_description']; echo '&lt;/td&gt;'; echo '&lt;td class=&quot;rightpart&quot;&gt;'; echo '&lt;a href=&quot;topic.php?id=&quot;&gt;Topic subject&lt;/a&gt; at 10-10'; echo '&lt;/td&gt;'; echo '&lt;/tr&gt;'; } }} include 'footer.php';?&gt;لاحظ كيف استخدمنا حقل cat_id لإنشاء روابط لصفحة category.php . جميع الروابط لهذه السفحة ستبدو على الشكل: category.php?cat_id=xحيث x يمكن أن يكون أي قيمة عددية بحسب التصنيف .تاسعاً: إنشاء موضوعسنقوم في هذه الخطوة بجمع التقنيات التي تعلمناها في الخطوات السابقة. حيث سنقوم بالتأكد من أن المستخدم مسجل الدخول، سنقوم باستخدام تعليمة SQL لإنشاء موضوع ، وسننشئ نموذج html بسيط كواجهة مستخدم لإنشاء الموضوع.إن هيكلية ملف إنشاء الموضوع create_topic.php من الصعب شرحها ضمن قائمة أو ما شابه، لذا قمت بكتابة شرح للهيكل العام للملف كتوضيح:&lt;?phpif(user is signed in){ //the user is not signed in}else{ //the user is signed in if(form has not been posted) { //show form } else { //process form }}?&gt;وهذا هو الكود الحقيقي لهذا القسم من المنتدى ، راجع الشرح أسفل الكود لفهم ما يجري .&lt;?php//create_cat.phpinclude 'connect.php';include 'header.php'; echo '&lt;h2&gt;Create a topic&lt;/h2&gt;';if($_SESSION['signed_in'] == false){ //the user is not signed in echo 'Sorry, you have to be &lt;a href=&quot;/forum/signin.php&quot;&gt;signed in&lt;/a&gt; to create a topic.';}else{ //the user is signed in if($_SERVER['REQUEST_METHOD'] != 'POST') { //the form hasn't been posted yet, display it //retrieve the categories from the database for use in the dropdown $sql = &quot;SELECT cat_id, cat_name, cat_description FROM categories&quot;; $result = mysql_query($sql); if(!$result) { //the query failed, uh-oh :-( echo 'Error while selecting from database. Please try again later.'; } else { if(mysql_num_rows($result) == 0) { //there are no categories, so a topic can't be posted if($_SESSION['user_level'] == 1) { echo 'You have not created categories yet.'; } else { echo 'Before you can post a topic, you must wait for an admin to create some categories.'; } } else { echo '&lt;form method=&quot;post&quot; action=&quot;&quot;&gt; Subject: &lt;input type=&quot;text&quot; name=&quot;topic_subject&quot; /&gt; Category:'; echo '&lt;select name=&quot;topic_cat&quot;&gt;'; while($row = mysql_fetch_assoc($result)) { echo '&lt;option value=&quot;' . $row['cat_id'] . '&quot;&gt;' . $row['cat_name'] . '&lt;/option&gt;'; } echo '&lt;/select&gt;'; echo 'Message: &lt;textarea name=&quot;post_content&quot; /&gt;&lt;/textarea&gt; &lt;input type=&quot;submit&quot; value=&quot;Create topic&quot; /&gt; &lt;/form&gt;'; } } } else { //start the transaction $query = &quot;BEGIN WORK;&quot;; $result = mysql_query($query); if(!$result) { //Damn! the query failed, quit echo 'An error occured while creating your topic. Please try again later.'; } else { //the form has been posted, so save it //insert the topic into the topics table first, then we'll save the post into the posts table $sql = &quot;INSERT INTO topics(topic_subject, topic_date, topic_cat, topic_by) VALUES('&quot; . mysql_real_escape_string($_POST['topic_subject']) . &quot;', NOW(), &quot; . mysql_real_escape_string($_POST['topic_cat']) . &quot;, &quot; . $_SESSION['user_id'] . &quot; )&quot;; $result = mysql_query($sql); if(!$result) { //something went wrong, display the error echo 'An error occured while inserting your data. Please try again later.' . mysql_error(); $sql = &quot;ROLLBACK;&quot;; $result = mysql_query($sql); } else { //the first query worked, now start the second, posts query //retrieve the id of the freshly created topic for usage in the posts query $topicid = mysql_insert_id(); $sql = &quot;INSERT INTO posts(post_content, post_date, post_topic, post_by) VALUES ('&quot; . mysql_real_escape_string($_POST['post_content']) . &quot;', NOW(), &quot; . $topicid . &quot;, &quot; . $_SESSION['user_id'] . &quot; )&quot;; $result = mysql_query($sql); if(!$result) { //something went wrong, display the error echo 'An error occured while inserting your post. Please try again later.' . mysql_error(); $sql = &quot;ROLLBACK;&quot;; $result = mysql_query($sql); } else { $sql = &quot;COMMIT;&quot;; $result = mysql_query($sql); //after a lot of work, the query succeeded! echo 'You have successfully created &lt;a href=&quot;topic.php?id='. $topicid . '&quot;&gt;your new topic&lt;/a&gt;.'; } } } }} include 'footer.php';?&gt;سأناقش هذه الصفحة على قسمين: عرض النموذج ومعالجة النموذج.عرض النموذجلعرض النموذج فإننا نبدأ بتعليمات html بسيطة، ولكن في الواقع هناك شيئ خاص، ﻷننا نستخدم قائمة منسدلة، هذه القائمة المنسدلة يتم تعبئتها من خلال بيانات موجودة في قاعدة البيانات، يتم استخراج تلك البيانات باستخدام تعليمات SQL :SELECT cat_id, cat_name, cat_descriptionFROM categoriesأعتقد أن هذا هو الجزء الغير واضح هنا، والآن كما ترى هو مجرد كود بسيط .معالجة النموذجعملية حفظ الموضوع تتضمن مرحلتين: حفظ الموضوع في جدول المواضيع ضمن قاعدة البيانات، وحفظ أول تعليق في جدول التعليقات. وهذا يتطلب شيئ متقدم نوعاً ما وخارج موضوعنا هنا تقريباً، وهو يدعى إجراء transaction ، ويُقصد به أننا نبدأ بتنفيذ أمر البدء ثم التراجع إذا كان هناك أخطاء في قاعدة البيانات أو إنهاء التنفيذ عندما يجري كل شيئ بشكل صحيح.&lt;?php//start the transaction$query = &quot;BEGIN WORK;&quot;;$result = mysql_query($query);//stop the transaction$sql = &quot;ROLLBACK;&quot;;$result = mysql_query($sql);//commit the transaction$sql = &quot;COMMIT;&quot;;$result = mysql_query($sql);?&gt;أول تعليمة تستخدم لحفظ ابيانات هو تعليمة إنشاء موضوع، والتي تبدو على الشكل التالي :INSERT INTO topics(topic_subject, topic_date, topic_cat, topic_by)VALUES('&quot; . mysql_real_escape_string($_POST['topic_subject']) . &quot;', NOW(), &quot; . mysql_real_escape_string($_POST['topic_cat']) . &quot;, &quot; . $_SESSION['user_id'] . &quot;)في البداية تم تعريف الحقول، ثم القيم ليتم إدراجها في الحقول. لقد رأيت مثل هذه التعليمات سابقاً، حيث أنها مجرد تعليمات يتم تأمينها استخدام العبارة musql_real_escape_string() . القيمة الثانية : NOW() هي وظيفة في SQL لإدارج الوقت الحالي. القيمة الثالثة هي التي لم ترها من قبل، وهي تشير إلى معرف id صالح لتصنيف ما. والقيمة الأخيرة تشير لمعرف id مستخدم موجود بالفعل، وهو في حالتنا هي قيمة المتغير $_SESSION['user_id']. خيث تم مناقشة هذا المتغير خلال خطوة تسجيل الدخول .إذا تم تنفيذ الكود بدون أخطاء، فيتم الانتقال للخطوة التالية. تذكر أننا ما زالنا نجري إجراءاً هنا transaction . إذا حصلنا على أخطاء فسنستخدم تعليمة ROLLBACK.INSERT INTO posts(post_content, post_date, post_topic, post_by)VALUES ('&quot; . mysql_real_escape_string($_POST['post_content']) . &quot;', NOW(), &quot; . $topicid . &quot;, &quot; . $_SESSION['user_id'] . &quot;)إن أول شيئ نفعله هنا هو استخدام تعليمة mysql_insert_id() للحصول على آخر id تم توليده من حقل topic_id في جدول المواضيع. وكما وجدت في الخطوات الأولى، يتم توليد الـ id في قاعدة البيانات باستخدام تعليمة auto_increment.ثم يتم إدراج المنشور في جدول المنشورات post table. تبدو هذه العملية مشابهة لعملية المواضيع، الفرق الوحيد بينهما هو أن المنشور يشير إلى الموضوع والموضوع يشير للتصنيف. لقد قررنا من البداية إنشاء تصميم بيانات جيد، وهذه هي النتيجة.عاشراً : عرض التصنيفاتسوف نقوم بعمل صفحة عرض لتصنيف محدد. لقد أنشأنا تصنيفاً للتو ، ومن المفضل توفير إمكانية مشاهدة جميع المواضيع التي تتبع لهذا التصنيف. أولاً قم بإنشاء صفحة باسم category.phpنحتاج هنا لعدة أمور:1.أمور نحتاجها لعرض التصنيف: cat_name (اسم التصنيف) cat_description (وصف التصنيف) 2.أمور نحتاجها لعرض المواضيع ضمن ذلك التصنيف: topic_id (معرف الموضوع) topic_subject (عنوان الموضوع) topic_date (تاريخ الموضوع) topic_cat (تصنيف الموضوع) لنقم الآن بإنشاء تعليمتي SQL والتي تقوم باستخراج البيانات الني نريدها تحديداً من قاعدة البياناتSELECT cat_id, cat_name, cat_descriptionFROM categoriesWHERE cat_id = &quot; . mysql_real_escape_string($_GET['id'])تقوم التعليمة أعلاه باستخراج جميع التصنيفات من قاعدة البياناتSELECT topic_id, topic_subject, topic_date, topic_catFROM topicsWHERE topic_cat = &quot; . mysql_real_escape_string($_GET['id'])والآن ، الكود الكامل لملف category.php سيكون على الشكل التالي&lt;?php//create_cat.phpinclude 'connect.php';include 'header.php'; //first select the category based on $_GET['cat_id']$sql = &quot;SELECT cat_id, cat_name, cat_description FROM categories WHERE cat_id = &quot; . mysql_real_escape_string($_GET['id']); $result = mysql_query($sql); if(!$result){ echo 'The category could not be displayed, please try again later.' . mysql_error();}else{ if(mysql_num_rows($result) == 0) { echo 'This category does not exist.'; } else { //display category data while($row = mysql_fetch_assoc($result)) { echo '&lt;h2&gt;Topics in ′' . $row['cat_name'] . '′ category&lt;/h2&gt;'; } //do a query for the topics $sql = &quot;SELECT topic_id, topic_subject, topic_date, topic_cat FROM topics WHERE topic_cat = &quot; . mysql_real_escape_string($_GET['id']); $result = mysql_query($sql); if(!$result) { echo 'The topics could not be displayed, please try again later.'; } else { if(mysql_num_rows($result) == 0) { echo 'There are no topics in this category yet.'; } else { //prepare the table echo '&lt;table border=&quot;1&quot;&gt; &lt;tr&gt; &lt;th&gt;Topic&lt;/th&gt; &lt;th&gt;Created at&lt;/th&gt; &lt;/tr&gt;'; while($row = mysql_fetch_assoc($result)) { echo '&lt;tr&gt;'; echo '&lt;td class=&quot;leftpart&quot;&gt;'; echo '&lt;h3&gt;&lt;a href=&quot;topic.php?id=' . $row['topic_id'] . '&quot;&gt;' . $row['topic_subject'] . '&lt;/a&gt;&lt;h3&gt;'; echo '&lt;/td&gt;'; echo '&lt;td class=&quot;rightpart&quot;&gt;'; echo date('d-m-Y', strtotime($row['topic_date'])); echo '&lt;/td&gt;'; echo '&lt;/tr&gt;'; } } } }} include 'footer.php';?&gt;وهذه هي النتيجة النهائية لصفحة التصنيفاتالخطوة 11 : عرض المواضيعإن تعليمات SQL في هذه الخطوة هي تعليمات معقدة. بالنسبة لكود php فسيكون كله مألوفاً لديك وشبيه بما سبق. لذا دعنا نلقي نظرة الآن على تعليمات SQL . حيث التعليمة الأولى تستخرج معلومات أساسية حول الموضوع:SELECTtopic_id,topic_subjectFROMtopicsWHEREtopics.topic_id = &quot; . mysql_real_escape_string($_GET['id'])يتم عرض هذه المعلومات في رأس الجدول الذي سنستخدمه لعرض جميع البيانات. ثم سنستخرج جميع التعليقات على هذا الموضوع من قاعدة البيانات. التعليمة التالية تعطينا تماماً ما نريد:SELECTposts.post_topic,posts.post_content,posts.post_date,posts.post_by,users.user_id,users.user_nameFROMpostsLEFT JOINusersONposts.post_by = users.user_idWHEREposts.post_topic = &quot; . mysql_real_escape_string($_GET['id'])والآن نريد معلومات من جدول المستخدمين users وجدول التعليقات replies لذا سنستخدم عبارة LEFT JOIN مرة أخرى. حيث يكون الشرط كالتالي: معرف المستخدم user id يجب أن يكون نفسه في حقل reply_by (مؤلف التعليق) . وبهذه الطريقة نستطيع عرض اسم المستخدم للمستخدم الذي قام بإضافة تعليق ما.العرض الأخير للمواضيع سيبدو على الشكل :الخطوة 12 : إضافة تعليقوالآن دعنا ننهي آخر جزء متبقي لدينا من المنتدى، ألا وهو إمكانية إضافة تعليق. سنبدأ بعمل نموذج للتعليق (بلغة html) :&lt;form method=&quot;post&quot; action=&quot;reply.php?id=5&quot;&gt;&lt;textarea name=&quot;reply-content&quot;&gt;&lt;/textarea &gt;&lt;input type=&quot;submit&quot; value=&quot;Submit reply&quot; /&gt;&lt;/form&gt;وفي النهاية سيكون الكود الكامل لملف reply.php كالتالي: &lt;?php //create_cat.php include 'connect.php'; include 'header.php'; if($_SERVER['REQUEST_METHOD'] != 'POST') { //someone is calling the file directly, which we don't want echo 'This file cannot be called directly.'; } else { //check for sign in status if(!$_SESSION['signed_in']) { echo 'You must be signed in to post a reply.'; } else { //a real user posted a real reply $sql = &quot;INSERT INTO posts(post_content, post_date, post_topic, post_by) VALUES ('&quot; . $_POST['reply-content'] . &quot;', NOW(), &quot; . mysql_real_escape_string($_GET['id']) . &quot;, &quot; . $_SESSION['user_id'] . &quot;)&quot;; $result = mysql_query($sql); if(!$result) { echo 'Your reply has not been saved, please try again later.'; } else { echo 'Your reply has been saved, check out &lt;a href=&quot;topic.php?id=' . htmlentities($_GET['id']) . '&quot;&gt;the topic&lt;/a&gt;.'; } } } include 'footer.php'; ?&gt;انظر التعليقات ضمن الكود لفهم ما يجري.نتأكد أولاً من وجود المستخدم ثم نضيف (ندرج) التعليق لقاعدة البيانات.النهايةالآن وبعد قراءتك لهذا الشرح ستكون لديك المعرفة الكافية لبناء منتدى، أتمنى أن يكون الشرح واضحاً وأنك لم تعترك مع أية مشاكل في طريقك .."> <meta property="og:url" content="http://localhost:4000/php-forum-from-scratch/"> <meta property="og:site_name" content="موقع ملهم"> <meta property="og:image" content="http://localhost:4000/assets/img/logo.png"> <script> var host = "mulham.github.io"; if ((host == window.location.host) && (window.location.protocol != "https:")) window.location.protocol = "https"; </script> <meta name="yandex-verification" content="ea5684dc21acccc9"> <link rel="canonical" href="http://localhost:4000/php-forum-from-scratch/"> <link href="http://localhost:4000/feed.xml" type="application/atom+xml" rel="alternate" title="موقع ملهم Feed"> <!-- Handheld --> <meta name="HandheldFriendly" content="True"> <meta name="MobileOptimized" content="320"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- CSS --> <link rel="stylesheet" href="http://localhost:4000/assets/css/main.css"> <!-- JS --> <script src="http://localhost:4000/assets/js/modernizr-3.3.1.custom.min.js"></script> <!-- Favicons --> <link rel="apple-touch-icon" href="http://localhost:4000/assets/img/favicons/apple-icon-precomposed.png"> <link rel="apple-touch-icon" sizes="72x72" href="http://localhost:4000/assets/img/favicons/apple-icon-72x72.png"> <link rel="apple-touch-icon" sizes="114x114" href="http://localhost:4000/assets/img/favicons/apple-icon-114x114.png"> <link rel="apple-touch-icon" sizes="144x144" href="http://localhost:4000/assets/img/favicons/apple-icon-144x144.png"> <link rel="shortcut icon" type="image/png" href="http://localhost:4000/favicon.png"> <link rel="shortcut icon" href="http://localhost:4000/favicon.ico"> <!-- Background Image --> <style type="text/css">body {background-image:url(http://localhost:4000/assets/img/placeholder-big.jpg); background-repeat: no-repeat; background-size: cover; }</style> <!-- Post Feature Image --> </head> <body> <nav id="dl-menu" class="dl-menuwrapper" role="navigation"> <button class="dl-trigger">عرض القائمة</button> <ul class="dl-menu"> <li><a href="http://localhost:4000/">الرئيسيّة</a></li> <li> <a href="#">عن الموقع</a> <ul class="dl-submenu"> <li> <img src="http://localhost:4000/assets/img/logo.png" alt="موقع ملهم photo" class="author-photo"> <h4>موقع ملهم</h4> <p>شغف المعرفة</p> </li> <li><a href="http://localhost:4000/about/"><span class="btn btn-inverse">تعرّف أكثر</span></a></li> <li> <a href="mailto:mulham94@gmail.com" target="_blank" rel="noopener noreferrer"><i class="fa fa-fw fa-envelope-square"></i> البريد الإلكتروني</a> </li> <li> <a href="http://plus.google.com/+MulhamEB" target="_blank" rel="noopener noreferrer"><i class="fa fa-fw fa-google-plus-square"></i> Google+</a> </li> <li> <a href="http://linkedin.com/in/mulham-alibrahim-37b389121" target="_blank" rel="noopener noreferrer"><i class="fa fa-fw fa-linkedin-square"></i> LinkedIn</a> </li> <li> <a href="http://github.com/mulham" target="_blank" rel="noopener noreferrer"><i class="fa fa-fw fa-github"></i> Github</a> </li> <li> <a href="https://youtube.com/user/UCR9MjRHAD5VWXf9ASnOdh7Q" target="_blank" rel="noopener noreferrer"><i class="fa fa-fw fa-youtube-square"></i> يوتيوب</a> </li> </ul>
<!-- /.dl-submenu --> </li> <li> <a href="#">المدونة</a> <ul class="dl-submenu"> <li><a href="http://localhost:4000/posts/">جميع المشاركات</a></li> <li><a href="http://localhost:4000/tags/">جميع الوسوم</a></li> </ul> </li> <li><a href="http://localhost:4000/tutorials/">الدروس</a></li> <li><a href="http://localhost:4000/about/request">طلب ترجمة</a></li> <li><a href="http://localhost:4000/urls">روابط مفيدة</a></li> </ul>
<!-- /.dl-menu --> </nav><!-- /.dl-menuwrapper --> <!-- Header --> <header class="header" role="banner"> <div class="wrapper animated fadeIn"> <div class="content"> <div class="post-title "> <h1>إنشاء منتدى PHP من الصفر</h1> <h4>20 Jun 2016</h4> <p class="reading-time"> <i class="fa fa-clock-o"></i> مدة القراءة ~ 31 دقيقة </p>
<!-- /.entry-reading-time --> <a class="btn zoombtn" href="http://localhost:4000/posts/"> <i class="fa fa-chevron-left"></i> </a> </div> <p>هذا الدرس من تأليف Evert padje وترجمتي (ملهم)، يركّز الدرس على إنشاء منتدى باستخدام php و Mysql من أجل قاعدة بيانات المنتدى .. وهو لغرض تعليمي، يمكن معاينة المنتدى الناتج على <a href="http://inkshouse.heroicmice.com/forum/index.php">هذا الرابط</a></p> <p>سنقوم في هذا الشرح ببناء منتدى PHP/MySQL من الصفر. هذا الشرح أيضاً ممتاز للاعتياد على أساسيات لغة البرمجة php وقواعد بيانات MySQL . لنبدأ سويةً !</p> <ul id="markdown-toc"> <li>
<a href="#%D8%A3%D9%88%D9%84%D8%A7%D9%8B--%D8%A5%D9%86%D8%B4%D8%A7%D8%A1-%D8%AC%D8%AF%D8%A7%D9%88%D9%84-%D9%82%D8%A7%D8%B9%D8%AF%D8%A9-%D8%A7%D9%84%D8%A8%D9%8A%D8%A7%D9%86%D8%A7%D8%AA-" id="markdown-toc-أولاً--إنشاء-جداول-قاعدة-البيانات-">أولاً : إنشاء جداول قاعدة البيانات :</a> <ul> <li>
<a href="#%D8%AC%D8%AF%D9%88%D9%84-%D8%A7%D9%84%D9%85%D8%B3%D8%AA%D8%AE%D8%AF%D9%85%D9%8A%D9%86" id="markdown-toc-جدول-المستخدمين">جدول المستخدمين</a> <ul> <li><a href="#user_id" id="markdown-toc-user_id">user_id</a></li> <li><a href="#user_name" id="markdown-toc-user_name">user_name</a></li> <li><a href="#user_pass" id="markdown-toc-user_pass">user_pass</a></li> <li><a href="#user_email" id="markdown-toc-user_email">user_email</a></li> <li><a href="#user_date" id="markdown-toc-user_date">user_date</a></li> <li><a href="#user_level" id="markdown-toc-user_level">user_level</a></li> </ul> </li> <li><a href="#%D8%AC%D8%AF%D9%88%D9%84-%D8%A7%D9%84%D8%AA%D8%B5%D9%86%D9%8A%D9%81%D8%A7%D8%AA" id="markdown-toc-جدول-التصنيفات">جدول التصنيفات</a></li> <li><a href="#%D8%AC%D8%AF%D9%88%D9%84-%D8%A7%D9%84%D9%85%D9%88%D8%A7%D8%B6%D9%8A%D8%B9" id="markdown-toc-جدول-المواضيع">جدول المواضيع</a></li> <li><a href="#%D8%AC%D8%AF%D9%88%D9%84-%D8%A7%D9%84%D8%AA%D8%B9%D9%84%D9%8A%D9%82%D8%A7%D8%AA" id="markdown-toc-جدول-التعليقات">جدول التعليقات</a></li> </ul> </li> <li>
<a href="#%D8%AB%D8%A7%D9%86%D9%8A%D8%A7%D9%8B-%D9%85%D9%82%D8%AF%D9%85%D8%A9-%D9%84%D9%86%D8%B8%D8%A7%D9%85-%D8%A7%D9%84%D8%AA%D8%B1%D9%88%D9%8A%D8%B3%D8%A9%D8%A7%D9%84%D8%AA%D8%B0%D9%8A%D9%8A%D9%84" id="markdown-toc-ثانياً-مقدمة-لنظام-الترويسةالتذييل">ثانياً: مقدمة لنظام الترويسة/التذييل</a> <ul> <li><a href="#%D9%85%D9%84%D9%81-%D8%A7%D9%84%D8%AA%D8%B1%D9%88%D9%8A%D8%B3%D8%A9-headerphp" id="markdown-toc-ملف-الترويسة-headerphp">ملف الترويسة header.php</a></li> </ul> </li> <li><a href="#%D8%AB%D8%A7%D9%84%D8%AB%D8%A7%D9%8B-%D8%A7%D9%84%D8%A8%D8%AF%D8%A1-%D8%A8%D8%A7%D9%84%D8%AA%D9%86%D9%81%D9%8A%D8%B0-%D8%A7%D9%84%D9%81%D8%B9%D9%84%D9%8A" id="markdown-toc-ثالثاً-البدء-بالتنفيذ-الفعلي">ثالثاً: البدء بالتنفيذ الفعلي</a></li> <li><a href="#%D8%B1%D8%A7%D8%A8%D8%B9%D8%A7%D9%8B-%D8%B9%D8%B1%D8%B6-%D8%A7%D9%84%D9%85%D9%86%D8%AA%D8%AF%D9%89" id="markdown-toc-رابعاً-عرض-المنتدى">رابعاً: عرض المنتدى</a></li> <li>
<a href="#%D8%AE%D8%A7%D9%85%D8%B3%D8%A7%D9%8B-%D8%A7%D8%B4%D8%AA%D8%B1%D8%A7%D9%83-%D9%85%D8%B3%D8%AA%D8%AE%D8%AF%D9%85" id="markdown-toc-خامساً-اشتراك-مستخدم">خامساً: اشتراك مستخدم</a> <ul> <li><a href="#%D8%A7%D9%84%D8%AA%D8%A3%D9%83%D8%AF-%D9%85%D9%86-%D8%A7%D9%84%D8%A8%D9%8A%D8%A7%D9%86%D8%A7%D8%AA" id="markdown-toc-التأكد-من-البيانات">التأكد من البيانات</a></li> </ul> </li> <li><a href="#%D8%B3%D8%A7%D8%AF%D8%B3%D8%A7%D9%8B-%D8%A5%D8%B6%D8%A7%D9%81%D8%A9-%D8%A7%D9%84%D8%AA%D9%81%D8%B9%D9%8A%D9%84-%D9%88%D9%85%D8%B3%D8%AA%D9%88%D9%89-%D8%A7%D9%84%D9%85%D8%B3%D8%AA%D8%AE%D8%AF%D9%85" id="markdown-toc-سادساً-إضافة-التفعيل-ومستوى-المستخدم">سادساً: إضافة التفعيل ومستوى المستخدم</a></li> <li><a href="#%D8%B3%D8%A7%D8%A8%D8%B9%D8%A7%D9%8B-%D8%A5%D9%86%D8%B4%D8%A7%D8%A1-%D8%AA%D8%B5%D9%86%D9%8A%D9%81" id="markdown-toc-سابعاً-إنشاء-تصنيف">سابعاً: إنشاء تصنيف</a></li> <li><a href="#%D8%AB%D8%A7%D9%85%D9%86%D8%A7%D9%8B-%D8%A5%D8%B6%D8%A7%D9%81%D8%A9-%D8%AA%D8%B5%D9%86%D9%8A%D9%81%D8%A7%D8%AA-%D9%84%D9%84%D8%B5%D9%81%D8%AD%D8%A9-%D8%A7%D9%84%D8%B1%D8%A6%D9%8A%D8%B3%D9%8A%D8%A9-indexphp" id="markdown-toc-ثامناً-إضافة-تصنيفات-للصفحة-الرئيسية-indexphp">ثامناً: إضافة تصنيفات للصفحة الرئيسية index.php</a></li> <li>
<a href="#%D8%AA%D8%A7%D8%B3%D8%B9%D8%A7%D9%8B-%D8%A5%D9%86%D8%B4%D8%A7%D8%A1-%D9%85%D9%88%D8%B6%D9%88%D8%B9" id="markdown-toc-تاسعاً-إنشاء-موضوع">تاسعاً: إنشاء موضوع</a> <ul> <li><a href="#%D8%B9%D8%B1%D8%B6-%D8%A7%D9%84%D9%86%D9%85%D9%88%D8%B0%D8%AC" id="markdown-toc-عرض-النموذج">عرض النموذج</a></li> <li><a href="#%D9%85%D8%B9%D8%A7%D9%84%D8%AC%D8%A9-%D8%A7%D9%84%D9%86%D9%85%D9%88%D8%B0%D8%AC" id="markdown-toc-معالجة-النموذج">معالجة النموذج</a></li> </ul> </li> <li><a href="#%D8%B9%D8%A7%D8%B4%D8%B1%D8%A7%D9%8B--%D8%B9%D8%B1%D8%B6-%D8%A7%D9%84%D8%AA%D8%B5%D9%86%D9%8A%D9%81%D8%A7%D8%AA" id="markdown-toc-عاشراً--عرض-التصنيفات">عاشراً : عرض التصنيفات</a></li> <li><a href="#%D8%A7%D9%84%D8%AE%D8%B7%D9%88%D8%A9-11--%D8%B9%D8%B1%D8%B6-%D8%A7%D9%84%D9%85%D9%88%D8%A7%D8%B6%D9%8A%D8%B9" id="markdown-toc-الخطوة-11--عرض-المواضيع">الخطوة 11 : عرض المواضيع</a></li> <li><a href="#%D8%A7%D9%84%D8%AE%D8%B7%D9%88%D8%A9-12--%D8%A5%D8%B6%D8%A7%D9%81%D8%A9-%D8%AA%D8%B9%D9%84%D9%8A%D9%82" id="markdown-toc-الخطوة-12--إضافة-تعليق">الخطوة 12 : إضافة تعليق</a></li> <li><a href="#%D8%A7%D9%84%D9%86%D9%87%D8%A7%D9%8A%D8%A9" id="markdown-toc-النهاية">النهاية</a></li> </ul> <h1 id="أولاً--إنشاء-جداول-قاعدة-البيانات-">أولاً : إنشاء جداول قاعدة البيانات :</h1> <p>دائماً ، وقبل البدء بإنشاء أي تطبيق وب، من الجيد القيام بإنشاء قاعدة بيانات جيدة لإدخال البيانات بشكل جيد . لنصف تطبيقنا الذي نريد إنشاؤه بجملة واحدة : سنقوم بإنشاء منتدى يحوي على مستخدمين يقوموا بإنشاء مواضيع بـ تصنيفات مختلفة ، المستخدمين الآخرين يمكنهم إضافة تعليق .</p> <p>وكما ترى ، لقد قمت بالتركيز على كلمات معينة لتمثل أسماء الجداول في قاعدة البيانات التي نريدها .</p> <ul> <li> <p>المستخدمون users</p> </li> <li> <p>التصنيفات categories</p> </li> <li> <p>المواضيع topics</p> </li> <li> <p>التعليقات replies</p> </li> </ul> <p>العناصر الثلاثة الأخيرة مرتبطة ببعضها البعض ، لذا سنقوم بعمل ذلك في تصميم الجدول .</p> <blockquote> <p>يمكن إنشاء قاعدة بيانات MySQL باستخدام أوامر Sql ، ولكننا هنا سنستخدم برنامج بواجهة رسومية ليسهل العملية ويجعلها مفهومة أكثر ، وممتعة أكثر . البرنامج هو <a href="http://dev.mysql.com/downloads/workbench/">Workbench</a> ، يمكنك التعرف عليه أكثر من خلال هذه المشاركة ، ولكن ذلك غير مطلوب لفهم تكملة هذا الشرح .</p> </blockquote> <p>ألقِ نظرة على المخطط أدناه</p> <p><img src="/assets/php.png" alt="كيفية عمل منتدى باستخدام php و MySQL من الصفر" title="كيفية عمل منتدى باستخدام php و MySQL من الصفر"></p> <p>يبدو مرتباً أليس كذلك ؟ كل مربع هو عبارة عن جدول في قاعدة البيانات . جميع الأعمدة مدونة داخل كل جدول .. والخطوط بين الجداول تمثل العلاقة بينهم . سوف نشرح ذلك لاحقاً ، لا بأس إن لم تفهم الكثير الآن ..</p> <p>سوف نناقش كل جدول بشرح أوامر Sql . والتي تم إنشاءها تلقائياً مع إنشاء المخطط في الأعلى . لصنع كودك الخاص يمكنك إنشاء مخطط مشابه وستحصل على أوامر الـ Sql التي قامت بإنشاء المخطط أيضاً . بعض محررات قواعد البيانات مثل MySQL Workbench الذي قمنا بإستخدامه لإنتاج ذلك المخطط ينتج ملفات بلاحقة Sql أيضاً . ولكننا ننصح تعلم أوامر Sql حيث ستجد الأمر ممتعاً . لمقدمة حول Sql يمكنك قراءة المشاركة <a href="sql/intro">هنا</a> .</p> <h2 id="جدول-المستخدمين">جدول المستخدمين</h2> <figure class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">users</span> <span class="p">(</span>
<span class="n">user_id</span>
<span class="n">INT</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="n">AUTO_INCREMENT</span><span class="p">,</span>
<span class="n">user_name</span>
<span class="n">VARCHAR</span> <span class="p">(</span><span class="mi">30</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
<span class="n">user_pass</span>
<span class="n">VARCHAR</span> <span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
<span class="n">user_email</span> <span class="n">VARCHAR</span> <span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
<span class="n">user_date</span>
<span class="n">DATETIME</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
<span class="n">user_level</span> <span class="n">INT</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
<span class="k">UNIQUE</span> <span class="k">INDEX</span> <span class="n">user_name_unique</span> <span class="p">(</span><span class="n">user_name</span><span class="p">),</span>
<span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">user_id</span><span class="p">)</span>
<span class="p">)</span> <span class="k">TYPE</span><span class="o">=</span><span class="n">INNODB</span><span class="p">;</span></code></pre></figure> <p>تستخدم عبار <code class="highlighter-rouge">CREATE TABLE</code> لإنشاء جدول جديد. يتبع هذه العبارة اسم الجدول المراد إنشاؤه، ويتم وضع جميع أعمدة الجدول بين قوسين. بالنسبة لأسماء الحقول فهي تشرح نفسها بنفسها، لذا سنناقش الآن أنواع البيانات فقط.</p> <h3 id="user_id">user_id</h3> <p>مفتاح أولي يستخدم لتعريف كل عمود في الجدول بشكل فريد (غير قابل للتكرار). نوع هذا الحقل هو <code class="highlighter-rouge">INT</code>، وهذا يعني أن الحقل يجب أن يحوي على عدد صحيح (غير عشري). ولا يمكن لهذا الحقل أن يكون فارغاً بما أننا استخدمنا عبارة (NOT NULL). يمكن أن ترى في أسفل الجدول أن حقل user_id تم تحديده على أنه مفتاح أولي (primary key). يستخدم المفتاح الأولي كما ذكرنا لتعريف كل عمود في الجدول بشكل فريد،أي لا يمكن لأي عمودين في الجدول أن يكون لهم نفس القيمة لهذا الحقل. الكلام غير واضح؟ بالمثال يزول الإشكال :</p> <p>لدينا مستخدم على سبيل المثال يدعى أحمد، إذا قام مستخدم آخر بالتسجيل وبنفس الاسم، فسيكون هناك مشكلة. ﻷنه لا يمكن التفريق بين أحمد هذا وأحمد ذاك. لا يمكنك التفريق ولا يمكن حتى لقاعدة البيانات حينها التفريق بينهم. يتم حل هذه المشكلة باستخدام المتاح الأولي (primary key) ، حيث سيعطى للاسمين رقم مختلف.</p> <p>جميع الجداول الأخرى تحوي على مفاتيح أولية وتعمل بنفس الطريقة.</p> <h3 id="user_name">user_name</h3> <p>هذا حقل نصي (وليس رقمي كالحقل السابق). يدعي الحقل بلغة SQL حقل VARCHAR وهو أحد أنواع الحقول النصية. الرقم بين الأقواس هو أقصى طول لعدد الأحرف التي يمكن أن يتم إدخالها في الحقل. في حالتنا هذه يمكن للمستخدم اختيار اسم يبلغ طوله كحد أقصى 30 حرف. ولا يمكن لهذا الحقل أن يكون فارغاً (NOT NULL)، سترى أسفل الجدول أن هذا الحقل تم تحديده على أنه فريد (UNIQUE)، وهذا يعني أنه لا يمكن لشخصين التسجيل بنفس الاسم.</p> <p>الجزء الذي يحوي على عبارة <code class="highlighter-rouge">UNIQUE INDEX</code> يُخبر قاعدة البيانات أننا نريد إضافة مفتاح فريد (UNIQUE KEY)، بعدها قمنا بتحديد اسم المفتاح الفريد وهو هنا <code class="highlighter-rouge">user_name_unique</code> ، وبين الأقواس اسم الحقل الذي سينطبق المفتاح الفريد عليه (ليصبح غير قابل لتكرار قيمته مرتين في الجدول).</p> <h3 id="user_pass">user_pass</h3> <p>هذا الحقل نفس الحقل السابق، باستثناء الطول الأقصى له ، فبما أن كلمة سر المستخدم ومهما كان طولها سيتم تشفيرها لنوع تشفير sha1 ، فكلمة السر ستكون دائماً مع نوع التشفير هذا بطول 40 حرف.</p> <p>توضيح: حين تدخل أي كملة سر ولنفترض 123 أو لتكن mulham أو أي شيئ آخر ومهما يكن طول كلمة السر التي ستدخلها، يتم تطبيق تشفير لكلمة السر هذه قبل حفظها في قاعدة البيانات وذلك للأمان، بحيث اذا استطاع أحد ما بالوصول لقاعدة البيانات بالخطأ، فلن يتمكن من معرفة كلمات سر المستخدمين، وهناك أنواع كثير للتشفير منها هذا النوع <code class="highlighter-rouge">sha1</code> والذي يحول أي كلمة سر ل 40 حرف (أحرف وأرقام)، وعند نموذج دخول المستخدم (بعد اشتراكه)، نطبق نفس نوع التشفير على كلمة السر المدخلة لنقارن قيمة تشفير الكلمة المدخلة مع قيمة التشفير المحفوظة في قاعدة البيانات، فإذا طابقها، ولج المستخدم للموقع بشكل صحيح.</p> <h3 id="user_email">user_email</h3> <p>هذا الحقل هو تماماً نفس الحقل السابق (بالنسبة لقاعدة البيانات، أما لاحقاً عند عمل نموذج دخول بلغة HTML فيختلف الموضوع قليلاً )</p> <h3 id="user_date">user_date</h3> <p>في هذا الحقل يتم تخزين التاريخ الذي قام به المستخدم بالتسجيل. نوع هذا الحقل هو <code class="highlighter-rouge">DATETIME</code> ولا يمكن أن يكون فارغ. (يتم تعبئة الحقل تلقائياً بحسب توقيت السيرفر).</p> <h3 id="user_level">user_level</h3> <p>يحوي هذا الحقل مستوى المستخدم، على سبيل المثال: 0 للمستخدم العادي و 1 للمدير. ستتعرف على المزيد لاحقاً.</p> <h2 id="جدول-التصنيفات">جدول التصنيفات</h2> <figure class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">categories</span> <span class="p">(</span>
<span class="n">cat_id</span>
<span class="n">INT</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="n">AUTO_INCREMENT</span><span class="p">,</span>
<span class="n">cat_name</span>
<span class="n">VARCHAR</span> <span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
<span class="n">cat_description</span>
<span class="n">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
<span class="k">UNIQUE</span> <span class="k">INDEX</span> <span class="n">cat_name_unique</span> <span class="p">(</span><span class="n">cat_name</span><span class="p">),</span>
<span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">cat_id</span><span class="p">)</span>
<span class="p">)</span> <span class="k">TYPE</span><span class="o">=</span><span class="n">INNODB</span></code></pre></figure> <p>أنواع البيانات هنا تعمل بشكل أساسي بنفس الطريقة التي تعمل بها أنواع البيانات في جدول المستخدمين. يحوي هذا الجدول أيضاً مفتاح أولي ، واسم التصنيف يجب أن يكون فريد .</p> <h2 id="جدول-المواضيع">جدول المواضيع</h2> <figure class="highlight"><pre><code class="language-sql" data-lang="sql"> 

<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">topics</span> <span class="p">(</span>
<span class="n">topic_id</span>
<span class="n">INT</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="n">AUTO_INCREMENT</span><span class="p">,</span>
<span class="n">topic_subject</span>
<span class="n">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
<span class="n">topic_date</span>
<span class="n">DATETIME</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
<span class="n">topic_cat</span>
<span class="n">INT</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
<span class="n">topic_by</span>
<span class="n">INT</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
<span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">topic_id</span><span class="p">)</span>
<span class="p">)</span> <span class="k">TYPE</span><span class="o">=</span><span class="n">INNODB</span><span class="p">;</span></code></pre></figure> <p>هذا الجدول تقريباً نفس الجداول السابقة، باستثناء حقل <code class="highlighter-rouge">topic_by</code> والذي يشير للمستخدم المنشئ للموضوع. وحقل <code class="highlighter-rouge">topic_cat</code> الذي يشير للتصنيف الذي يتبع الموضوع له. لا يمكن تحديد العلاقات بين هذه الحقول بذكر أسماء الحقول فقط. فيجب أن نُعلم قاعدة البيانات أن هذا الحقل (<code class="highlighter-rouge">topic_by</code>) يجب أن يحتوي على الرقم التسلسلي <code class="highlighter-rouge">user_id</code> لمستخدم موجود في جدول المستخدمين، والحقل الآخر (<code class="highlighter-rouge">topic_cat</code>) يجب أن يحتوي على الرقم التسلسلي cat_id لتصنيف موجود في جدول التصنيفات. سنضيف هذه العلاقات بين الحقول والجداول بعد مناقشة جدول التعليقات.</p> <h2 id="جدول-التعليقات">جدول التعليقات</h2> <figure class="highlight"><pre><code class="language-sql" data-lang="sql"> 

<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">posts</span> <span class="p">(</span>
<span class="n">post_id</span>
<span class="n">INT</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="n">AUTO_INCREMENT</span><span class="p">,</span>
<span class="n">post_content</span>
<span class="n">TEXT</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
<span class="n">post_date</span>
<span class="n">DATETIME</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
<span class="n">post_topic</span>
<span class="n">INT</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
<span class="n">post_by</span>
<span class="n">INT</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
<span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">post_id</span><span class="p">)</span>
<span class="p">)</span> <span class="k">TYPE</span><span class="o">=</span><span class="n">INNODB</span><span class="p">;</span></code></pre></figure> <p>هذا الجدول هو نفس بقية الجداول، ويوجد هنا أيضاً حقل يشير لرقم مستخدم user_id في جدول المستخدمين : حقل <code class="highlighter-rouge">post_by</code> ، حقل <code class="highlighter-rouge">post_topic</code> يشير للموضوع الذي يتبع التعليق له .</p> <p>المفتاح الخارجي <code class="highlighter-rouge">foreign key</code> هو قيد مرجعي بين جدولين. يُعرِّف المفتاح الخارجي عمود أو مجموعة أعمدة في جدول (مرجعي) والذي يشير لعمود أو مجموعة أعمدة في جدول (مرجعي) آخر .</p> <p>الآن وبعد تنفيذ هذه التعليمات وإنشاء الجداول. أصبح لدينا ترتيب بيانات جيد، ولكن العلاقات بين هذه البيانات مازالت مفقودة. لنبدأ بتعريف أحد هذه العلاقات. سوف نستخدم شيئ يدعي المفتاح الخارجي. بعض الشروط لهذا الاستخدام:</p> <ul> <li> <p>العمود في الجدول المرجعي والذي يشير له المفتاح الخارجي يجب أن يكون مفتاح أولي.</p> </li> <li> <p>القيم المشار لها يجب أن تكون موجودة في الجدول المرجعي.</p> </li> </ul> <p>أعرف أن كل هذه المصطلحات جديدة عليك، ولكنك ستكتشف أنها بسيطة جداً، هي فقط علاقة بين جدول وآخر ، ستتضح لك الأمور في السطور القادمة.</p> <p>بإضافة مفاتيح خارجية تصبح المعلومات مرتبطة ببعضها، وهذا مهم جداً في ترتيب قاعدة البيانات.</p> <p>الآن أصبحت تعرف نوعاً ما ما هو المفتاح الخارجي ولماذا نستخدمه. حان الوقت لإضافة مفاتيح خارجية للجداول التي أنشأناها باستخدام عبارة <code class="highlighter-rouge">ALTER</code>، والتي تستخدم لتعديل جدول موجود مسبقاً.</p> <p>سنقوم في البداية بربط المواضيع بالتصنيفات:</p> <figure class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">topics</span> <span class="k">ADD</span> <span class="k">FOREIGN</span> <span class="k">KEY</span><span class="p">(</span><span class="n">topic_cat</span><span class="p">)</span> <span class="k">REFERENCES</span> <span class="n">categories</span><span class="p">(</span><span class="n">cat_id</span><span class="p">)</span> <span class="k">ON</span> <span class="k">DELETE</span> <span class="k">CASCADE</span> <span class="k">ON</span> <span class="k">UPDATE</span> <span class="k">CASCADE</span><span class="p">;</span></code></pre></figure> <p>الجزء الأخير من التعليمة يوضح ما يجري. فعندما يتم حذف التصنيف من قاعدة البيانات، جميع المواضيع المرتبطة بهذا التصنيف سيتم حذفها أيضاً. إذا تم تغيير قيمة cat_id لتصنيف ما، جميع المواضيع المرتبطة بهذا التصنيف سيتم تحديثها أيضاً. وهذا ما تقوم به عبارة <code class="highlighter-rouge">ON UPDATE CASCADE</code> . بالطبع يمكنك التراجع عن ذلك لحماية بياناتك، وذلك بجعل حذف تنصيف ما غير ممكن ما زال هناك مواضيع مرتبطة بهذا التصنيف، إذا أردت القيام بذلك، فعليك استبدال <code class="highlighter-rouge">ON DELETE</code> <code class="highlighter-rouge">CASCADE</code> إلى <code class="highlighter-rouge">ON DELETE RESTRICT</code> . يوجد أيضاً عبارات <code class="highlighter-rouge">SET NULL</code> أي اجعله فارغاً و <code class="highlighter-rouge">NO ACTION</code> أي لا تقم بأي إجراء.</p> <p>الآن، كل موضوع أصبح مرتبط بتصنيف ما. لنقم بربط المواضيع بالمستخدمين المنشئين لهم.</p> <figure class="highlight"><pre><code class="language-sql" data-lang="sql"> 

<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">topics</span> <span class="k">ADD</span> <span class="k">FOREIGN</span> <span class="k">KEY</span><span class="p">(</span><span class="n">topic_by</span><span class="p">)</span> <span class="k">REFERENCES</span> <span class="n">users</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span> <span class="k">ON</span> <span class="k">DELETE</span> <span class="k">RESTRICT</span> <span class="k">ON</span> <span class="k">UPDATE</span> <span class="k">CASCADE</span><span class="p">;</span></code></pre></figure> <p>المفتاح الخارجي هنا هو نفسه كسابقه، ولكن هناك فرق واحد: لا يمكن حذف المستخدم ما زال هناك مواضيع مرتبطة به، أو بالأحرى مرتبطة بـ <code class="highlighter-rouge">user_id</code> للمستخدم (رقمه التسلسلي في قاعدة البيانات). لم نضع هنا <code class="highlighter-rouge">ON DELETE CASCADE</code> ﻷننا لا نريد للمعلومات المرتبطة بحساب ما والتي قد تكون قيمة أن تُحذف عندما يقرر المستخدم حذف حسابه. لإبقاء خيار حذف الحساب متاحاً للمستخدمين، يجب أن تقوم بإنشاء ميزة تنقل المواضيع لحساب “مجهول” عند حذف مستخدم لحسابه. وفي الواقع هذا ليش موضوع نقاشنا في هذا الشرح.</p> <p>ربط التعليقات بالمواضيع:</p> <figure class="highlight"><pre><code class="language-sql" data-lang="sql"> 

<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">posts</span> <span class="k">ADD</span> <span class="k">FOREIGN</span> <span class="k">KEY</span><span class="p">(</span><span class="n">post_topic</span><span class="p">)</span> <span class="k">REFERENCES</span> <span class="n">topics</span><span class="p">(</span><span class="n">topic_id</span><span class="p">)</span> <span class="k">ON</span> <span class="k">DELETE</span> <span class="k">CASCADE</span> <span class="k">ON</span> <span class="k">UPDATE</span> <span class="k">CASCADE</span><span class="p">;</span></code></pre></figure> <p>وأخيراً، ربط كل تعليق بالمستخدم المنشئ له:</p> <figure class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">posts</span> <span class="k">ADD</span> <span class="k">FOREIGN</span> <span class="k">KEY</span><span class="p">(</span><span class="n">post_by</span><span class="p">)</span> <span class="k">REFERENCES</span> <span class="n">users</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span> <span class="k">ON</span> <span class="k">DELETE</span> <span class="k">RESTRICT</span> <span class="k">ON</span> <span class="k">UPDATE</span> <span class="k">CASCADE</span><span class="p">;</span></code></pre></figure> <p>انتهى الجزء الخاص بقاعدة البيانات! لقد كان عملاً متعباً نوعاً ما، ولكن النتيجة تستحق هذا العمل، حيث حصلنا على قاعدة بيانات نموذجبة.</p> <h1 id="ثانياً-مقدمة-لنظام-الترويسةالتذييل">ثانياً: مقدمة لنظام الترويسة/التذييل</h1> <p>كل صفحة في منتدانا تتطلب بعض الأشياء الأساسية، مثل بعض الترميزات والتنسيقات. ولذا سنقوم بتضمين ملف الترويسة header.php بأعلى كل صفحة في المنتدى، والتذييل footer.php أسفل كل صفحة. يتضمن ملف الترويسة الترميزات الأساسية وروابط للملفات التي يجب تحميلها لعرض المنتدى بشكل جيد، وكذلك بعض المعلومات المهمة حول المنتدى، مثل العنوان والأيقونة والشعار..</p> <h2 id="ملف-الترويسة-headerphp">ملف الترويسة header.php</h2> <figure class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"&gt;</span>
<span class="nt">&lt;html</span> <span class="na">xmlns=</span><span class="s">"http://www.w3.org/1999/xhtml"</span> <span class="na">xml:lang=</span><span class="s">"nl"</span> <span class="na">lang=</span><span class="s">"nl"</span><span class="nt">&gt;</span>
<span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">http-equiv=</span><span class="s">"Content-Type"</span> <span class="na">content=</span><span class="s">"text/html; charset=UTF-8"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">"description"</span> <span class="na">content=</span><span class="s">"A short description."</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">"keywords"</span> <span class="na">content=</span><span class="s">"put, keywords, here"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;title&gt;</span>PHP-MySQL forum<span class="nt">&lt;/title&gt;</span>
    <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"stylesheet"</span> <span class="na">href=</span><span class="s">"style.css"</span> <span class="na">type=</span><span class="s">"text/css"</span><span class="nt">&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
<span class="nt">&lt;h1&gt;</span>My forum<span class="nt">&lt;/h1&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"wrapper"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"menu"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"item"</span> <span class="na">href=</span><span class="s">"/forum/index.php"</span><span class="nt">&gt;</span>Home<span class="nt">&lt;/a&gt;</span> -
        <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"item"</span> <span class="na">href=</span><span class="s">"/forum/create_topic.php"</span><span class="nt">&gt;</span>Create a topic<span class="nt">&lt;/a&gt;</span> -
        <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"item"</span> <span class="na">href=</span><span class="s">"/forum/create_cat.php"</span><span class="nt">&gt;</span>Create a category<span class="nt">&lt;/a&gt;</span>
         
        <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"userbar"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"userbar"</span><span class="nt">&gt;</span>Hello Example. Not you? Log out.<span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"content"</span><span class="nt">&gt;</span></code></pre></figure> <p>سنستخدم وسم <code class="highlighter-rouge">&lt;div id="wrapper"&gt;</code> لجعل تنسيق كامل الصفحة أسهل. الوسم <code class="highlighter-rouge">&lt;div id="menu"&gt;</code> كما هو واضح يضم قائمة بروابط لصفحات الموقع التي سننشؤها لاحقاً. وسم <code class="highlighter-rouge">&lt;div id="userbar"&gt;</code> سيستخدم كشريط علوي يضم معلومات مثل اسم المستخدم ورابط لتسجيل الخروج. والوسم الأخير سيحوي بشكل واضح المعلومات الفعلية للصفحة التي يكون بها المستخدم.</p> <p>إذا كنت تقرأ بانتباه، فربما لاحظت أننا فقدنا شيئاً ما. فلم ننهي وسمي <code class="highlighter-rouge"><span class="nt">&lt;html&gt;</span></code> و <code class="highlighter-rouge">&lt;body&gt;</code> كما هو واجب في لغة html. أي لم نكتب في نهاية ملف الترويسة <code class="highlighter-rouge">&lt;/body&gt; &gt;/html&gt;</code> والسبب هو أننا سنضعهم في ملف التذييل <code class="highlighter-rouge">footer.php</code> :</p> <figure class="highlight"><pre><code class="language-php" data-lang="php"><span class="nt">&lt;/div&gt;</span><span class="c">&lt;!-- content --&gt;</span>
<span class="nt">&lt;/div&gt;</span><span class="c">&lt;!-- wrapper --&gt;</span>
<span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"footer"</span><span class="nt">&gt;</span>Created for Nettuts+<span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span></code></pre></figure> <p>عندما نضمّن ملفي الترويسة والتذييل في كل صفحة، فإن محتوى الصفحة الفعلي سيظهر بين الترويسة (بداية الصفحة) والتذييل (نهاية الصفحة). لهذه الطريقة عدة فوائد. أولها وأهمها أن كل شيئ سيكون منسق بشكل صحيح. مثال سريع :</p> <figure class="highlight"><pre><code class="language-php" data-lang="php"> 

<span class="cp">&lt;?php</span>
<span class="nv">$error</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
<span class="k">if</span><span class="p">(</span><span class="nv">$error</span> <span class="o">=</span> <span class="kc">false</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">//the beautifully styled content, everything looks good
</span>    <span class="k">echo</span> <span class="s1">'&lt;div id="content"&gt;some text&lt;/div&gt;'</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">else</span>
<span class="p">{</span>
    <span class="c1">//bad looking, unstyled error :-( 
</span><span class="p">}</span> 
<span class="cp">?&gt;</span></code></pre></figure> <p>كما ترى، إذا لم يحدث أخطاء في الصفحة فستظهر بشكل أنيق. أما اذا كان هناك خطأ، فكل شيئ سيكون مبعثر. ولهذا السبب يجب دائماً التأكد ليس من تنسيق المحتوى فقط، وإنما أيضاً من الأخطاء التي يمكن أن تحدث.</p> <p>ميزة أخرى لهذه الطريقة (تضمين ملفي الترويسة والتذييل) هو إمكانية عمل تغييرات سريعة. فسترى أنك وبعد إنهاء هذا الشرح إذا أردت التعديل على ملف التذييل مثلاً footer.php، فسترى أن التذييل سينطبق مباشرة على كل صفحة في المنتدى.</p> <p>أخيراً سوف نقوم بإضافة بعض التنسيقات والتي تزودنا بإظهارات وترميزات أساسية. لا شيئ معقد هنا، ولا داعي لفهم الكود.</p> <figure class="highlight"><pre><code class="language-css" data-lang="css"><span class="nt">body</span> <span class="p">{</span>
    <span class="nl">background-color</span><span class="p">:</span> <span class="m">#4E4E4E</span><span class="p">;</span>
    <span class="nl">text-align</span><span class="p">:</span> <span class="nb">center</span><span class="p">;</span>         <span class="c">/* make sure IE centers the page too */</span>
<span class="p">}</span>
 
<span class="nf">#wrapper</span> <span class="p">{</span>
    <span class="nl">width</span><span class="p">:</span> <span class="m">900px</span><span class="p">;</span>
    <span class="nl">margin</span><span class="p">:</span> <span class="m">0</span> <span class="nb">auto</span><span class="p">;</span>             <span class="c">/* center the page */</span>
<span class="p">}</span>
 
<span class="nf">#content</span> <span class="p">{</span>
    <span class="nl">background-color</span><span class="p">:</span> <span class="m">#fff</span><span class="p">;</span>
    <span class="nl">border</span><span class="p">:</span> <span class="m">1px</span> <span class="nb">solid</span> <span class="m">#000</span><span class="p">;</span>
    <span class="nl">float</span><span class="p">:</span> <span class="nb">left</span><span class="p">;</span>
    <span class="nl">font-family</span><span class="p">:</span> <span class="n">Arial</span><span class="p">;</span>
    <span class="nl">padding</span><span class="p">:</span> <span class="m">20px</span> <span class="m">30px</span><span class="p">;</span>
    <span class="nl">text-align</span><span class="p">:</span> <span class="nb">left</span><span class="p">;</span>
    <span class="nl">width</span><span class="p">:</span> <span class="m">100%</span><span class="p">;</span>                <span class="c">/* fill up the entire div */</span>
<span class="p">}</span>
 
<span class="nf">#menu</span> <span class="p">{</span>
    <span class="nl">float</span><span class="p">:</span> <span class="nb">left</span><span class="p">;</span>
    <span class="nl">border</span><span class="p">:</span> <span class="m">1px</span> <span class="nb">solid</span> <span class="m">#000</span><span class="p">;</span>
    <span class="nl">border-bottom</span><span class="p">:</span> <span class="nb">none</span><span class="p">;</span>        <span class="c">/* avoid a double border */</span>
    <span class="nl">clear</span><span class="p">:</span> <span class="nb">both</span><span class="p">;</span>                <span class="c">/* clear:both makes sure the content div doesn't float next to this one but stays under it */</span>
    <span class="nl">width</span><span class="p">:</span><span class="m">100%</span><span class="p">;</span>
    <span class="nl">height</span><span class="p">:</span><span class="m">20px</span><span class="p">;</span>
    <span class="nl">padding</span><span class="p">:</span> <span class="m">0</span> <span class="m">30px</span><span class="p">;</span>
    <span class="nl">background-color</span><span class="p">:</span> <span class="m">#FFF</span><span class="p">;</span>
    <span class="nl">text-align</span><span class="p">:</span> <span class="nb">left</span><span class="p">;</span>
    <span class="nl">font-size</span><span class="p">:</span> <span class="m">85%</span><span class="p">;</span>
<span class="p">}</span>
 
<span class="nf">#menu</span> <span class="nt">a</span><span class="nd">:hover</span> <span class="p">{</span>
    <span class="nl">background-color</span><span class="p">:</span> <span class="m">#009FC1</span><span class="p">;</span>
<span class="p">}</span>
 
<span class="nf">#userbar</span> <span class="p">{</span>
    <span class="nl">background-color</span><span class="p">:</span> <span class="m">#fff</span><span class="p">;</span>
    <span class="nl">float</span><span class="p">:</span> <span class="nb">right</span><span class="p">;</span>
    <span class="nl">width</span><span class="p">:</span> <span class="m">250px</span><span class="p">;</span>
<span class="p">}</span>
 
<span class="nf">#footer</span> <span class="p">{</span>
    <span class="nl">clear</span><span class="p">:</span> <span class="nb">both</span><span class="p">;</span>
<span class="p">}</span>
 
<span class="c">/* begin table styles */</span>
<span class="nt">table</span> <span class="p">{</span>
    <span class="nl">border-collapse</span><span class="p">:</span> <span class="nb">collapse</span><span class="p">;</span>
    <span class="nl">width</span><span class="p">:</span> <span class="m">100%</span><span class="p">;</span>
<span class="p">}</span>
 
<span class="nt">table</span> <span class="nt">a</span> <span class="p">{</span>
    <span class="nl">color</span><span class="p">:</span> <span class="m">#000</span><span class="p">;</span>
<span class="p">}</span>
 
<span class="nt">table</span> <span class="nt">a</span><span class="nd">:hover</span> <span class="p">{</span>
    <span class="nl">color</span><span class="p">:</span><span class="m">#373737</span><span class="p">;</span>
    <span class="nl">text-decoration</span><span class="p">:</span> <span class="nb">none</span><span class="p">;</span>
<span class="p">}</span>
 
<span class="nt">th</span> <span class="p">{</span>
    <span class="nl">background-color</span><span class="p">:</span> <span class="m">#B40E1F</span><span class="p">;</span>
    <span class="nl">color</span><span class="p">:</span> <span class="m">#F0F0F0</span><span class="p">;</span>
<span class="p">}</span>
 
<span class="nt">td</span> <span class="p">{</span>
    <span class="nl">padding</span><span class="p">:</span> <span class="m">5px</span><span class="p">;</span>
<span class="p">}</span>
 
<span class="c">/* Begin font styles */</span>
<span class="nt">h1</span><span class="o">,</span> <span class="nf">#footer</span> <span class="p">{</span>
    <span class="nl">font-family</span><span class="p">:</span> <span class="n">Arial</span><span class="p">;</span>
    <span class="nl">color</span><span class="p">:</span> <span class="m">#F1F3F1</span><span class="p">;</span>
<span class="p">}</span>
 
<span class="nt">h3</span> <span class="p">{</span><span class="nl">margin</span><span class="p">:</span> <span class="m">0</span><span class="p">;</span> <span class="nl">padding</span><span class="p">:</span> <span class="m">0</span><span class="p">;}</span>
 
<span class="c">/* Menu styles */</span>
<span class="nc">.item</span> <span class="p">{</span>
    <span class="nl">background-color</span><span class="p">:</span> <span class="m">#00728B</span><span class="p">;</span>
    <span class="nl">border</span><span class="p">:</span> <span class="m">1px</span> <span class="nb">solid</span> <span class="m">#032472</span><span class="p">;</span>
    <span class="nl">color</span><span class="p">:</span> <span class="m">#FFF</span><span class="p">;</span>
    <span class="nl">font-family</span><span class="p">:</span> <span class="n">Arial</span><span class="p">;</span>
    <span class="nl">padding</span><span class="p">:</span> <span class="m">3px</span><span class="p">;</span>
    <span class="nl">text-decoration</span><span class="p">:</span> <span class="nb">none</span><span class="p">;</span>
<span class="p">}</span>
 
<span class="nc">.leftpart</span> <span class="p">{</span>
    <span class="nl">width</span><span class="p">:</span> <span class="m">70%</span><span class="p">;</span>
<span class="p">}</span>
 
<span class="nc">.rightpart</span> <span class="p">{</span>
    <span class="nl">width</span><span class="p">:</span> <span class="m">30%</span><span class="p">;</span>
<span class="p">}</span>
 
<span class="nc">.small</span> <span class="p">{</span>
    <span class="nl">font-size</span><span class="p">:</span> <span class="m">75%</span><span class="p">;</span>
    <span class="nl">color</span><span class="p">:</span> <span class="m">#373737</span><span class="p">;</span>
<span class="p">}</span>
<span class="nf">#footer</span> <span class="p">{</span>
    <span class="nl">font-size</span><span class="p">:</span> <span class="m">65%</span><span class="p">;</span>
    <span class="nl">padding</span><span class="p">:</span> <span class="m">3px</span> <span class="m">0</span> <span class="m">0</span> <span class="m">0</span><span class="p">;</span>
<span class="p">}</span>
 
<span class="nc">.topic-post</span> <span class="p">{</span>
    <span class="nl">height</span><span class="p">:</span> <span class="m">100px</span><span class="p">;</span>
    <span class="nl">overflow</span><span class="p">:</span> <span class="nb">auto</span><span class="p">;</span>
<span class="p">}</span>
 
<span class="nc">.post-content</span> <span class="p">{</span>
    <span class="nl">padding</span><span class="p">:</span> <span class="m">30px</span><span class="p">;</span>
<span class="p">}</span>
 
<span class="nt">textarea</span> <span class="p">{</span>
    <span class="nl">width</span><span class="p">:</span> <span class="m">500px</span><span class="p">;</span>
    <span class="nl">height</span><span class="p">:</span> <span class="m">200px</span><span class="p">;</span>
<span class="p">}</span></code></pre></figure> <h1 id="ثالثاً-البدء-بالتنفيذ-الفعلي">ثالثاً: البدء بالتنفيذ الفعلي</h1> <p>قبل أن نستطيع قراءة أي شيئ من قاعدة البيانات، يجب أن نقيم اتصال بها. وهذا ما سيقوم به ملف connect.php الذي سنضمنه بكل ملف ننشؤه.</p> <figure class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="c1">//connect.php
</span><span class="nv">$server</span> <span class="o">=</span> <span class="s1">'localhost'</span><span class="p">;</span>
<span class="nv">$username</span>   <span class="o">=</span> <span class="s1">'usernamehere'</span><span class="p">;</span>
<span class="nv">$password</span>   <span class="o">=</span> <span class="s1">'passwordhere'</span><span class="p">;</span>
<span class="nv">$database</span>   <span class="o">=</span> <span class="s1">'databasenamehere'</span><span class="p">;</span>
 
<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nb">mysql_connect</span><span class="p">(</span><span class="nv">$server</span><span class="p">,</span> <span class="nv">$username</span><span class="p">,</span>  <span class="nv">$password</span><span class="p">))</span>
<span class="p">{</span>
    <span class="k">exit</span><span class="p">(</span><span class="s1">'Error: could not establish database connection'</span><span class="p">);</span>
<span class="p">}</span>
<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nb">mysql_select_db</span><span class="p">(</span><span class="nv">$database</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">exit</span><span class="p">(</span><span class="s1">'Error: could not select the database'</span><span class="p">);</span>
<span class="p">}</span>
<span class="cp">?&gt;</span></code></pre></figure> <p>ببساطة استبدل فقط القيم الافتراضية للمتغيرات في أعلى الكود ببياناتك الخاصة. احفظ الملف ودعنا ننطلق للكملة.</p> <h1 id="رابعاً-عرض-المنتدى">رابعاً: عرض المنتدى</h1> <p>بما أننا بدأنا بتقنيات أساسية، سنقوم بعمل طريقة عرض مبسطة للمنتدى الآن.</p> <figure class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="c1">//create_cat.php
</span><span class="k">include</span> <span class="s1">'connect.php'</span><span class="p">;</span>
<span class="k">include</span> <span class="s1">'header.php'</span><span class="p">;</span>
         
<span class="k">echo</span> <span class="s1">'&lt;tr&gt;'</span><span class="p">;</span>
    <span class="k">echo</span> <span class="s1">'&lt;td class="leftpart"&gt;'</span><span class="p">;</span>
        <span class="k">echo</span> <span class="s1">'&lt;h3&gt;&lt;a href="category.php?id="&gt;Category name&lt;/a&gt;&lt;/h3&gt; Category description goes here'</span><span class="p">;</span>
    <span class="k">echo</span> <span class="s1">'&lt;/td&gt;'</span><span class="p">;</span>
    <span class="k">echo</span> <span class="s1">'&lt;td class="rightpart"&gt;'</span><span class="p">;</span>
            <span class="k">echo</span> <span class="s1">'&lt;a href="topic.php?id="&gt;Topic subject&lt;/a&gt; at 10-10'</span><span class="p">;</span>
    <span class="k">echo</span> <span class="s1">'&lt;/td&gt;'</span><span class="p">;</span>
<span class="k">echo</span> <span class="s1">'&lt;/tr&gt;'</span><span class="p">;</span>
<span class="k">include</span> <span class="s1">'footer.php'</span><span class="p">;</span>
<span class="cp">?&gt;</span></code></pre></figure> <p>الآن اكتمل منتداك تقريباً. بفتحك لهذا الملف من السيرفر ستشاهد المنتدى بشكل أنيق وبسيط. سنقوم خلال بقية الشرح بتحديث هذا الملف لنحصل على النتيجة النهائية، خطوة بخطوة!</p> <h1 id="خامساً-اشتراك-مستخدم">خامساً: اشتراك مستخدم</h1> <p>دعنا الآن ننشئ نموذج اشتراك بسيط بلغة html حيث يمكن للمستخدمين الاشتراك بالمنتدى</p> <p><img src="/assets/2.png" alt="كيفية عمل منتدى باستخدام php و MySQL من الصفر-2" title="كيفية عمل منتدى باستخدام php و MySQL من الصفر-2"></p> <p>سنحتاج أيضاً لصفحة بلغة php لإرسال بيانات النموذج لقاعدة البيانات وإتمام اشتراك المستخدم. سنقوم باستخدام المتغير <code class="highlighter-rouge">$_SERVER</code> . المتغير <code class="highlighter-rouge">$_SERVER</code> يحوي مجموعة من القيم التي يتم تعيينها تلقائياً مع كل طلب. أحد هذه القيم هو <code class="highlighter-rouge">REQUEST_METHOD</code> . عندما يتم طلب صفحة بواسطة <code class="highlighter-rouge">GET</code> . فسيحمل هذا المتغير القيمة <code class="highlighter-rouge">GET</code> . وعندما يتم طلب الصفحة بواسطة <code class="highlighter-rouge">POST</code> ، فسيحمل المتغير القيمة <code class="highlighter-rouge">POST</code> . ولذا سنستخدم هذا المتغير لمعرفة إذا تم إرسال النموذج (بواسطة <code class="highlighter-rouge">POST</code>). انظر صفحة الاشتراك signup.php أدناه</p> <figure class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="c1">//signup.php
</span><span class="k">include</span> <span class="s1">'connect.php'</span><span class="p">;</span>
<span class="k">include</span> <span class="s1">'header.php'</span><span class="p">;</span>
 
<span class="k">echo</span> <span class="s1">'&lt;h3&gt;Sign up&lt;/h3&gt;'</span><span class="p">;</span>
 
<span class="k">if</span><span class="p">(</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">'REQUEST_METHOD'</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">'POST'</span><span class="p">)</span>
<span class="p">{</span>
    <span class="cm">/*the form hasn't been posted yet, display it
      note that the action="" will cause the form to post to the same page it is on */</span>
    <span class="k">echo</span> <span class="s1">'&lt;form method="post" action=""&gt;
        Username: &lt;input type="text" name="user_name" /&gt;
        Password: &lt;input type="password" name="user_pass"&gt;
        Password again: &lt;input type="password" name="user_pass_check"&gt;
        E-mail: &lt;input type="email" name="user_email"&gt;
        &lt;input type="submit" value="Add category" /&gt;
     &lt;/form&gt;'</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">else</span>
<span class="p">{</span>
    <span class="cm">/* so, the form has been posted, we'll process the data in three steps:
        1.  Check the data
        2.  Let the user refill the wrong fields (if necessary)
        3.  Save the data 
    */</span>
    <span class="nv">$errors</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span> <span class="cm">/* declare the array for later use */</span>
     
    <span class="k">if</span><span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">'user_name'</span><span class="p">]))</span>
    <span class="p">{</span>
        <span class="c1">//the user name exists
</span>        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nb">ctype_alnum</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">'user_name'</span><span class="p">]))</span>
        <span class="p">{</span>
            <span class="nv">$errors</span><span class="p">[]</span> <span class="o">=</span> <span class="s1">'The username can only contain letters and digits.'</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span><span class="p">(</span><span class="nb">strlen</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">'user_name'</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">30</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="nv">$errors</span><span class="p">[]</span> <span class="o">=</span> <span class="s1">'The username cannot be longer than 30 characters.'</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
        <span class="nv">$errors</span><span class="p">[]</span> <span class="o">=</span> <span class="s1">'The username field must not be empty.'</span><span class="p">;</span>
    <span class="p">}</span>
     
     
    <span class="k">if</span><span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">'user_pass'</span><span class="p">]))</span>
    <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">'user_pass'</span><span class="p">]</span> <span class="o">!=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">'user_pass_check'</span><span class="p">])</span>
        <span class="p">{</span>
            <span class="nv">$errors</span><span class="p">[]</span> <span class="o">=</span> <span class="s1">'The two passwords did not match.'</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
        <span class="nv">$errors</span><span class="p">[]</span> <span class="o">=</span> <span class="s1">'The password field cannot be empty.'</span><span class="p">;</span>
    <span class="p">}</span>
     
    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$errors</span><span class="p">))</span> <span class="cm">/*check for an empty array, if there are errors, they're in this array (note the ! operator)*/</span>
    <span class="p">{</span>
        <span class="k">echo</span> <span class="s1">'Uh-oh.. a couple of fields are not filled in correctly..'</span><span class="p">;</span>
        <span class="k">echo</span> <span class="s1">'&lt;ul&gt;'</span><span class="p">;</span>
        <span class="k">foreach</span><span class="p">(</span><span class="nv">$errors</span> <span class="k">as</span> <span class="nv">$key</span> <span class="o">=&gt;</span> <span class="nv">$value</span><span class="p">)</span> <span class="cm">/* walk through the array so all the errors get displayed */</span>
        <span class="p">{</span>
            <span class="k">echo</span> <span class="s1">'&lt;li&gt;'</span> <span class="o">.</span> <span class="nv">$value</span> <span class="o">.</span> <span class="s1">'&lt;/li&gt;'</span><span class="p">;</span> <span class="cm">/* this generates a nice error list */</span>
        <span class="p">}</span>
        <span class="k">echo</span> <span class="s1">'&lt;/ul&gt;'</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
        <span class="c1">//the form has been posted without, so save it
</span>        <span class="c1">//notice the use of mysql_real_escape_string, keep everything safe!
</span>        <span class="c1">//also notice the sha1 function which hashes the password
</span>        <span class="nv">$sql</span> <span class="o">=</span> <span class="s2">"INSERT INTO
                    users(user_name, user_pass, user_email ,user_date, user_level)
                VALUES('"</span> <span class="o">.</span> <span class="nb">mysql_real_escape_string</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">'user_name'</span><span class="p">])</span> <span class="o">.</span> <span class="s2">"',
                       '"</span> <span class="o">.</span> <span class="nb">sha1</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">'user_pass'</span><span class="p">])</span> <span class="o">.</span> <span class="s2">"',
                       '"</span> <span class="o">.</span> <span class="nb">mysql_real_escape_string</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">'user_email'</span><span class="p">])</span> <span class="o">.</span> <span class="s2">"',
                        NOW(),
                        0)"</span><span class="p">;</span>
                         
        <span class="nv">$result</span> <span class="o">=</span> <span class="nb">mysql_query</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nv">$result</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="c1">//something went wrong, display the error
</span>            <span class="k">echo</span> <span class="s1">'Something went wrong while registering. Please try again later.'</span><span class="p">;</span>
            <span class="c1">//echo mysql_error(); //debugging purposes, uncomment when needed
</span>        <span class="p">}</span>
        <span class="k">else</span>
        <span class="p">{</span>
            <span class="k">echo</span> <span class="s1">'Successfully registered. You can now &lt;a href="signin.php"&gt;sign in&lt;/a&gt; and start posting! :-)'</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
 
<span class="k">include</span> <span class="s1">'footer.php'</span><span class="p">;</span>
<span class="cp">?&gt;</span></code></pre></figure> <p>العديد من التوضيحات ستجدها في التعليقات الموضوعة ضمن الكود، لذا تأكد من قراءتها. معالجة البيانات تتم على ثلاثة مراحل:</p> <h2 id="التأكد-من-البيانات">التأكد من البيانات</h2> <p>اذا لم تكن البيانات صحيحة ومعبئة بشكل كامل، اعرض النموذج مرة أخرى. اذا كانت جميع البيانات صحيحة ومعبئة، احفظ البيانات في قاعدة البيانات.</p> <p>(ماذا تقصد بالتأكد من صحة البيانات اذا كانت البيانات تُدخل ﻷول مرة؟ أقصد بذلك أن هناك حقل مثلاً ليضع المستخدم بريده الإلكتروني، يتم تعريف هذا الحقل بلغة <code class="highlighter-rouge">html</code> على أنه بريد إلكتروني، يجب أن يحوي على <code class="highlighter-rouge">@</code> و نقطة ثم كوم أو نت أو أياً كان، إذا لم تكن البيانات المدخلة في هذا الحقل بالشكل المذكور، فالمستخدم في الواقع لم يدخل بريد إلكتروني فعلاً، وهناك بالتالي بيانات غير صحيحة في النموذج)</p> <p>الجزء المتعلق بـ php على كل حال يشرح نفسه بنفسه، يبقى تعليمات SQL التي تحتاج بعض الشرح.</p> <figure class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">INSERT</span> <span class="k">INTO</span>
       <span class="n">users</span><span class="p">(</span><span class="n">user_name</span><span class="p">,</span> <span class="n">user_pass</span><span class="p">,</span> <span class="n">user_email</span> <span class="p">,</span><span class="n">user_date</span><span class="p">,</span> <span class="n">user_level</span><span class="p">)</span>
<span class="k">VALUES</span><span class="p">(</span><span class="s1">'" . mysql_real_escape_string($_POST['</span><span class="n">user_name</span><span class="s1">']) . "'</span><span class="p">,</span>
       <span class="s1">'" . sha1($_POST['</span><span class="n">user_pass</span><span class="s1">']) . "'</span><span class="p">,</span>
       <span class="s1">'" . mysql_real_escape_string($_POST['</span><span class="n">user_email</span><span class="s1">']) . "'</span><span class="p">,</span>
       <span class="n">NOW</span><span class="p">(),</span> 
       <span class="mi">0</span><span class="p">);</span></code></pre></figure> <p>في السطر الأول لدينا عبارة <code class="highlighter-rouge">INSERT INTO</code> التي تستخدم لإضافة بيانات لقاعدة البيانات، وتم تحديد اسم الجدول في السطر الثاني. الكلمات التي بين قوسين تحدد أسماء الأعمدة التي نريد إدراج البيانات لها. عبارة VALUES تُخبر قاعدة البيانات أننا انتهينا من تحديد أسماء الأعمدة وجاء وقت تحديد القيم التي ستُضاف لهذه الأعمدة. ولدينا شيئ جديد هنا: <code class="highlighter-rouge">mysql_real_escape_string</code>. تستخدم هذه التعليمة لحماية بيانات المستخدم أثناء إرساله للنموذج، ويجب أن تُستخدم دائماً باستثاء بعض الحالات النادرة. السكريبتات التي لا تستخدم هذه التعليمة يكون اختراقها والوصول لبيانات النموذج المرسلة سهل جداً، فلا تخاطر بذلك واستخدم عبارة <code class="highlighter-rouge">mysql_real_escape_string()</code>.</p> <blockquote> <p>إيّاك أن تُدرج كلمة السر في قاعدة البيانات كما هي. يجب عليك دائماً تشفيرها.</p> </blockquote> <p>كما رأيت ، لقد قمنا باستخدام عبارة <code class="highlighter-rouge">sha1()</code> لتشفير كلمة سر المستخدم قبل حفظها في قاعدة البيانات، تذكر دائماً عمل هذه الخطوة في كل نموذج تقوم بعمله ويحوي على كلمة سر. فلو فرضنا أن أحد المخترقين قام بالوصول لقاعدة البيانات، وكانت كلمات السر غير مشفرة، فسيصبح بإمكانه الولوج لحساب أي مستخدم أو أي مدير في المنتدى وعمل ما يحلو له، أما لو كانت كلمات السر مشفرة فلن يتمكن من فعل ذلك قبل أن يفك تشفيرهم، وهذا مستحيل تقريباً .</p> <blockquote> <p>من الممكن استخدام أي نوع تشفير آخر بدلاً من <code class="highlighter-rouge">sha1()</code> ، مثل <code class="highlighter-rouge">md5()</code> . أنا استخدم النوع <code class="highlighter-rouge">sha1()</code> ﻷن المقاييس أثبتت أن هذا النوع أسرع بقليل.</p> </blockquote> <p>اذا نجحت عملية الاشتراك فستحصل على التالي</p> <p><img src="/assets/3.png" alt="كيفية عمل منتدى باستخدام php و MySQL من الصفر-3" title="كيفية عمل منتدى باستخدام php و MySQL من الصفر-3"></p> <p>قم بتحديث صفحة قاعدة البيانات في phpMyAdmin ، يجب أن ترى تسجيلاً جديداً في جدول المستخدمين users</p> <h1 id="سادساً-إضافة-التفعيل-ومستوى-المستخدم">سادساً: إضافة التفعيل ومستوى المستخدم</h1> <p>إن من المزايا الهامة في المنتدى هو الفرق بين المستخدم العادي والمدير/المشرف. وبما أننا نناقش هنا منتجى صغير وبسيط وأن إضافة مزايا سيأخذ وقتاً طويلاً، فسنركز هنا على عملية تسجيل الدخول وإضافة بعض المزايا للمدراء مثل إضافة تصنيفات جديدة وإغلاق نقاش.</p> <p>والآن بعد إكمال الخطوة السابقة، سنقوم بجعل الحساب الذي أنشأته للتو حساب مدير. اذهب لـ phpMyAdmin واضغط على جدول المستخدمين users ثم اضغط على خيار Browse . سيظهر لك الحساب الذي أنشأته، اضغط على أيقونة التعديل edit وقم بتغيير قيمة الحقل <code class="highlighter-rouge">user_level</code> من 0 إلى 1 .</p> <p>حالياً لن تلاحظ أي فرق في المنتدى، ولكن عندما نضيف مزايا المدير سيصبح هناك فروقات في الصلاحيات بين الحساب العادي وهذا الحساب.</p> <p><strong>عملية تسجيل الدخول تعمل كالتالي:</strong></p> <ul> <li> <p>يقوم الزائر بإدخال بيانات المستخدم ويرسل النموذج.</p> </li> <li> <p>إذا كان اسم المستخدم وكلمة السر المدخلين صحيحين، فيمكن الآن بدء الجلسة (session) اذا كان اسم المستخدم أو كلمة المرور غير صحيحين، نقوم بإظهار النموذج مرة أخرى مع رسالة خطأ.</p> </li> </ul> <p><img src="/assets/6.png" alt="كيفية عمل منتدى باستخدام php و MySQL من الصفر-4" title="كيفية عمل منتدى باستخدام php و MySQL من الصفر-4"></p> <p>بالأسفل ملف تسجيل الدخول signin.php . اطلع على التعليقات ضمن الكود لفهم ما يجري</p> <figure class="highlight"><pre><code class="language-php" data-lang="php"> 

<span class="cp">&lt;?php</span>
<span class="c1">//signin.php
</span><span class="k">include</span> <span class="s1">'connect.php'</span><span class="p">;</span>
<span class="k">include</span> <span class="s1">'header.php'</span><span class="p">;</span>
 
<span class="k">echo</span> <span class="s1">'&lt;h3&gt;Sign in&lt;/h3&gt;'</span><span class="p">;</span>
 
<span class="c1">//first, check if the user is already signed in. If that is the case, there is no need to display this page
</span><span class="k">if</span><span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">'signed_in'</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">'signed_in'</span><span class="p">]</span> <span class="o">==</span> <span class="kc">true</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">echo</span> <span class="s1">'You are already signed in, you can &lt;a href="signout.php"&gt;sign out&lt;/a&gt; if you want.'</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">else</span>
<span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">'REQUEST_METHOD'</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">'POST'</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="cm">/*the form hasn't been posted yet, display it
          note that the action="" will cause the form to post to the same page it is on */</span>
        <span class="k">echo</span> <span class="s1">'&lt;form method="post" action=""&gt;
            Username: &lt;input type="text" name="user_name" /&gt;
            Password: &lt;input type="password" name="user_pass"&gt;
            &lt;input type="submit" value="Sign in" /&gt;
         &lt;/form&gt;'</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
        <span class="cm">/* so, the form has been posted, we'll process the data in three steps:
            1.  Check the data
            2.  Let the user refill the wrong fields (if necessary)
            3.  Varify if the data is correct and return the correct response
        */</span>
        <span class="nv">$errors</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span> <span class="cm">/* declare the array for later use */</span>
         
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">'user_name'</span><span class="p">]))</span>
        <span class="p">{</span>
            <span class="nv">$errors</span><span class="p">[]</span> <span class="o">=</span> <span class="s1">'The username field must not be empty.'</span><span class="p">;</span>
        <span class="p">}</span>
         
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">'user_pass'</span><span class="p">]))</span>
        <span class="p">{</span>
            <span class="nv">$errors</span><span class="p">[]</span> <span class="o">=</span> <span class="s1">'The password field must not be empty.'</span><span class="p">;</span>
        <span class="p">}</span>
         
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$errors</span><span class="p">))</span> <span class="cm">/*check for an empty array, if there are errors, they're in this array (note the ! operator)*/</span>
        <span class="p">{</span>
            <span class="k">echo</span> <span class="s1">'Uh-oh.. a couple of fields are not filled in correctly..'</span><span class="p">;</span>
            <span class="k">echo</span> <span class="s1">'&lt;ul&gt;'</span><span class="p">;</span>
            <span class="k">foreach</span><span class="p">(</span><span class="nv">$errors</span> <span class="k">as</span> <span class="nv">$key</span> <span class="o">=&gt;</span> <span class="nv">$value</span><span class="p">)</span> <span class="cm">/* walk through the array so all the errors get displayed */</span>
            <span class="p">{</span>
                <span class="k">echo</span> <span class="s1">'&lt;li&gt;'</span> <span class="o">.</span> <span class="nv">$value</span> <span class="o">.</span> <span class="s1">'&lt;/li&gt;'</span><span class="p">;</span> <span class="cm">/* this generates a nice error list */</span>
            <span class="p">}</span>
            <span class="k">echo</span> <span class="s1">'&lt;/ul&gt;'</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">else</span>
        <span class="p">{</span>
            <span class="c1">//the form has been posted without errors, so save it
</span>            <span class="c1">//notice the use of mysql_real_escape_string, keep everything safe!
</span>            <span class="c1">//also notice the sha1 function which hashes the password
</span>            <span class="nv">$sql</span> <span class="o">=</span> <span class="s2">"SELECT 
                        user_id,
                        user_name,
                        user_level
                    FROM
                        users
                    WHERE
                        user_name = '"</span> <span class="o">.</span> <span class="nb">mysql_real_escape_string</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">'user_name'</span><span class="p">])</span> <span class="o">.</span> <span class="s2">"'
                    AND
                        user_pass = '"</span> <span class="o">.</span> <span class="nb">sha1</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">'user_pass'</span><span class="p">])</span> <span class="o">.</span> <span class="s2">"'"</span><span class="p">;</span>
                         
            <span class="nv">$result</span> <span class="o">=</span> <span class="nb">mysql_query</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
            <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nv">$result</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="c1">//something went wrong, display the error
</span>                <span class="k">echo</span> <span class="s1">'Something went wrong while signing in. Please try again later.'</span><span class="p">;</span>
                <span class="c1">//echo mysql_error(); //debugging purposes, uncomment when needed
</span>            <span class="p">}</span>
            <span class="k">else</span>
            <span class="p">{</span>
                <span class="c1">//the query was successfully executed, there are 2 possibilities
</span>                <span class="c1">//1. the query returned data, the user can be signed in
</span>                <span class="c1">//2. the query returned an empty result set, the credentials were wrong
</span>                <span class="k">if</span><span class="p">(</span><span class="nb">mysql_num_rows</span><span class="p">(</span><span class="nv">$result</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="k">echo</span> <span class="s1">'You have supplied a wrong user/password combination. Please try again.'</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="k">else</span>
                <span class="p">{</span>
                    <span class="c1">//set the $_SESSION['signed_in'] variable to TRUE
</span>                    <span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">'signed_in'</span><span class="p">]</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
                     
                    <span class="c1">//we also put the user_id and user_name values in the $_SESSION, so we can use it at various pages
</span>                    <span class="k">while</span><span class="p">(</span><span class="nv">$row</span> <span class="o">=</span> <span class="nb">mysql_fetch_assoc</span><span class="p">(</span><span class="nv">$result</span><span class="p">))</span>
                    <span class="p">{</span>
                        <span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">'user_id'</span><span class="p">]</span>    <span class="o">=</span> <span class="nv">$row</span><span class="p">[</span><span class="s1">'user_id'</span><span class="p">];</span>
                        <span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">'user_name'</span><span class="p">]</span>  <span class="o">=</span> <span class="nv">$row</span><span class="p">[</span><span class="s1">'user_name'</span><span class="p">];</span>
                        <span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">'user_level'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$row</span><span class="p">[</span><span class="s1">'user_level'</span><span class="p">];</span>
                    <span class="p">}</span>
                     
                    <span class="k">echo</span> <span class="s1">'Welcome, '</span> <span class="o">.</span> <span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">'user_name'</span><span class="p">]</span> <span class="o">.</span> <span class="s1">'. &lt;a href="index.php"&gt;Proceed to the forum overview&lt;/a&gt;.'</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
 
<span class="k">include</span> <span class="s1">'footer.php'</span><span class="p">;</span>
<span class="cp">?&gt;</span></code></pre></figure> <p>كما لاحظت، هذه هي تعليمات SQL في الكود السابق</p> <figure class="highlight"><pre><code class="language-sql" data-lang="sql"> 

<span class="k">SELECT</span>
    <span class="n">user_id</span><span class="p">,</span>
    <span class="n">user_name</span><span class="p">,</span>
    <span class="n">user_level</span>
<span class="k">FROM</span>
    <span class="n">users</span>
<span class="k">WHERE</span>
    <span class="n">user_name</span> <span class="o">=</span> <span class="s1">'" . mysql_real_escape_string($_POST['</span><span class="n">user_name</span><span class="s1">']) . "'</span>
<span class="k">AND</span>
    <span class="n">user_pass</span> <span class="o">=</span> <span class="s1">'" . sha1($_POST['</span><span class="n">user_pass</span><span class="s1">'])</span></code></pre></figure> <p>من الواضح أننا نقوم بالتأكد من البيانات المدخلة إذا كانت لمستخدم موجود بالفعل. هناك العديد من السكريبتات التي تستخرج كلمة السر من قاعدة البيانات وتقارنها مع تلك المدخلة في النموذج باستخدام php. ولكن القيام بذلك بواسطة تعليمات SQL مباشرة سيجعل العملية أكثر أمناً حيث أن العملية هذه تحصل في وسط قاعدة البيانات وليس ضمن تطبيقنا الوب (منتدانا).</p> <p>إذا قام المستخدم بتسجيل الدخول بشكل صحيح، فسنقوم بعمل بضعة أشياء:</p> <figure class="highlight"><pre><code class="language-php" data-lang="php"> 

<span class="cp">&lt;?php</span>
<span class="c1">//set the $_SESSION['signed_in'] variable to TRUE
</span><span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">'signed_in'</span><span class="p">]</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
<span class="c1">//we also put the user_id and user_name values in the $_SESSION, so we can use it at various pages
</span><span class="k">while</span><span class="p">(</span><span class="nv">$row</span> <span class="o">=</span> <span class="nb">mysql_fetch_assoc</span><span class="p">(</span><span class="nv">$result</span><span class="p">))</span>
<span class="p">{</span>
    <span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">'user_id'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$row</span><span class="p">[</span><span class="s1">'user_id'</span><span class="p">];</span>
    <span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">'user_name'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$row</span><span class="p">[</span><span class="s1">'user_name'</span><span class="p">];</span> 
<span class="p">}</span>
<span class="cp">?&gt;</span></code></pre></figure> <p>في البداية، قمنا بإعطاء المتغير <code class="highlighter-rouge">$_SESSION['signed_in']</code> القيمة <code class="highlighter-rouge">true</code> أي أننا بدأنا الجلسة والمستخدم الآن مسجل الدخول. وسنقوم باستخدام هذا المتغير في صفحات أخرى للتأكد من أن المستخدم مسجل الدخول. أيضاً قمنا بوضع اسم المستخدم <code class="highlighter-rouge">username</code> ومعرفه <code class="highlighter-rouge">user_id</code> في المتغير <code class="highlighter-rouge">$_SESSION</code> للاستخدام في صفحات أخرى. أخيراً، سنقوم بعرض رابط لرئيسية المنتدى حيث يمكن للمستخدم البدء في الإبحار.</p> <p>تسجيل الدخول بالطبع يتطلب وظيفة أخرى وهي تسجيل الخروج! في الواقع عملية تسجيل الخروج أسهل بكثير من عملية تسجيل الدخول، فبما أن جميع المعلومات مخزنة في متغيرات <code class="highlighter-rouge">$_SESSION</code> ، فكل ما علينا فعله هو إلغاء تعيينهم في هذا المتغير وعرض رسالة للمستخدم.</p> <p>الآن قمنا بضبط متغيرات <code class="highlighter-rouge">$_SESSION</code> ، يمكننا تحديد اذا كان شخص ما مسجل الدخول. دعنا نقوم الآن بعمل تغيير أخير على ملف الترويسة header.php قم باستبدال التالي في الملف:</p> <figure class="highlight"><pre><code class="language-php" data-lang="php"><span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"userbar"</span><span class="nt">&gt;</span>Hello Example. Not you? Log out.<span class="nt">&lt;/div&gt;</span></code></pre></figure> <p>إلى :</p> <figure class="highlight"><pre><code class="language-php" data-lang="php"> 

<span class="cp">&lt;?php</span>
<span class="o">&lt;</span><span class="nx">div</span> <span class="nx">id</span><span class="o">=</span><span class="s2">"userbar"</span><span class="o">&gt;</span>
    <span class="k">if</span><span class="p">(</span><span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">'signed_in'</span><span class="p">])</span>
    <span class="p">{</span>
        <span class="k">echo</span> <span class="s1">'Hello'</span> <span class="o">.</span> <span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">'user_name'</span><span class="p">]</span> <span class="o">.</span> <span class="s1">'. Not you? &lt;a href="signout.php"&gt;Sign out&lt;/a&gt;'</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
        <span class="k">echo</span> <span class="s1">'&lt;a href="signin.php"&gt;Sign in&lt;/a&gt; or &lt;a href="sign up"&gt;create an account&lt;/a&gt;.'</span><span class="p">;</span>
    <span class="p">}</span>
<span class="o">&lt;/</span><span class="nx">div</span><span class="o">&gt;</span></code></pre></figure> <p>وبالتالي، إذا قام المستخدم بتسجيل الدخول، فسيرى اسمه معروض في بداية الصفحة مع رابط لصفحة تسجيل الخروج.</p> <p>نجحت طريقة التفعيل! والآن يبدو منتدانا كالتالي :</p> <p><img src="/assets/4.png" alt="كيفية عمل منتدى باستخدام php و MySQL من الصفر-5" title="كيفية عمل منتدى باستخدام php و MySQL من الصفر-5"></p> <h1 id="سابعاً-إنشاء-تصنيف">سابعاً: إنشاء تصنيف</h1> <p>نحن نريد إنشاء تصانيف في المنتدى، لذا دعنا ننشئ نموذج لهذه العملية</p> <figure class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;form</span> <span class="na">method=</span><span class="s">"post"</span> <span class="na">action=</span><span class="s">""</span><span class="nt">&gt;</span>
    Category name: <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"cat_name"</span> <span class="nt">/&gt;</span>
    Category description: <span class="nt">&lt;textarea</span> <span class="na">name=</span><span class="s">"cat_description"</span> <span class="nt">/&gt;&lt;/textarea&gt;</span>
    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">value=</span><span class="s">"Add category"</span> <span class="nt">/&gt;</span>
 <span class="nt">&lt;/form&gt;</span></code></pre></figure> <p>تبدو هذه الخطوة مثل الخطوة الرابعة (اشتراك مستخدم). لذا لن أقوم بالشرح هنا ، فبما أنك متابع للخطوات فستكون قادراً على فهم الأمور بشكل سريع.</p> <p>سنقوم تضمين النموذج في الأعلى ضمن صفحة إنشاء تصنيف :</p> <figure class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="c1">//create_cat.php
</span><span class="k">include</span> <span class="s1">'connect.php'</span><span class="p">;</span>
 
<span class="k">if</span><span class="p">(</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">'REQUEST_METHOD'</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">'POST'</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">//the form hasn't been posted yet, display it
</span>    <span class="k">echo</span> <span class="s1">'&lt;form method='</span><span class="nx">post</span><span class="s1">' action=''&gt;
        Category name: &lt;input type='</span><span class="nx">text</span><span class="s1">' name='</span><span class="nx">cat_name</span><span class="s1">' /&gt;
        Category description: &lt;textarea name='</span><span class="nx">cat_description</span><span class="s1">' /&gt;&lt;/textarea&gt;
        &lt;input type='</span><span class="nx">submit</span><span class="s1">' value='</span><span class="nx">Add</span> <span class="nx">category</span><span class="s1">' /&gt;
     &lt;/form&gt;'</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">else</span>
<span class="p">{</span>
    <span class="c1">//the form has been posted, so save it
</span>    <span class="nv">$sql</span> <span class="o">=</span> <span class="err">ì</span><span class="nx">INSERT</span> <span class="nx">INTO</span> <span class="nx">categories</span><span class="p">(</span><span class="nx">cat_name</span><span class="p">,</span> <span class="nx">cat_description</span><span class="p">)</span>
       <span class="nx">VALUES</span><span class="p">(</span><span class="s1">''</span> <span class="o">.</span> <span class="nb">mysql_real_escape_string</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">'cat_name'</span><span class="p">])</span> <span class="o">.</span> <span class="err">ì</span><span class="s1">',
             '' . mysql_real_escape_string($_POST['</span><span class="nx">cat_description</span><span class="s1">']) . ì'</span><span class="p">)</span><span class="s1">';
    $result = mysql_query($sql);
    if(!$result)
    {
        //something went wrong, display the error
        echo '</span><span class="nx">Error</span><span class="s1">' . mysql_error();
    }
    else
    {
        echo '</span><span class="nx">New</span> <span class="nx">category</span> <span class="nx">successfully</span> <span class="nx">added</span><span class="o">.</span><span class="err">'</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span></code></pre></figure> <p>وكما ترى، لقد بدأنا السكريبت بفحص السيرفر $_SERVER ، بعد التأكد من أن المستخدم لديه صلاحيات المدير، والمطلوبة لإنشاء تصنيف، يتم عرض النموذج إذا لم يتم تعبئته وإرساله سابقاً، وإذا تم إرساله، يتم حفظ القيم. مرة أخرى ، يتم تحضير تعليمة SQL وتنفيذها.</p> <p><img src="/assets/5.png" alt="كيفية عمل منتدى باستخدام php و MySQL من الصفر-6" title="كيفية عمل منتدى باستخدام php و MySQL من الصفر-6"></p> <h1 id="ثامناً-إضافة-تصنيفات-للصفحة-الرئيسية-indexphp">ثامناً: إضافة تصنيفات للصفحة الرئيسية index.php</h1> <p>لقد قمنا بإنشاء بعض التصنيفات، ويمكننا الآن عرضهم في الصفحة الرئيسية. دعنا نضيف تعليمة SQL التالية لمنظقة المحتوى في الصفحة الرئيسية index.php</p> <figure class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">SELECT</span>
    <span class="n">categories</span><span class="p">.</span><span class="n">cat_id</span><span class="p">,</span>
    <span class="n">categories</span><span class="p">.</span><span class="n">cat_name</span><span class="p">,</span>
    <span class="n">categories</span><span class="p">.</span><span class="n">cat_description</span><span class="p">,</span>
<span class="k">FROM</span>
    <span class="n">categories</span></code></pre></figure> <p>تقوم هذه التعليمة بتحديد جميع التصنيفات وأسمائهم ووصفهم من جدول التصنيفات. سنحتاج الآن لبضعة أسطر php لعرض النتائج. إذا قمنا بإضافة التعليمة كما فعلنا في الخطوات السابقة، فسيبدو الكود على الشكل:</p> <figure class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="c1">//create_cat.php
</span><span class="k">include</span> <span class="s1">'connect.php'</span><span class="p">;</span>
<span class="k">include</span> <span class="s1">'header.php'</span><span class="p">;</span>
 
<span class="nv">$sql</span> <span class="o">=</span> <span class="s2">"SELECT
            cat_id,
            cat_name,
            cat_description,
        FROM
            categories"</span><span class="p">;</span>
 
<span class="nv">$result</span> <span class="o">=</span> <span class="nb">mysql_query</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
 
<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nv">$result</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">echo</span> <span class="s1">'The categories could not be displayed, please try again later.'</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">else</span>
<span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="nb">mysql_num_rows</span><span class="p">(</span><span class="nv">$result</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">echo</span> <span class="s1">'No categories defined yet.'</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
        <span class="c1">//prepare the table
</span>        <span class="k">echo</span> <span class="s1">'&lt;table border="1"&gt;
              &lt;tr&gt;
                &lt;th&gt;Category&lt;/th&gt;
                &lt;th&gt;Last topic&lt;/th&gt;
              &lt;/tr&gt;'</span><span class="p">;</span> 
             
        <span class="k">while</span><span class="p">(</span><span class="nv">$row</span> <span class="o">=</span> <span class="nb">mysql_fetch_assoc</span><span class="p">(</span><span class="nv">$result</span><span class="p">))</span>
        <span class="p">{</span>               
            <span class="k">echo</span> <span class="s1">'&lt;tr&gt;'</span><span class="p">;</span>
                <span class="k">echo</span> <span class="s1">'&lt;td class="leftpart"&gt;'</span><span class="p">;</span>
                    <span class="k">echo</span> <span class="s1">'&lt;h3&gt;&lt;a href="category.php?id"&gt;'</span> <span class="o">.</span> <span class="nv">$row</span><span class="p">[</span><span class="s1">'cat_name'</span><span class="p">]</span> <span class="o">.</span> <span class="s1">'&lt;/a&gt;&lt;/h3&gt;'</span> <span class="o">.</span> <span class="nv">$row</span><span class="p">[</span><span class="s1">'cat_description'</span><span class="p">];</span>
                <span class="k">echo</span> <span class="s1">'&lt;/td&gt;'</span><span class="p">;</span>
                <span class="k">echo</span> <span class="s1">'&lt;td class="rightpart"&gt;'</span><span class="p">;</span>
                            <span class="k">echo</span> <span class="s1">'&lt;a href="topic.php?id="&gt;Topic subject&lt;/a&gt; at 10-10'</span><span class="p">;</span>
                <span class="k">echo</span> <span class="s1">'&lt;/td&gt;'</span><span class="p">;</span>
            <span class="k">echo</span> <span class="s1">'&lt;/tr&gt;'</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
 
<span class="k">include</span> <span class="s1">'footer.php'</span><span class="p">;</span>
<span class="cp">?&gt;</span></code></pre></figure> <p>لاحظ كيف استخدمنا حقل cat_id لإنشاء روابط لصفحة category.php . جميع الروابط لهذه السفحة ستبدو على الشكل:</p> <div class="highlighter-rouge"><pre class="highlight"><code>	category.php?cat_id=x
</code></pre></div> <p>حيث x يمكن أن يكون أي قيمة عددية بحسب التصنيف .</p> <h1 id="تاسعاً-إنشاء-موضوع">تاسعاً: إنشاء موضوع</h1> <p>سنقوم في هذه الخطوة بجمع التقنيات التي تعلمناها في الخطوات السابقة. حيث سنقوم بالتأكد من أن المستخدم مسجل الدخول، سنقوم باستخدام تعليمة SQL لإنشاء موضوع ، وسننشئ نموذج html بسيط كواجهة مستخدم لإنشاء الموضوع.</p> <p>إن هيكلية ملف إنشاء الموضوع create_topic.php من الصعب شرحها ضمن قائمة أو ما شابه، لذا قمت بكتابة شرح للهيكل العام للملف كتوضيح:</p> <figure class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="k">if</span><span class="p">(</span><span class="nx">user</span> <span class="nx">is</span> <span class="nx">signed</span> <span class="nx">in</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">//the user is not signed in
</span><span class="p">}</span>
<span class="k">else</span>
<span class="p">{</span>
    <span class="c1">//the user is signed in
</span>    <span class="k">if</span><span class="p">(</span><span class="nx">form</span> <span class="nx">has</span> <span class="k">not</span> <span class="nx">been</span> <span class="nx">posted</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">//show form
</span>    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
        <span class="c1">//process form
</span>    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span></code></pre></figure> <p>وهذا هو الكود الحقيقي لهذا القسم من المنتدى ، راجع الشرح أسفل الكود لفهم ما يجري .</p> <figure class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="c1">//create_cat.php
</span><span class="k">include</span> <span class="s1">'connect.php'</span><span class="p">;</span>
<span class="k">include</span> <span class="s1">'header.php'</span><span class="p">;</span>
 
<span class="k">echo</span> <span class="s1">'&lt;h2&gt;Create a topic&lt;/h2&gt;'</span><span class="p">;</span>
<span class="k">if</span><span class="p">(</span><span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">'signed_in'</span><span class="p">]</span> <span class="o">==</span> <span class="kc">false</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">//the user is not signed in
</span>    <span class="k">echo</span> <span class="s1">'Sorry, you have to be &lt;a href="/forum/signin.php"&gt;signed in&lt;/a&gt; to create a topic.'</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">else</span>
<span class="p">{</span>
    <span class="c1">//the user is signed in
</span>    <span class="k">if</span><span class="p">(</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">'REQUEST_METHOD'</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">'POST'</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">//the form hasn't been posted yet, display it
</span>        <span class="c1">//retrieve the categories from the database for use in the dropdown
</span>        <span class="nv">$sql</span> <span class="o">=</span> <span class="s2">"SELECT
                    cat_id,
                    cat_name,
                    cat_description
                FROM
                    categories"</span><span class="p">;</span>
         
        <span class="nv">$result</span> <span class="o">=</span> <span class="nb">mysql_query</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
         
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nv">$result</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="c1">//the query failed, uh-oh :-(
</span>            <span class="k">echo</span> <span class="s1">'Error while selecting from database. Please try again later.'</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">else</span>
        <span class="p">{</span>
            <span class="k">if</span><span class="p">(</span><span class="nb">mysql_num_rows</span><span class="p">(</span><span class="nv">$result</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="c1">//there are no categories, so a topic can't be posted
</span>                <span class="k">if</span><span class="p">(</span><span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">'user_level'</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="k">echo</span> <span class="s1">'You have not created categories yet.'</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="k">else</span>
                <span class="p">{</span>
                    <span class="k">echo</span> <span class="s1">'Before you can post a topic, you must wait for an admin to create some categories.'</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="k">else</span>
            <span class="p">{</span>
         
                <span class="k">echo</span> <span class="s1">'&lt;form method="post" action=""&gt;
                    Subject: &lt;input type="text" name="topic_subject" /&gt;
                    Category:'</span><span class="p">;</span> 
                 
                <span class="k">echo</span> <span class="s1">'&lt;select name="topic_cat"&gt;'</span><span class="p">;</span>
                    <span class="k">while</span><span class="p">(</span><span class="nv">$row</span> <span class="o">=</span> <span class="nb">mysql_fetch_assoc</span><span class="p">(</span><span class="nv">$result</span><span class="p">))</span>
                    <span class="p">{</span>
                        <span class="k">echo</span> <span class="s1">'&lt;option value="'</span> <span class="o">.</span> <span class="nv">$row</span><span class="p">[</span><span class="s1">'cat_id'</span><span class="p">]</span> <span class="o">.</span> <span class="s1">'"&gt;'</span> <span class="o">.</span> <span class="nv">$row</span><span class="p">[</span><span class="s1">'cat_name'</span><span class="p">]</span> <span class="o">.</span> <span class="s1">'&lt;/option&gt;'</span><span class="p">;</span>
                    <span class="p">}</span>
                <span class="k">echo</span> <span class="s1">'&lt;/select&gt;'</span><span class="p">;</span> 
                     
                <span class="k">echo</span> <span class="s1">'Message: &lt;textarea name="post_content" /&gt;&lt;/textarea&gt;
                    &lt;input type="submit" value="Create topic" /&gt;
                 &lt;/form&gt;'</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
        <span class="c1">//start the transaction
</span>        <span class="nv">$query</span>  <span class="o">=</span> <span class="s2">"BEGIN WORK;"</span><span class="p">;</span>
        <span class="nv">$result</span> <span class="o">=</span> <span class="nb">mysql_query</span><span class="p">(</span><span class="nv">$query</span><span class="p">);</span>
         
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nv">$result</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="c1">//Damn! the query failed, quit
</span>            <span class="k">echo</span> <span class="s1">'An error occured while creating your topic. Please try again later.'</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">else</span>
        <span class="p">{</span>
     
            <span class="c1">//the form has been posted, so save it
</span>            <span class="c1">//insert the topic into the topics table first, then we'll save the post into the posts table
</span>            <span class="nv">$sql</span> <span class="o">=</span> <span class="s2">"INSERT INTO 
                        topics(topic_subject,
                               topic_date,
                               topic_cat,
                               topic_by)
                   VALUES('"</span> <span class="o">.</span> <span class="nb">mysql_real_escape_string</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">'topic_subject'</span><span class="p">])</span> <span class="o">.</span> <span class="s2">"',
                               NOW(),
                               "</span> <span class="o">.</span> <span class="nb">mysql_real_escape_string</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">'topic_cat'</span><span class="p">])</span> <span class="o">.</span> <span class="s2">",
                               "</span> <span class="o">.</span> <span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">'user_id'</span><span class="p">]</span> <span class="o">.</span> <span class="s2">"
                               )"</span><span class="p">;</span>
                      
            <span class="nv">$result</span> <span class="o">=</span> <span class="nb">mysql_query</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
            <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nv">$result</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="c1">//something went wrong, display the error
</span>                <span class="k">echo</span> <span class="s1">'An error occured while inserting your data. Please try again later.'</span> <span class="o">.</span> <span class="nb">mysql_error</span><span class="p">();</span>
                <span class="nv">$sql</span> <span class="o">=</span> <span class="s2">"ROLLBACK;"</span><span class="p">;</span>
                <span class="nv">$result</span> <span class="o">=</span> <span class="nb">mysql_query</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">else</span>
            <span class="p">{</span>
                <span class="c1">//the first query worked, now start the second, posts query
</span>                <span class="c1">//retrieve the id of the freshly created topic for usage in the posts query
</span>                <span class="nv">$topicid</span> <span class="o">=</span> <span class="nb">mysql_insert_id</span><span class="p">();</span>
                 
                <span class="nv">$sql</span> <span class="o">=</span> <span class="s2">"INSERT INTO
                            posts(post_content,
                                  post_date,
                                  post_topic,
                                  post_by)
                        VALUES
                            ('"</span> <span class="o">.</span> <span class="nb">mysql_real_escape_string</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">'post_content'</span><span class="p">])</span> <span class="o">.</span> <span class="s2">"',
                                  NOW(),
                                  "</span> <span class="o">.</span> <span class="nv">$topicid</span> <span class="o">.</span> <span class="s2">",
                                  "</span> <span class="o">.</span> <span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">'user_id'</span><span class="p">]</span> <span class="o">.</span> <span class="s2">"
                            )"</span><span class="p">;</span>
                <span class="nv">$result</span> <span class="o">=</span> <span class="nb">mysql_query</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
                 
                <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nv">$result</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="c1">//something went wrong, display the error
</span>                    <span class="k">echo</span> <span class="s1">'An error occured while inserting your post. Please try again later.'</span> <span class="o">.</span> <span class="nb">mysql_error</span><span class="p">();</span>
                    <span class="nv">$sql</span> <span class="o">=</span> <span class="s2">"ROLLBACK;"</span><span class="p">;</span>
                    <span class="nv">$result</span> <span class="o">=</span> <span class="nb">mysql_query</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
                <span class="p">}</span>
                <span class="k">else</span>
                <span class="p">{</span>
                    <span class="nv">$sql</span> <span class="o">=</span> <span class="s2">"COMMIT;"</span><span class="p">;</span>
                    <span class="nv">$result</span> <span class="o">=</span> <span class="nb">mysql_query</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
                     
                    <span class="c1">//after a lot of work, the query succeeded!
</span>                    <span class="k">echo</span> <span class="s1">'You have successfully created &lt;a href="topic.php?id='</span><span class="o">.</span> <span class="nv">$topicid</span> <span class="o">.</span> <span class="s1">'"&gt;your new topic&lt;/a&gt;.'</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
 
<span class="k">include</span> <span class="s1">'footer.php'</span><span class="p">;</span>
<span class="cp">?&gt;</span></code></pre></figure> <p>سأناقش هذه الصفحة على قسمين: عرض النموذج ومعالجة النموذج.</p> <h2 id="عرض-النموذج">عرض النموذج</h2> <p>لعرض النموذج فإننا نبدأ بتعليمات html بسيطة، ولكن في الواقع هناك شيئ خاص، ﻷننا نستخدم قائمة منسدلة، هذه القائمة المنسدلة يتم تعبئتها من خلال بيانات موجودة في قاعدة البيانات، يتم استخراج تلك البيانات باستخدام تعليمات SQL :</p> <figure class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">SELECT</span>
    <span class="n">cat_id</span><span class="p">,</span>
    <span class="n">cat_name</span><span class="p">,</span>
    <span class="n">cat_description</span>
<span class="k">FROM</span>
    <span class="n">categories</span></code></pre></figure> <p>أعتقد أن هذا هو الجزء الغير واضح هنا، والآن كما ترى هو مجرد كود بسيط .</p> <h2 id="معالجة-النموذج">معالجة النموذج</h2> <p>عملية حفظ الموضوع تتضمن مرحلتين: حفظ الموضوع في جدول المواضيع ضمن قاعدة البيانات، وحفظ أول تعليق في جدول التعليقات. وهذا يتطلب شيئ متقدم نوعاً ما وخارج موضوعنا هنا تقريباً، وهو يدعى إجراء <code class="highlighter-rouge">transaction</code> ، ويُقصد به أننا نبدأ بتنفيذ أمر البدء ثم التراجع إذا كان هناك أخطاء في قاعدة البيانات أو إنهاء التنفيذ عندما يجري كل شيئ بشكل صحيح.</p> <figure class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="c1">//start the transaction
</span><span class="nv">$query</span>  <span class="o">=</span> <span class="s2">"BEGIN WORK;"</span><span class="p">;</span>
<span class="nv">$result</span> <span class="o">=</span> <span class="nb">mysql_query</span><span class="p">(</span><span class="nv">$query</span><span class="p">);</span>
<span class="c1">//stop the transaction
</span><span class="nv">$sql</span> <span class="o">=</span> <span class="s2">"ROLLBACK;"</span><span class="p">;</span>
<span class="nv">$result</span> <span class="o">=</span> <span class="nb">mysql_query</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
<span class="c1">//commit the transaction
</span><span class="nv">$sql</span> <span class="o">=</span> <span class="s2">"COMMIT;"</span><span class="p">;</span>
<span class="nv">$result</span> <span class="o">=</span> <span class="nb">mysql_query</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
<span class="cp">?&gt;</span></code></pre></figure> <p>أول تعليمة تستخدم لحفظ ابيانات هو تعليمة إنشاء موضوع، والتي تبدو على الشكل التالي :</p> <figure class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">INSERT</span> <span class="k">INTO</span>
    <span class="n">topics</span><span class="p">(</span><span class="n">topic_subject</span><span class="p">,</span>
               <span class="n">topic_date</span><span class="p">,</span>
               <span class="n">topic_cat</span><span class="p">,</span>
               <span class="n">topic_by</span><span class="p">)</span>
<span class="k">VALUES</span><span class="p">(</span><span class="s1">'" . mysql_real_escape_string($_POST['</span><span class="n">topic_subject</span><span class="s1">']) . "'</span><span class="p">,</span>
       <span class="n">NOW</span><span class="p">(),</span>
       <span class="nv">" . mysql_real_escape_string($_POST['topic_cat']) . "</span><span class="p">,</span>
       <span class="nv">" . $_SESSION['user_id'] . "</span><span class="p">)</span></code></pre></figure> <p>في البداية تم تعريف الحقول، ثم القيم ليتم إدراجها في الحقول. لقد رأيت مثل هذه التعليمات سابقاً، حيث أنها مجرد تعليمات يتم تأمينها استخدام العبارة <code class="highlighter-rouge">musql_real_escape_string()</code> . القيمة الثانية : <code class="highlighter-rouge">NOW()</code> هي وظيفة في <code class="highlighter-rouge">SQL</code> لإدارج الوقت الحالي. القيمة الثالثة هي التي لم ترها من قبل، وهي تشير إلى معرف id صالح لتصنيف ما. والقيمة الأخيرة تشير لمعرف id مستخدم موجود بالفعل، وهو في حالتنا هي قيمة المتغير <code class="highlighter-rouge">$_SESSION['user_id']</code>. خيث تم مناقشة هذا المتغير خلال خطوة تسجيل الدخول .</p> <p>إذا تم تنفيذ الكود بدون أخطاء، فيتم الانتقال للخطوة التالية. تذكر أننا ما زالنا نجري إجراءاً هنا <code class="highlighter-rouge">transaction</code> . إذا حصلنا على أخطاء فسنستخدم تعليمة <code class="highlighter-rouge">ROLLBACK</code>.</p> <figure class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">INSERT</span> <span class="k">INTO</span>
        <span class="n">posts</span><span class="p">(</span><span class="n">post_content</span><span class="p">,</span>
        <span class="n">post_date</span><span class="p">,</span>
        <span class="n">post_topic</span><span class="p">,</span>
        <span class="n">post_by</span><span class="p">)</span>
<span class="k">VALUES</span>
        <span class="p">(</span><span class="s1">'" . mysql_real_escape_string($_POST['</span><span class="n">post_content</span><span class="s1">']) . "'</span><span class="p">,</span>
         <span class="n">NOW</span><span class="p">(),</span>
         <span class="nv">" . $topicid . "</span><span class="p">,</span>
         <span class="nv">" . $_SESSION['user_id'] . "</span><span class="p">)</span></code></pre></figure> <p>إن أول شيئ نفعله هنا هو استخدام تعليمة <code class="highlighter-rouge">mysql_insert_id()</code> للحصول على آخر id تم توليده من حقل <code class="highlighter-rouge">topic_id</code> في جدول المواضيع. وكما وجدت في الخطوات الأولى، يتم توليد الـ <code class="highlighter-rouge">id</code> في قاعدة البيانات باستخدام تعليمة <code class="highlighter-rouge">auto_increment</code>.</p> <p>ثم يتم إدراج المنشور في جدول المنشورات post table. تبدو هذه العملية مشابهة لعملية المواضيع، الفرق الوحيد بينهما هو أن المنشور يشير إلى الموضوع والموضوع يشير للتصنيف. لقد قررنا من البداية إنشاء تصميم بيانات جيد، وهذه هي النتيجة.</p> <p><img src="/assets/7.png" alt="كيفية عمل منتدى باستخدام php و MySQL من الصفر-7" title="كيفية عمل منتدى باستخدام php و MySQL من الصفر-7"></p> <h1 id="عاشراً--عرض-التصنيفات">عاشراً : عرض التصنيفات</h1> <p>سوف نقوم بعمل صفحة عرض لتصنيف محدد. لقد أنشأنا تصنيفاً للتو ، ومن المفضل توفير إمكانية مشاهدة جميع المواضيع التي تتبع لهذا التصنيف. أولاً قم بإنشاء صفحة باسم category.php</p> <p><strong>نحتاج هنا لعدة أمور:</strong></p> <p>1.أمور نحتاجها لعرض التصنيف:</p> <ul> <li> <p><code class="highlighter-rouge">cat_name</code> (اسم التصنيف)</p> </li> <li> <p><code class="highlighter-rouge">cat_description</code> (وصف التصنيف)</p> </li> </ul> <p>2.أمور نحتاجها لعرض المواضيع ضمن ذلك التصنيف:</p> <ul> <li> <p><code class="highlighter-rouge">topic_id</code> (معرف الموضوع)</p> </li> <li> <p><code class="highlighter-rouge">topic_subject</code> (عنوان الموضوع)</p> </li> <li> <p><code class="highlighter-rouge">topic_date</code> (تاريخ الموضوع)</p> </li> <li> <p><code class="highlighter-rouge">topic_cat</code> (تصنيف الموضوع)</p> </li> </ul> <p>لنقم الآن بإنشاء تعليمتي SQL والتي تقوم باستخراج البيانات الني نريدها تحديداً من قاعدة البيانات</p> <figure class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">SELECT</span>
    <span class="n">cat_id</span><span class="p">,</span>
    <span class="n">cat_name</span><span class="p">,</span>
    <span class="n">cat_description</span>
<span class="k">FROM</span>
    <span class="n">categories</span>
<span class="k">WHERE</span>
    <span class="n">cat_id</span> <span class="o">=</span> <span class="nv">" . mysql_real_escape_string($_GET['id'])</span></code></pre></figure> <p>تقوم التعليمة أعلاه باستخراج جميع التصنيفات من قاعدة البيانات</p> <figure class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">SELECT</span> 
    <span class="n">topic_id</span><span class="p">,</span>
    <span class="n">topic_subject</span><span class="p">,</span>
    <span class="n">topic_date</span><span class="p">,</span>
    <span class="n">topic_cat</span>
<span class="k">FROM</span>
    <span class="n">topics</span>
<span class="k">WHERE</span>
    <span class="n">topic_cat</span> <span class="o">=</span> <span class="nv">" . mysql_real_escape_string($_GET['id'])</span></code></pre></figure> <p>والآن ، الكود الكامل لملف category.php سيكون على الشكل التالي</p> <figure class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>
<span class="c1">//create_cat.php
</span><span class="k">include</span> <span class="s1">'connect.php'</span><span class="p">;</span>
<span class="k">include</span> <span class="s1">'header.php'</span><span class="p">;</span>
 
<span class="c1">//first select the category based on $_GET['cat_id']
</span><span class="nv">$sql</span> <span class="o">=</span> <span class="s2">"SELECT
            cat_id,
            cat_name,
            cat_description
        FROM
            categories
        WHERE
            cat_id = "</span> <span class="o">.</span> <span class="nb">mysql_real_escape_string</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">'id'</span><span class="p">]);</span>
 
<span class="nv">$result</span> <span class="o">=</span> <span class="nb">mysql_query</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
 
<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nv">$result</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">echo</span> <span class="s1">'The category could not be displayed, please try again later.'</span> <span class="o">.</span> <span class="nb">mysql_error</span><span class="p">();</span>
<span class="p">}</span>
<span class="k">else</span>
<span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="nb">mysql_num_rows</span><span class="p">(</span><span class="nv">$result</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">echo</span> <span class="s1">'This category does not exist.'</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
        <span class="c1">//display category data
</span>        <span class="k">while</span><span class="p">(</span><span class="nv">$row</span> <span class="o">=</span> <span class="nb">mysql_fetch_assoc</span><span class="p">(</span><span class="nv">$result</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="k">echo</span> <span class="s1">'&lt;h2&gt;Topics in ′'</span> <span class="o">.</span> <span class="nv">$row</span><span class="p">[</span><span class="s1">'cat_name'</span><span class="p">]</span> <span class="o">.</span> <span class="s1">'′ category&lt;/h2&gt;'</span><span class="p">;</span>
        <span class="p">}</span>
     
        <span class="c1">//do a query for the topics
</span>        <span class="nv">$sql</span> <span class="o">=</span> <span class="s2">"SELECT  
                    topic_id,
                    topic_subject,
                    topic_date,
                    topic_cat
                FROM
                    topics
                WHERE
                    topic_cat = "</span> <span class="o">.</span> <span class="nb">mysql_real_escape_string</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">'id'</span><span class="p">]);</span>
         
        <span class="nv">$result</span> <span class="o">=</span> <span class="nb">mysql_query</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
         
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nv">$result</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">echo</span> <span class="s1">'The topics could not be displayed, please try again later.'</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">else</span>
        <span class="p">{</span>
            <span class="k">if</span><span class="p">(</span><span class="nb">mysql_num_rows</span><span class="p">(</span><span class="nv">$result</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">echo</span> <span class="s1">'There are no topics in this category yet.'</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">else</span>
            <span class="p">{</span>
                <span class="c1">//prepare the table
</span>                <span class="k">echo</span> <span class="s1">'&lt;table border="1"&gt;
                      &lt;tr&gt;
                        &lt;th&gt;Topic&lt;/th&gt;
                        &lt;th&gt;Created at&lt;/th&gt;
                      &lt;/tr&gt;'</span><span class="p">;</span> 
                     
                <span class="k">while</span><span class="p">(</span><span class="nv">$row</span> <span class="o">=</span> <span class="nb">mysql_fetch_assoc</span><span class="p">(</span><span class="nv">$result</span><span class="p">))</span>
                <span class="p">{</span>               
                    <span class="k">echo</span> <span class="s1">'&lt;tr&gt;'</span><span class="p">;</span>
                        <span class="k">echo</span> <span class="s1">'&lt;td class="leftpart"&gt;'</span><span class="p">;</span>
                            <span class="k">echo</span> <span class="s1">'&lt;h3&gt;&lt;a href="topic.php?id='</span> <span class="o">.</span> <span class="nv">$row</span><span class="p">[</span><span class="s1">'topic_id'</span><span class="p">]</span> <span class="o">.</span> <span class="s1">'"&gt;'</span> <span class="o">.</span> <span class="nv">$row</span><span class="p">[</span><span class="s1">'topic_subject'</span><span class="p">]</span> <span class="o">.</span> <span class="s1">'&lt;/a&gt;&lt;h3&gt;'</span><span class="p">;</span>
                        <span class="k">echo</span> <span class="s1">'&lt;/td&gt;'</span><span class="p">;</span>
                        <span class="k">echo</span> <span class="s1">'&lt;td class="rightpart"&gt;'</span><span class="p">;</span>
                            <span class="k">echo</span> <span class="nb">date</span><span class="p">(</span><span class="s1">'d-m-Y'</span><span class="p">,</span> <span class="nb">strtotime</span><span class="p">(</span><span class="nv">$row</span><span class="p">[</span><span class="s1">'topic_date'</span><span class="p">]));</span>
                        <span class="k">echo</span> <span class="s1">'&lt;/td&gt;'</span><span class="p">;</span>
                    <span class="k">echo</span> <span class="s1">'&lt;/tr&gt;'</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
 
<span class="k">include</span> <span class="s1">'footer.php'</span><span class="p">;</span>
<span class="cp">?&gt;</span></code></pre></figure> <p>وهذه هي النتيجة النهائية لصفحة التصنيفات</p> <p><img src="/assets/8.png" alt="كيفية عمل منتدى باستخدام php و MySQL من الصفر-8" title="كيفية عمل منتدى باستخدام php و MySQL من الصفر-8"></p> <h1 id="الخطوة-11--عرض-المواضيع">الخطوة 11 : عرض المواضيع</h1> <p>إن تعليمات SQL في هذه الخطوة هي تعليمات معقدة. بالنسبة لكود php فسيكون كله مألوفاً لديك وشبيه بما سبق. لذا دعنا نلقي نظرة الآن على تعليمات SQL . حيث التعليمة الأولى تستخرج معلومات أساسية حول الموضوع:</p> <figure class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">SELECT</span>
<span class="n">topic_id</span><span class="p">,</span>
<span class="n">topic_subject</span>
<span class="k">FROM</span>
<span class="n">topics</span>
<span class="k">WHERE</span>
<span class="n">topics</span><span class="p">.</span><span class="n">topic_id</span> <span class="o">=</span> <span class="nv">" . mysql_real_escape_string($_GET[
'id'])</span></code></pre></figure> <p>يتم عرض هذه المعلومات في رأس الجدول الذي سنستخدمه لعرض جميع البيانات. ثم سنستخرج جميع التعليقات على هذا الموضوع من قاعدة البيانات. التعليمة التالية تعطينا تماماً ما نريد:</p> <figure class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">SELECT</span>
<span class="n">posts</span><span class="p">.</span><span class="n">post_topic</span><span class="p">,</span>
<span class="n">posts</span><span class="p">.</span><span class="n">post_content</span><span class="p">,</span>
<span class="n">posts</span><span class="p">.</span><span class="n">post_date</span><span class="p">,</span>
<span class="n">posts</span><span class="p">.</span><span class="n">post_by</span><span class="p">,</span>
<span class="n">users</span><span class="p">.</span><span class="n">user_id</span><span class="p">,</span>
<span class="n">users</span><span class="p">.</span><span class="n">user_name</span>
<span class="k">FROM</span>
<span class="n">posts</span>
<span class="k">LEFT</span> <span class="k">JOIN</span>
<span class="n">users</span>
<span class="k">ON</span>
<span class="n">posts</span><span class="p">.</span><span class="n">post_by</span> <span class="o">=</span> <span class="n">users</span><span class="p">.</span><span class="n">user_id</span>
<span class="k">WHERE</span>
<span class="n">posts</span><span class="p">.</span><span class="n">post_topic</span> <span class="o">=</span> <span class="nv">" . mysql_real_escape_string($_GET[
'id'])</span></code></pre></figure> <p>والآن نريد معلومات من جدول المستخدمين users وجدول التعليقات replies لذا سنستخدم عبارة LEFT JOIN مرة أخرى. حيث يكون الشرط كالتالي: معرف المستخدم user id يجب أن يكون نفسه في حقل reply_by (مؤلف التعليق) . وبهذه الطريقة نستطيع عرض اسم المستخدم للمستخدم الذي قام بإضافة تعليق ما.</p> <p>العرض الأخير للمواضيع سيبدو على الشكل :</p> <p><img src="/assets/9.png" alt="كيفية عمل منتدى باستخدام php و MySQL من الصفر-9" title="كيفية عمل منتدى باستخدام php و MySQL من الصفر-9"></p> <h1 id="الخطوة-12--إضافة-تعليق">الخطوة 12 : إضافة تعليق</h1> <p>والآن دعنا ننهي آخر جزء متبقي لدينا من المنتدى، ألا وهو إمكانية إضافة تعليق. سنبدأ بعمل نموذج للتعليق (بلغة html) :</p> <figure class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;form</span> <span class="na">method=</span><span class="s">"post"</span> <span class="na">action=</span><span class="s">"reply.php?id=5"</span><span class="nt">&gt;</span>
<span class="nt">&lt;textarea</span> <span class="na">name=</span><span class="s">"reply-content"</span><span class="nt">&gt;&lt;/textarea &gt;</span>
<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">value=</span><span class="s">"Submit reply"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/form&gt;</span></code></pre></figure> <p><img src="/assets/10.png" alt="كيفية عمل منتدى باستخدام php و MySQL من الصفر-10" title="كيفية عمل منتدى باستخدام php و MySQL من الصفر-10"></p> <p>وفي النهاية سيكون الكود الكامل لملف reply.php كالتالي:</p> <figure class="highlight"><pre><code class="language-php" data-lang="php">		<span class="cp">&lt;?php</span>
		<span class="c1">//create_cat.php
</span>		<span class="k">include</span> <span class="s1">'connect.php'</span><span class="p">;</span>
		<span class="k">include</span> <span class="s1">'header.php'</span><span class="p">;</span>
		<span class="k">if</span><span class="p">(</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">'REQUEST_METHOD'</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">'POST'</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="c1">//someone is calling the file directly, which we don't want
</span>			<span class="k">echo</span> <span class="s1">'This file cannot be called directly.'</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">else</span>
		<span class="p">{</span>
			<span class="c1">//check for sign in status
</span>			<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">'signed_in'</span><span class="p">])</span>
			<span class="p">{</span>
				<span class="k">echo</span> <span class="s1">'You must be signed in to post a reply.'</span><span class="p">;</span>
			<span class="p">}</span>
			<span class="k">else</span>
			<span class="p">{</span>
				<span class="c1">//a real user posted a real reply
</span>				<span class="nv">$sql</span> <span class="o">=</span> <span class="s2">"INSERT INTO 
							posts(post_content,
									post_date,
									post_topic,
									post_by) 
						VALUES ('"</span> <span class="o">.</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">'reply-content'</span><span class="p">]</span> <span class="o">.</span> <span class="s2">"',
								NOW(),
								"</span> <span class="o">.</span> <span class="nb">mysql_real_escape_string</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">'id'</span><span class="p">])</span> <span class="o">.</span> <span class="s2">",
								"</span> <span class="o">.</span> <span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">'user_id'</span><span class="p">]</span> <span class="o">.</span> <span class="s2">")"</span><span class="p">;</span>
						
				<span class="nv">$result</span> <span class="o">=</span> <span class="nb">mysql_query</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
				<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nv">$result</span><span class="p">)</span>
				<span class="p">{</span>
					<span class="k">echo</span> <span class="s1">'Your reply has not been saved, please try again later.'</span><span class="p">;</span>
				<span class="p">}</span>
				<span class="k">else</span>
				<span class="p">{</span>
					<span class="k">echo</span> <span class="s1">'Your reply has been saved, check out &lt;a href="topic.php?id='</span> <span class="o">.</span> <span class="nb">htmlentities</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">'id'</span><span class="p">])</span> <span class="o">.</span> <span class="s1">'"&gt;the topic&lt;/a&gt;.'</span><span class="p">;</span>
				<span class="p">}</span>
			<span class="p">}</span>
		<span class="p">}</span>
		<span class="k">include</span> <span class="s1">'footer.php'</span><span class="p">;</span>
		<span class="cp">?&gt;</span></code></pre></figure> <p>انظر التعليقات ضمن الكود لفهم ما يجري.</p> <p>نتأكد أولاً من وجود المستخدم ثم نضيف (ندرج) التعليق لقاعدة البيانات.</p> <p><img src="/assets/11.png" alt="كيفية عمل منتدى باستخدام php و MySQL من الصفر-11" title="كيفية عمل منتدى باستخدام php و MySQL من الصفر-11"></p> <h1 id="النهاية">النهاية</h1> <p>الآن وبعد قراءتك لهذا الشرح ستكون لديك المعرفة الكافية لبناء منتدى، أتمنى أن يكون الشرح واضحاً وأنك لم تعترك مع أية مشاكل في طريقك ..</p> <div class="entry-meta"> <br> <hr> <span class="entry-tags"></span> <span class="social-share"> <a href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:4000/php-forum-from-scratch/" title="Share on Facebook" class="tag"> <span class="term"><i class="fa fa-facebook-square"></i> Like</span> </a> <a href="https://twitter.com/intent/tweet?text=http://localhost:4000/php-forum-from-scratch/" title="Share on Twitter" class="tag"> <span class="term"><i class="fa fa-twitter-square"></i> Tweet</span> </a> <a href="https://plus.google.com/share?url=http://localhost:4000/php-forum-from-scratch/" title="Share on Google+" class="tag"> <span class="term"><i class="fa fa-google-plus-square"></i> +1</span> </a> </span> <div style="clear:both"></div> </div> </div> </div> </header> <!-- JS --> <script src="http://localhost:4000/assets/js/jquery-1.12.0.min.js"></script> <script src="http://localhost:4000/assets/js/jquery.dlmenu.min.js"></script> <script src="http://localhost:4000/assets/js/jquery.goup.min.js"></script> <script src="http://localhost:4000/assets/js/jquery.magnific-popup.min.js"></script> <script src="http://localhost:4000/assets/js/jquery.fitvid.min.js"></script> <script src="http://localhost:4000/assets/js/scripts.js"></script> <!-- Asynchronous Google Analytics snippet --> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-80564042-1', 'auto'); ga('require', 'linkid', 'linkid.js'); ga('send', 'pageview'); </script> <script type="text/javascript"> var disqus_shortname = 'mulham-1'; (function() { var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true; dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js'; (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq); })(); (function () { var s = document.createElement('script'); s.async = true; s.type = 'text/javascript'; s.src = '//' + disqus_shortname + '.disqus.com/count.js'; (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s); }()); </script> <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript> <!-- MathJax --> <script async src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script> </body> </html>
